System.register("chunks:///_virtual/AdManger.ts",["cc","./WxPlatform.ts","./BytePlantform.ts","./Logger.ts"],(function(o){var t,e,s,a,n,r;return{setters:[function(o){t=o.cclegacy,e=o._decorator,s=o.sys},function(o){a=o.WxPlatform},function(o){n=o.BytePlantform},function(o){r=o.Logger}],execute:function(){var i;t._RF.push({},"829ecAfsu5DUYSbRAeKLqBA","AdManger",void 0);var c=e.ccclass;e.property,o("AdManger",c("AdManger")(i=function(){function o(){}return o.show_interstial=function(o){switch(s.platform){case s.Platform.WECHAT_GAME:a.ins.show_interstitial(o);break;case s.Platform.BYTEDANCE_MINI_GAME:n.ins.show_interstitial(o);break;default:r.log("插屏广告展示演示，浏览器跳过")}},o.show_video=function(o){switch(s.platform){case s.Platform.WECHAT_GAME:a.ins.show_reward_video((function(t){1==t?(console.log("show_video 获取奖励成功"),o(t)):(console.log("show_video 获取奖励失败"),o(t))}));break;case s.Platform.BYTEDANCE_MINI_GAME:n.ins.ShowAdvertisements((function(t){1==t?(r.log("show_video 获取奖励成功"),o(t)):(r.log("show_video 获取奖励失败"),o(t))}));break;case s.Platform.MOBILE_BROWSER:case s.Platform.DESKTOP_BROWSER:o(1);break;default:o(0)}},o.show_custom=function(o){switch(r.log("显示  custom ad >",o),s.platform){case s.Platform.WECHAT_GAME:a.ins.show_custom_ad();break;case s.Platform.BYTEDANCE_MINI_GAME:n.ins.show_banner()}},o.close_ad=function(){switch(s.platform){case s.Platform.WECHAT_GAME:a.ins.hide_banner(),a.ins.hide_custom();break;case s.Platform.BYTEDANCE_MINI_GAME:n.ins.hide_banner()}},o}())||i);t._RF.pop()}}}));

System.register("chunks:///_virtual/AudioManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Global.ts","./Enums.ts","./Logger.ts"],(function(o){var i,s,t,u,e,r,n,_,a,c,d,l,h,g;return{setters:[function(o){i=o.inheritsLoose,s=o.createClass,t=o.asyncToGenerator,u=o.regeneratorRuntime},function(o){e=o.cclegacy,r=o._decorator,n=o.Node,_=o.director,a=o.AudioSource,c=o.Component},function(o){d=o.Global},function(o){l=o,h=o.GAME_STATE},function(o){g=o.Logger}],execute:function(){var f,p;e._RF.push({},"9e50b6W82NDC6OkohLgcsi8","AudioManager",void 0);var m=r.ccclass;o("AudioManager",m("AudioManager")(((p=function(o){function e(){for(var i,s=arguments.length,t=new Array(s),u=0;u<s;u++)t[u]=arguments[u];return(i=o.call.apply(o,[this].concat(t))||this).audio_source_for_short=null,i.audio_source_for_bg=null,i.clip_map={},i._isBGAudioPlaying=!1,i._bgClip=null,i}i(e,o);var r=e.prototype;return r.onLoad=function(){null===e._instance?(e._instance=this,this.init()):this.destroy()},r.init=function(){var o=new n("AudioShort");_.getScene().addChild(o),this.audio_source_for_short=o.addComponent(a),this.audio_source_for_short.playOnAwake=!1,this.audio_source_for_short.volume=d.volum_sound,_.addPersistRootNode(o);var i=new n("AudioBackground");_.getScene().addChild(i),this.audio_source_for_bg=i.addComponent(a),this.audio_source_for_bg.playOnAwake=!1,this.audio_source_for_bg.volume=d.volum_music,this.audio_source_for_bg.loop=!0,_.addPersistRootNode(i)},r.set_music_volume=function(o){this.audio_source_for_bg&&(this.audio_source_for_bg.volume=o)},r.play_music=function(){this.audio_source_for_bg&&this._bgClip&&!this._isBGAudioPlaying&&(this.audio_source_for_bg.clip=this._bgClip,this.audio_source_for_bg.play(),this._isBGAudioPlaying=!0)},r.pause_music=function(){this.audio_source_for_bg&&this._isBGAudioPlaying&&(this.audio_source_for_bg.pause(),this._isBGAudioPlaying=!1)},r.stop_music=function(){this.audio_source_for_bg&&(this.audio_source_for_bg.stop(),this._isBGAudioPlaying=!1)},r.update=function(o){(this.audio_source_for_bg&&this.audio_source_for_bg.volume!==d.volum_music&&(this.audio_source_for_bg.volume=d.volum_music),this.audio_source_for_short&&this.audio_source_for_short.volume!==d.volum_sound&&(this.audio_source_for_short.volume=d.volum_sound),this.audio_source_for_bg&&l&&d.get_game_state&&this._bgClip)&&(d.get_game_state()===h.START?this._isBGAudioPlaying||this.play_music():this._isBGAudioPlaying&&this.pause_music())},r.start_bg_music=function(){this._bgClip=this.clip_map.raindance,this.play_music()},r.add_clip=function(o,i){this.clip_map[o]=i},r.play_shot=function(){var o=t(u().mark((function o(i,s){var t;return u().wrap((function(o){for(;;)switch(o.prev=o.next){case 0:if(0!=d.volum_sound){o.next=3;break}return o.abrupt("return");case 3:(t=this.clip_map[i])&&this.audio_source_for_short.playOneShot(t,1);case 5:case"end":return o.stop()}}),o,this)})));return function(i,s){return o.apply(this,arguments)}}(),s(e,null,[{key:"instance",get:function(){return this._instance||g.warn("AudioManager not initialized! Ensure it's on a persistent node."),this._instance}}]),e}(c))._instance=null,f=p))||f);e._RF.pop()}}}));

System.register("chunks:///_virtual/BaseReviewAction.ts",["./rollupPluginModLoBabelHelpers.js","cc","./ResourcePool.ts"],(function(t){var i,e,n,o,s,c,a,r,u,h,p,l;return{setters:[function(t){i=t.applyDecoratedDescriptor,e=t.inheritsLoose,n=t.initializerDefineProperty,o=t.assertThisInitialized},function(t){s=t.cclegacy,c=t._decorator,a=t.Node,r=t.UIOpacity,u=t.tween,h=t.v3,p=t.Component},function(t){l=t.ResourcePool}],execute:function(){var y,d,f,v,O;s._RF.push({},"8731fypar9HOKzvuY/7wpSU","BaseReviewAction",void 0);var _=c.ccclass,g=c.property;t("BaseReviewAction",(y=_("BaseReviewAction"),d=g(a),y((O=i((v=function(t){function i(){for(var i,e=arguments.length,s=new Array(e),c=0;c<e;c++)s[c]=arguments[c];return i=t.call.apply(t,[this].concat(s))||this,n(i,"content",O,o(i)),i.uiOpacity=null,i}e(i,t);var s=i.prototype;return s.onLoad=function(){this.content&&(this.uiOpacity=this.content.getComponent(r),this.uiOpacity||(this.uiOpacity=this.content.addComponent(r)))},s.onDestroy=function(){this.unscheduleAllCallbacks(),this.content&&u(this.content).stop(),u(this.node).stop()},s.start=function(){},s.update=function(t){},s.close_=function(){var t=this;this.unschedule(this.close_),this.content&&u(this.content).stop(),u(this.node).stop();var i=.25,e=this.content?this.content.position.clone():h(0,0),n=h(e.x,e.y+150),o=this.content?u(this.content).to(i,{position:n},{easing:"cubicIn"}):u().delay(i),s=this.uiOpacity?u(this.uiOpacity).to(i,{opacity:0}):u().delay(i);u(this.node).parallel(o,s).call((function(){l.instance.remove_node(t.node),t.uiOpacity&&(t.uiOpacity.opacity=255)})).start()},s.show_tips=function(t){if(this.content){this.node.active||(this.node.active=!0),this.uiOpacity&&(this.uiOpacity.opacity=255),u(this.node).stop(),u(this.content).stop();var i=h(0,0),e=h(i.x,i.y+200);if(this.content.setPosition(e),u(this.content).to(.3,{position:i},{easing:"backOut"}).start(),t){this.unschedule(this.close_);this.scheduleOnce(this.close_,7)}}else console.error("Content node not assigned!")},i}(p)).prototype,"content",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),f=v))||f));s._RF.pop()}}}));

System.register("chunks:///_virtual/BaseWindows.ts",["./rollupPluginModLoBabelHelpers.js","cc","./AdManger.ts","./Enums.ts","./Global.ts","./Logger.ts","./CrazySDK.ts"],(function(t){var n,e,i,o,a,s,c,r,u,l,p,h,d,y,g,f,m;return{setters:[function(t){n=t.applyDecoratedDescriptor,e=t.inheritsLoose,i=t.initializerDefineProperty,o=t.assertThisInitialized},function(t){a=t.cclegacy,s=t._decorator,c=t.Node,r=t.UIOpacity,u=t.tween,l=t.v3,p=t.Vec3,h=t.Component},function(t){d=t.AdManger},function(t){y=t.GAME_STATE},function(t){g=t.Global},function(t){f=t.Logger},function(t){m=t.default}],execute:function(){var w,_,O,v,S;a._RF.push({},"0af1eRV8Z9Fw5NUWnC973t7","BaseWindows",void 0);var b=s.ccclass,B=s.property;t("BaseWindows",(w=b("BaseWindows"),_=B(c),w((S=n((v=function(t){function n(){for(var n,e=arguments.length,a=new Array(e),s=0;s<e;s++)a[s]=arguments[s];return n=t.call.apply(t,[this].concat(a))||this,i(n,"content",S,o(n)),n.uiOpacity=null,n}e(n,t);var a=n.prototype;return a.onLoad=function(){this.content&&(this.uiOpacity=this.content.getComponent(r),this.uiOpacity||(this.uiOpacity=this.content.addComponent(r)))},a.start=function(){},a.update=function(t){},a.show_windows=function(t,n,e){void 0===e&&(e=y.PAUSE),g.set_game_state(e,"BaseWindows.show>"+this.node.name),this.node.active=!0,this.node.setSiblingIndex(this.node.parent.children.length-1),this.show_content_tween(),"Loading"==this.node.name||"Drop"==this.node.name||"Ready"==this.node.name||(d.show_custom(this.node.name),m.game.gameplayStop())},a.show_content_tween=function(){this.content&&this.uiOpacity&&(u(this.content).stop(),this.content.setScale(l(.01,.01,.01)),this.uiOpacity.opacity=0,u(this.content).to(.3,{scale:p.ONE},{easing:"backOut"}).start(),u(this.uiOpacity).to(.3,{opacity:255}).start())},a.close_windows=function(t,n){var e=this,i=function(){e.node.active=!1,e.content&&(u(e.content).stop(),e.content.setScale(p.ONE)),e.uiOpacity&&(e.uiOpacity.opacity=255),t&&g.set_game_state(t,"BaseWindows.close"),f.log("关闭页面>",e.name);var i=e.name.includes("Loading"),o=e.name.includes("Ready"),a=e.name.includes("Drop"),s=!0;(i||o||a)&&(f.log("关闭页面>",e.name," 不展示插屏广告，跳过"),s=!1),s&&d.show_interstial(0),d.close_ad(),m.game.gameplayStart(),n&&n()};this.content&&this.node.active&&this.uiOpacity?(u(this.content).stop(),u(this.uiOpacity).stop(),u(this.content).to(.2,{scale:l(.7,.7,.7)},{easing:"quadIn"}).start(),u(this.uiOpacity).to(.2,{opacity:0}).call(i).start()):i()},n}(h)).prototype,"content",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),O=v))||O));a._RF.pop()}}}));

System.register("chunks:///_virtual/Bullet100Action.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Global.ts","./Logger.ts","./EnemyAction.ts","./ResourcePool.ts","./ResourceManger.ts","./Tools.ts","./Enums.ts"],(function(t){var e,i,o,n,s,r,a,l,c,u,h,d,_,g,m,f,p,y,v;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,o=t.initializerDefineProperty,n=t.assertThisInitialized},function(t){s=t.cclegacy,r=t._decorator,a=t.Node,l=t.CCFloat,c=t.v3,u=t.Sprite,h=t.Vec3,d=t.Component},function(t){_=t.Global},function(t){g=t.Logger},function(t){m=t.EnemyAction},function(t){f=t.ResourcePool},function(t){p=t.default},function(t){y=t.Tools},function(t){v=t.GAME_STATE}],execute:function(){var P,D,b,E,x,A,M,B,T;s._RF.push({},"fcdf2lI5DZOerVwIQCGvDNc","Bullet100Action",void 0);var w=r.ccclass,R=r.property;t("Bullet100Action",(P=w("Bullet100Action"),D=R(a),b=R(a),E=R({type:l,tooltip:"炮弹从起点开始的最大飞行距离（像素）"}),P((M=e((A=function(t){function e(){for(var e,i=arguments.length,s=new Array(i),r=0;r<i;r++)s[r]=arguments[r];return e=t.call.apply(t,[this].concat(s))||this,o(e,"collider_",M,n(e)),o(e,"show_node",B,n(e)),e.moveSpeed=800,e.damage=1,o(e,"maxTravelDistance",T,n(e)),e._startPos=c(),e._controlPos=c(),e._endPos=c(),e._flightDuration=0,e._timeElapsed=0,e._isMoving=!1,e._targetEnemy=void 0,e}i(e,t);var s=e.prototype;return s.init=function(t,e,i,o,n,s,r){this._targetEnemy=t,this._startPos.set(e),this._controlPos.set(i),this._endPos.set(o),this._flightDuration=n,this._timeElapsed=0,this._isMoving=!0,this.node.setWorldPosition(e),this.init_data(s,r)},s.init_data=function(t,e){var i=t+e,o=_.get_bullet_config(t,i);this.damage=o.damage,this.moveSpeed=o.move_speed;var n=this.show_node.getComponent(u);if(n){var s=p.instance.get_ui("bullet_"+i);s&&(n.spriteFrame=s)}},s.move=function(t){this._timeElapsed+=t;var e=this._timeElapsed/this._flightDuration;if(e>=1){if(this.node.setWorldPosition(this._endPos),this._isMoving=!1,this._targetEnemy&&this._targetEnemy.active){var i=this._targetEnemy.getComponent(m);i&&i.takeDamage(this.damage)}this.destroyBullet()}else{e=Math.min(1,e);var o=this._startPos,n=this._controlPos,s=this._endPos,r=e*e,a=1-e,l=a*a,c=new h;c.x=l*o.x+2*a*e*n.x+r*s.x,c.y=l*o.y+2*a*e*n.y+r*s.y;var u=this.node.getWorldPosition();if(u.x!==c.x||u.y!==c.y){var d=c.clone().subtract(u).normalize(),_=180*Math.atan2(d.y,d.x)/Math.PI;this.node.setRotationFromEuler(0,0,_-90)}this.node.setWorldPosition(c)}},s.update=function(t){if(this._isMoving&&_.get_game_state()==v.START){this.checkDistanceAndDestroy(),this.move(t);var e=this._targetEnemy.getComponent(m);e&&y.checkRectIntersection(this.collider_,e.collider_)&&e&&(e.takeDamage(this.damage),this.destroyBullet())}},s.checkDistanceAndDestroy=function(){this.node.getWorldPosition().clone().subtract(this._startPos).length()>this.maxTravelDistance&&(g.log("Bullet100: Max distance reached, destroying."),this.destroyBullet())},s.destroyBullet=function(){f.instance&&f.instance.remove_node(this.node)},e}(d)).prototype,"collider_",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),B=e(A.prototype,"show_node",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),T=e(A.prototype,"maxTravelDistance",[E],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 800}}),x=A))||x));s._RF.pop()}}}));

System.register("chunks:///_virtual/Bullet200Action.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Global.ts","./Logger.ts","./ResourcePool.ts","./EnemyAction.ts","./ResourceManger.ts","./Tools.ts","./Enums.ts"],(function(t){var e,i,o,n,r,s,a,l,c,u,h,d,_,m,g,p,f,v,y;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,o=t.initializerDefineProperty,n=t.assertThisInitialized},function(t){r=t.cclegacy,s=t._decorator,a=t.Node,l=t.CCFloat,c=t.v3,u=t.Sprite,h=t.Vec3,d=t.Component},function(t){_=t.Global},function(t){m=t.Logger},function(t){g=t.ResourcePool},function(t){p=t.EnemyAction},function(t){f=t.default},function(t){v=t.Tools},function(t){y=t.GAME_STATE}],execute:function(){var b,D,w,E,A,P,B,T,R;r._RF.push({},"0009fRt5F1DU5c+IqWrLQ1U","Bullet200Action",void 0);var S=s.ccclass,x=s.property;t("Bullet200Action",(b=S("Bullet200Action"),D=x(a),w=x(a),E=x({type:l,tooltip:"子弹从起点开始的最大飞行距离（像素）"}),b((B=e((P=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),s=0;s<i;s++)r[s]=arguments[s];return e=t.call.apply(t,[this].concat(r))||this,o(e,"show_node",B,n(e)),o(e,"collider_",T,n(e)),e.moveSpeed=1e3,e.damage=1,o(e,"maxTravelDistance",R,n(e)),e._moveDirection=c(),e._targetEnemy=null,e.startPosition=c(),e}i(e,t);var r=e.prototype;return r.init=function(t,e,i,o){this.startPosition.set(t),this.init_data(i,o),this.node.setWorldPosition(t),this.node.active=!0,this._targetEnemy=e,this.update_arrow_()},r.update_arrow_=function(){if(this._targetEnemy){var t=this._targetEnemy.getWorldPosition().clone().subtract(this.startPosition);if(this._moveDirection.set(t).normalize(),this.show_node){var e=180*Math.atan2(t.y,t.x)/Math.PI+90;this.show_node.setRotationFromEuler(0,0,e),this.show_node.setScale(1,1,1)}}},r.init_data=function(t,e){var i=t+e,o=_.get_bullet_config(t,i);this.damage=o.damage,this.moveSpeed=o.move_speed;var n=this.show_node.getComponent(u);if(n){var r=f.instance.get_ui("bullet_"+i);r&&(n.spriteFrame=r)}},r.update=function(t){if(this.node.active&&_.get_game_state()==y.START)if(this.checkDistanceAndDestroy(),this._targetEnemy&&this._targetEnemy.active){this.move(t);var e=this._targetEnemy.getComponent(p);e&&v.checkRectIntersection(this.collider_,e.collider_)&&e&&(e.takeDamage(this.damage),this.destroyBullet())}else this.destroyBullet()},r.move=function(t){this.update_arrow_();var e=this.moveSpeed*t,i=new h;h.multiplyScalar(i,this._moveDirection,e),this.node.translate(i)},r.checkDistanceAndDestroy=function(){this.node.getWorldPosition().clone().subtract(this.startPosition).length()>this.maxTravelDistance&&(m.log("Bullet200: Max distance reached, destroying."),this.destroyBullet())},r.destroyBullet=function(){this.node.active&&(this.node.active=!1,this._targetEnemy=null,g.instance?g.instance.remove_node(this.node):this.node.destroy())},e}(d)).prototype,"show_node",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),T=e(P.prototype,"collider_",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),R=e(P.prototype,"maxTravelDistance",[E],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 300}}),A=P))||A));r._RF.pop()}}}));

System.register("chunks:///_virtual/Bullet300Action.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Global.ts","./ResourcePool.ts","./EnemyAction.ts","./ResourceManger.ts","./Tools.ts","./Enums.ts"],(function(t){var e,i,o,n,r,a,s,l,c,u,h,d,m,p,_,f,v,g;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,o=t.initializerDefineProperty,n=t.assertThisInitialized},function(t){r=t.cclegacy,a=t._decorator,s=t.Node,l=t.CCFloat,c=t.v3,u=t.Sprite,h=t.Vec3,d=t.Component},function(t){m=t.Global},function(t){p=t.ResourcePool},function(t){_=t.EnemyAction},function(t){f=t.default},function(t){v=t.Tools},function(t){g=t.GAME_STATE}],execute:function(){var y,b,A,D,w,E,T,P,B,R,z;r._RF.push({},"624e5zWk+5BzLHR8MCcRHEs","Bullet300Action",void 0);var S=a.ccclass,x=a.property;t("Bullet300Action",(y=S("Bullet300Action"),b=x(s),A=x(s),D=x({type:l,tooltip:"弩箭从起点开始的最大飞行距离（像素）"}),w=x({type:l,tooltip:"弩箭头部相对于垂直方向的最大倾斜角度（度）"}),y((P=e((T=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),a=0;a<i;a++)r[a]=arguments[a];return e=t.call.apply(t,[this].concat(r))||this,o(e,"show_node",P,n(e)),o(e,"collider_",B,n(e)),e.moveSpeed=1500,e.damage=1,o(e,"maxTravelDistance",R,n(e)),o(e,"maxTiltAngle",z,n(e)),e._startPosition=c(),e._moveDirection=c(),e._targetEnemy=void 0,e}i(e,t);var r=e.prototype;return r.init=function(t,e,i,o,n){this.init_data(o,n),this.node.setWorldPosition(t),this._targetEnemy=e;var r=e.getWorldPosition();this._startPosition.set(t);var a=r.clone().subtract(t);if(this._moveDirection.set(a).normalize(),this.show_node){var s=180*Math.atan2(a.y,a.x)/Math.PI+90;this.show_node.setRotationFromEuler(0,0,s),this.show_node.setScale(1,1,1)}},r.init_data=function(t,e){var i=t+e,o=m.get_bullet_config(t,i);this.damage=o.damage,this.moveSpeed=o.move_speed;var n=this.show_node.getComponent(u);if(n){var r=f.instance.get_ui("bullet_"+i);r&&(n.spriteFrame=r)}},r.destroyBullet=function(){this.node.active&&(this.node.active=!1,p.instance?p.instance.remove_node(this.node):this.node.destroy())},r.start=function(){},r.update=function(t){if(this.node.active&&m.get_game_state()==g.START){this.move(t),this._targetEnemy&&this._targetEnemy.active?this.checkDistanceAndDestroy():this.destroyBullet();var e=this._targetEnemy.getComponent(_);e&&v.checkRectIntersection(this.collider_,e.collider_)&&e&&(e.takeDamage(this.damage),this.destroyBullet())}},r.move=function(t){var e=this.moveSpeed*t,i=new h;h.multiplyScalar(i,this._moveDirection,e),this.node.translate(i)},r.checkDistanceAndDestroy=function(){this.node.getWorldPosition().clone().subtract(this._startPosition).length()>this.maxTravelDistance&&this.destroyBullet()},e}(d)).prototype,"show_node",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),B=e(T.prototype,"collider_",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),R=e(T.prototype,"maxTravelDistance",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 600}}),z=e(T.prototype,"maxTiltAngle",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 15}}),E=T))||E));r._RF.pop()}}}));

System.register("chunks:///_virtual/BuyItemAction.ts",["./rollupPluginModLoBabelHelpers.js","cc","./ResourceManger.ts","./AudioManager.ts","./EventsManager.ts","./Enums.ts","./XStorage.ts","./TipsManagerAction.ts","./TipsAction.ts","./CrazyAdManger.ts"],(function(t){var e,i,n,s,o,a,r,c,u,l,p,_,y,h,b,g,d,f,m,v;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,n=t.initializerDefineProperty,s=t.assertThisInitialized},function(t){o=t.cclegacy,a=t._decorator,r=t.Sprite,c=t.Node,u=t.Label,l=t.UITransform,p=t.Size,_=t.Component},function(t){y=t.default},function(t){h=t.AudioManager},function(t){b=t.EventsManager},function(t){g=t.EventTyps},function(t){d=t.XStorage},function(t){f=t.TipsManagerAction},function(t){m=t.TIPS_TYPE},function(t){v=t.CrazyAdManger}],execute:function(){var A,I,w,M,T,z,E,B,S,C,P;o._RF.push({},"c96556t7e9GVKBOmrR4K5wU","BuyItemAction",void 0);var R=a.ccclass,N=a.property;t("BuyItemAction",(A=R("BuyItemAction"),I=N(r),w=N(c),M=N(c),T=N(u),A((B=e((E=function(t){function e(){for(var e,i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return e=t.call.apply(t,[this].concat(o))||this,n(e,"item_sprite",B,s(e)),n(e,"coin",S,s(e)),n(e,"video",C,s(e)),n(e,"cost_label",P,s(e)),e.base_type=0,e.step=0,e.buy_item_type=0,e.cost=0,e.index=0,e.buy_storage_data=void 0,e}i(e,t);var o=e.prototype;return o.start=function(){},o.update=function(t){},o.init=function(t){this.buy_storage_data=t,this.buy_item_type=t.buy_type,this.cost=t.cost,this.base_type=t.base_type,this.step=t.step,this.index=t.index,this.reset_style()},o.get_cell_type=function(){return this.base_type+this.step},o.reset_style=function(){var t=y.instance.get_ui("cell_"+this.get_cell_type());switch(t&&(this.item_sprite.spriteFrame=t,this.item_sprite.node.getComponent(l).setContentSize(new p(70,70))),this.buy_item_type){case 1:this.coin.active=!1,this.video.active=!0,this.cost_label.string="";break;default:this.coin.active=!0,this.video.active=!1,this.cost_label.string=this.cost+""}},o.on_click_buy=function(){var t=this;switch(h.instance.play_shot("menuclose"),this.buy_item_type){case 0:var e=d.get_cur_coins(),i=this.cost;e>=i?(d.record_coins(e-i),b.Ins.emit(g.UPDATE_COIN),b.Ins.emit(g.BUY_ITEM,this.buy_storage_data)):f.show("Not Enough Gold",m.WARN);break;case 1:v.show_video((function(e){1==e?b.Ins.emit(g.BUY_ITEM,t.buy_storage_data):f.show("Watch Video to Purchase",m.WARN)}))}},e}(_)).prototype,"item_sprite",[I],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),S=e(E.prototype,"coin",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),C=e(E.prototype,"video",[M],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),P=e(E.prototype,"cost_label",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),z=E))||z));o._RF.pop()}}}));

System.register("chunks:///_virtual/BuyShowAction.ts",["./rollupPluginModLoBabelHelpers.js","cc","./ResourcePool.ts","./XStorage.ts","./BuyItemAction.ts","./EventsManager.ts","./Enums.ts","./Logger.ts","./Global.ts","./Tools.ts","./TipsManagerAction.ts","./TipsAction.ts"],(function(t){var e,n,o,i,r,s,a,u,_,c,l,h,y,f,b,p,g,d,m,v,w;return{setters:[function(t){e=t.applyDecoratedDescriptor,n=t.inheritsLoose,o=t.initializerDefineProperty,i=t.assertThisInitialized,r=t.asyncToGenerator,s=t.regeneratorRuntime},function(t){a=t.cclegacy,u=t._decorator,_=t.Node,c=t.Label,l=t.Component},function(t){h=t.ResourcePool},function(t){y=t.XStorage},function(t){f=t.BuyItemAction},function(t){b=t.EventsManager},function(t){p=t.EventTyps},function(t){g=t.Logger},function(t){d=t.Global},function(t){m=t.Tools},function(t){v=t.TipsManagerAction},function(t){w=t.TIPS_TYPE}],execute:function(){var E,A,T,M,B,S,I;a._RF.push({},"f078dVnVA9GQYE1xj42RrGM","BuyShowAction",void 0);var R=u.ccclass,x=u.property;t("BuyShowAction",(E=R("BuyShowAction"),A=x(_),T=x(c),E((S=e((B=function(t){function e(){for(var e,n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return e=t.call.apply(t,[this].concat(r))||this,o(e,"buy_show",S,i(e)),o(e,"buy_label",I,i(e)),e}n(e,t);var a=e.prototype;return a.onLoad=function(){b.Ins.addListener(p.BUY_ITEM,this.event_buy_item,this)},a.start=function(){},a.update=function(t){},a.init=function(){this.buy_label.string=d.REFRESH_BUY_ITEM+"";var t=m.getTodayDateString(),e=y.get_last_buy_list_date();e&&e===t?g.log("BuyShowAction: 仍是今天，沿用现有购买列表。"):(g.log("BuyShowAction: 跨天，刷新每日购买列表。"),this.refresh_buy_item(),y.record_last_buy_list_date()),this._show_can_buy_item()},a._show_can_buy_item=function(){var t=r(s().mark((function t(){var e,n,o,i;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.clear_buy_show(),(e=y.get_buy_item_list())&&!(e.length<=0)){t.next=4;break}return t.abrupt("return");case 4:n=0;case 5:if(!(n<e.length)){t.next=15;break}return o=e[n],t.next=9,h.instance.create_by_Pool("Buy_item",null,this.buy_show,!1);case 9:i=t.sent,i.getComponent(f).init(o);case 12:n++,t.next=5;break;case 15:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),a.refresh_buy_item=function(){for(var t=[],e=d.cell_type_arr,n=!1,o=!1,i=0;i<100;){t=[],n=!1,o=!1;for(var r=0;r<3;r++){var s=e[m.random_between_floor(0,e.length)],a=void 0,u=void 0,_=void 0,c=Math.random();0===(a=c<=.5?0:c<=.95?1:2)?(_=100,u=Math.random()>.7?1:0):1===a?(_=300,u=Math.random()>.5?1:0):(_=900,u=Math.random()>.3?1:0),d.is_review_model?u=0:1===u&&(_=1),0===u?n=!0:1===u&&(o=!0),t.push({index:r,base_type:s,step:a,buy_type:u,cost:_})}if(i++,d.is_review_model)break;if(n&&o)break}y.record_buy_item_list(t)},a.clear_buy_show=function(){for(var t=this.buy_show.children.slice(),e=0;e<t.length;e++)h.instance.remove_node(t[e])},a.event_buy_item=function(t){if(t){var e=t.index,n=y.get_buy_item_list();if(n&&!(n.length<=0)){for(var o=[],i=0;i<n.length;i++){var r=n[i];r.index!=e&&o.push(r)}y.record_buy_item_list(o),0==o.length&&this.refresh_buy_item(),this._show_can_buy_item(),b.Ins.emit(p.ADD_NEW_ITEM,t)}}else g.error("错误够卖",t)},a.on_click_refresh=function(){var t=y.get_cur_coins(),e=d.REFRESH_BUY_ITEM;t>=e?(y.record_coins(t-e),b.Ins.emit(p.UPDATE_COIN),g.log("刷新购买商品"),this.refresh_buy_item(),this._show_can_buy_item()):v.show("Not Enough Gold",w.WARN)},e}(l)).prototype,"buy_show",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),I=e(B.prototype,"buy_label",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),M=B))||M));a._RF.pop()}}}));

System.register("chunks:///_virtual/BytePlantform.ts",["./rollupPluginModLoBabelHelpers.js","cc","./env","./Global.ts","./Logger.ts"],(function(n){var t,e,i,o,l,s,a,r;return{setters:[function(n){t=n.inheritsLoose,e=n.createClass},function(n){i=n.cclegacy,o=n._decorator,l=n.Component},function(n){s=n.BYTEDANCE},function(n){a=n.Global},function(n){r=n.Logger}],execute:function(){var c,u;i._RF.push({},"747b9Tr6j1BloW9CypfSub7","BytePlantform",void 0);var h=o.ccclass;o.property,n("BytePlantform",h("BytePlantform")(((u=function(n){function i(){for(var t,e=arguments.length,i=new Array(e),o=0;o<e;o++)i[o]=arguments[o];return(t=n.call.apply(n,[this].concat(i))||this).tt=window.tt,t.banner=void 0,t.banner_show_status=!1,t}t(i,n);var o=i.prototype;return o.is_douyin=function(){return s},o.listen_douyin=function(n,t){if(this.is_douyin()){this.tt.onShow((function(e){r.log("onShow data  res:",e),"021036"===e.scene?null==n||n.call(t,!0):null==n||n.call(t,!1)}));var e=this.tt.getLaunchOptionsSync();e&&"021036"===e.scene&&(null==n||n.call(t,!0))}else null==n||n.call(t,!1)},o.check_side_bar=function(n,t){this.is_douyin()?this.tt.checkScene({scene:"sidebar",success:function(e){r.log("check scene success: ",e,e.isExist),null==n||n.call(t,e.isExist)},fail:function(e){r.log("check scene fail:",e,e),null==n||n.call(t,!1)}}):null==n||n.call(t,!1)},o.navigate_to_douyin=function(n,t){if(!this.is_douyin())return r.log("not douyin platform!"),void(null==n||n.call(t,!1));this.tt.navigateToScene({scene:"sidebar",success:function(){r.log("navigate success"),null==n||n.call(t,!0)},fail:function(e){r.log("navigate failed reason:",e),null==n||n.call(t,!1)}})},o.bytedance_setting=function(){r.log("BYTEDANCE_setting",s)},o.show_interstitial=function(n){if(a.ad_intersitial_arr&&0!==a.ad_intersitial_arr.length){var t="",e=a.ad_intersitial_arr,i=e.length,o=n;if((n<0||n>=i)&&(o=0,r.warn("传入的 ad_index ("+n+") 超出范围 [0, "+(i-1)+"]，已使用默认索引 "+o+" (第一个ID)")),t=e[o],r.log("准备加载插屏广告，传入索引: "+n+", 实际索引: "+o+", ID: "+t),t){r.log("显示插屏广告》〉》〉》〉》〉》〉》〉》",t);var l=this.tt.createInterstitialAd({adUnitId:t.trim()});l&&(l.load().then((function(){l.show().then((function(){r.log("插屏广告展示成功")}))})).catch((function(n){r.log(n)})),setTimeout((function(){l.show().catch((function(n){r.log("插屏广告展示失败",n)}))}),1e3))}else r.error("获取到的插屏广告ID为空，中断加载。")}else r.log("插屏广告，没配置 Global里配置")},o.ShowAdvertisements=function(n){var t,e,i=a.ad_video_id;r.log("显示视频广告》〉》〉》〉》〉》〉》〉》",i);var o=this.tt.createRewardedVideoAd({adUnitId:i.trim()});o.onClose((function t(e){e.isEnded?(n(1),r.log("注销广告关闭监听1 "),o.offClose(t)):(r.log("注销广告关闭监听0 "),n(0))})),null==(t=o.show())||t.then((function(){r.log("视频广告展示")})),null==(e=o.onError())||e.then((function(){r.log("广告无法播放"),n(2)}))},o.hide_banner=function(){this.banner_show_status=!1,null!=this.banner&&(this.banner.destroy(),this.banner=null,r.log("关闭 banner..."))},o.show_banner=function(n){var t=this;if(null!=this.banner)return this.banner.destroy(),void(this.banner=null);this.banner_show_status=!0;var e=a.ad_banner_id,i=this.tt.getSystemInfoSync(),o=i.windowWidth,l=i.windowHeight;r.log("showBanner start ad_banner_id::",e.trim(),o,l);var s=this.tt.getSystemInfoSync(),c=s.windowWidth,u=s.windowHeight,h=this.tt.createBannerAd({adUnitId:e.trim(),style:{width:200,top:0}});h.style.left=(c-200)/2,h.onResize((function(n){r.log(n.width,n.height),h.style.top=u-n.height,h.style.left=(c-n.width)/2}));var d=this;h.onLoad((function(){r.log("banner 222 广告加载成功"),t.banner=h,t.banner_show_status?h.show().then((function(){r.log("广告显示成功"),setTimeout((function(){d.hide_banner(),r.log("广告隐藏")}),2e3)})).catch((function(n){r.log("广告组件出现问题",n)})):(r.log("错误出发，关闭bannner"),t.hide_banner())})),h.onError((function(n){r.log("banner 广告加载错误",n)}))},e(i,null,[{key:"ins",get:function(){return this._ins||(this._ins=new i),this._ins}}]),i}(l))._ins=void 0,c=u))||c);i._RF.pop()}}}));

System.register("chunks:///_virtual/CastleAction.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Global.ts","./ResourcePool.ts","./Logger.ts","./Cell600Action.ts","./Enums.ts","./EventsManager.ts","./XStorage.ts"],(function(t){var e,r,o,n,i,a,s,l,c,_,u,w,p,h,f,g,d,v,b,y,m;return{setters:[function(t){e=t.applyDecoratedDescriptor,r=t.inheritsLoose,o=t.initializerDefineProperty,n=t.assertThisInitialized,i=t.asyncToGenerator,a=t.regeneratorRuntime,s=t.createForOfIteratorHelperLoose},function(t){l=t.cclegacy,c=t._decorator,_=t.Node,u=t.tween,w=t.v3,p=t.Component,h=t.Vec3},function(t){f=t.Global},function(t){g=t.ResourcePool},function(t){d=t.Logger},function(t){v=t.Cell600Action},function(t){b=t.EventTyps},function(t){y=t.EventsManager},function(t){m=t.XStorage}],execute:function(){var P,C,A,E,L,R,x,k,T,S,z;l._RF.push({},"794345LT4JHL4jhLesR3dUB","CastleAction",void 0);var I=c.ccclass,F=c.property;t("CastleAction",(P=I("CastleAction"),C=F(_),A=F(_),E=F(_),L=F(_),P((k=e((x=function(t){function e(){for(var e,r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i))||this,o(e,"collider",k,n(e)),o(e,"left_arrow_tower",T,n(e)),o(e,"right_arrow_tower",S,n(e)),o(e,"castle",z,n(e)),e}r(e,t);var l=e.prototype;return l.onLoad=function(){f.castle_action=this,y.Ins.addListener(b.ATTACK_CASTLE,this.play_castle_tween,this)},l.play_castle_tween=function(){var t=this;if(this.castle){u(this.castle).stop(),this.castle.setPosition(w(0,0,0));for(var e=.04,r=u(this.castle),o=0;o<3;o++)r.to(e,{position:w(4,4)}).to(e,{position:w(-4,-4)}).to(e,{position:w(0,0)});r.call((function(){t.castle.setPosition(w(0,0,0))})).start()}else d.error("Castle node is null!")},l.start=function(){},l.update=function(t){},l.clear_arrow_tower=function(){this.clear_left_arrow_tower(),this.clear_right_arrow_tower(),d.log("清理箭塔完成")},l.clear_left_arrow_tower=function(){for(var t=this.left_arrow_tower.children.slice(),e=0;e<t.length;e++)g.instance.remove_node(t[e])},l.clear_right_arrow_tower=function(){for(var t=this.right_arrow_tower.children.slice(),e=0;e<t.length;e++)g.instance.remove_node(t[e])},l.save_arrow_towers=function(){var t=[];if(this.left_arrow_tower.children.length>0){var e=this.left_arrow_tower.children[0].getComponent(v);e&&t.push({base_type:e.base_type,step:e.step,position:"left"})}if(this.right_arrow_tower.children.length>0){var r=this.right_arrow_tower.children[0].getComponent(v);r&&t.push({base_type:r.base_type,step:r.step,position:"right"})}m.record_arrow_towers(t)},l.load_arrow_towers=function(){var t=i(a().mark((function t(e){var r,o,n,i,l,c,_,u,p;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.clear_arrow_tower(),r=m.get_arrow_towers(),o=[],n=s(r);case 4:if((i=n()).done){t.next=18;break}return l=i.value,c="left"===l.position?this.left_arrow_tower:this.right_arrow_tower,_=600,t.next=10,g.instance.create_by_Pool(f.CELL_PREFAB_NAME+_,null,c,!1);case 10:(u=t.sent).setPosition(h.ZERO),u.setScale(w(1,1,1)),(p=u.getComponent(v))&&(p.init_base_cell(e,0,l.base_type,l.step),p.arrow_type=_),o.push(Promise.resolve());case 16:t.next=4;break;case 18:return t.next=20,Promise.all(o);case 20:d.log("CastleAction: 成功加载 "+r.length+" 个箭塔。");case 21:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}(),l.add_arrow_tower=function(){var t=i(a().mark((function t(e,r,o,n){var i,s,l,c,_,p,b,y,m;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return d.log("添加箭塔:",r,o,n),s=this.left_arrow_tower.worldPosition,l=this.right_arrow_tower.worldPosition,c=h.distance(r,s),_=h.distance(r,l),c<_?(i=this.left_arrow_tower,this.clear_left_arrow_tower()):(i=this.right_arrow_tower,this.clear_right_arrow_tower()),p=600,t.next=9,g.instance.create_by_Pool(f.CELL_PREFAB_NAME+p,null,i,!1);case 9:return(b=t.sent).setPosition(h.ZERO),b.setScale(w(0,0,0)),(y=b.getComponent(v))&&(y.init_base_cell(e,0,o,n),y.arrow_type=p),m=new Promise((function(t){u(b).to(.3,{scale:w(1,1,1)},{easing:"backOut"}).call((function(){return t()})).start()})),t.next=17,m;case 17:return this.save_arrow_towers(),t.abrupt("return",m);case 19:case"end":return t.stop()}}),t,this)})));return function(e,r,o,n){return t.apply(this,arguments)}}(),l.on_click_show_tips=function(){var t=i(a().mark((function t(){return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:y.Ins.emit(b.REVIEW_TIPS_DRAG);case 1:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),e}(p)).prototype,"collider",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),T=e(x.prototype,"left_arrow_tower",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),S=e(x.prototype,"right_arrow_tower",[E],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),z=e(x.prototype,"castle",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),R=x))||R));l._RF.pop()}}}));

System.register("chunks:///_virtual/Cell100Action.ts",["./rollupPluginModLoBabelHelpers.js","cc","./CellAction.ts","./Global.ts","./ResourcePool.ts","./Logger.ts","./Bullet100Action.ts","./EnemyAction.ts","./AudioManager.ts","./Enums.ts","./ToolsEnemy.ts"],(function(t){var e,n,i,o,r,a,s,l,c,h,g,u,_,f,m,p,y,d,v,A,b,D;return{setters:[function(t){e=t.applyDecoratedDescriptor,n=t.inheritsLoose,i=t.initializerDefineProperty,o=t.assertThisInitialized,r=t.createForOfIteratorHelperLoose,a=t.asyncToGenerator,s=t.regeneratorRuntime},function(t){l=t.cclegacy,c=t._decorator,h=t.Node,g=t.CCFloat,u=t.UITransform,_=t.v3},function(t){f=t.CellAction},function(t){m=t.Global},function(t){p=t.ResourcePool},function(t){y=t.Logger},function(t){d=t.Bullet100Action},function(t){v=t.EnemyAction},function(t){A=t.AudioManager},function(t){b=t.GAME_STATE},function(t){D=t.ToolsEnemy}],execute:function(){var z,T,E,S,P,w,C,x,R,X,M,W,B;l._RF.push({},"25de8B9j9tFW4XOnyL0xRDl","Cell100Action",void 0);var F=c.ccclass,H=c.property;t("Cell100Action",(z=F("Cell100Action"),T=H(h),E=H({type:g,tooltip:"大炮横向瞄准的垂直容忍度（Y轴范围）"}),S=H({type:g,tooltip:"炮弹飞行的弧线高度（最大提升距离）"}),P=H({type:g,tooltip:"炮弹从发射到击中目标所需的时间"}),w=H({type:g,tooltip:"大炮瞄准时的旋转速度（度/秒）"}),z((R=e((x=function(t){function e(){for(var e,n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return e=t.call.apply(t,[this].concat(r))||this,i(e,"muzzle",R,o(e)),e.shootInterval=1,i(e,"verticalTolerance",X,o(e)),i(e,"arcHeight",M,o(e)),i(e,"flightDuration",W,o(e)),i(e,"rotationSpeed",B,o(e)),e._shootTimer=0,e._cellHeight=0,e._targetAngleDeg=0,e._currentAngleDeg=0,e._targetScaleX=1,e}n(e,t);var l=e.prototype;return l.onLoad=function(){t.prototype.onLoad.call(this);var e=this.getComponent(u);e&&(this._cellHeight=e.height,this.verticalTolerance=this._cellHeight/2),this._currentAngleDeg=0},l.init_cell=function(){t.prototype.init_cell.call(this);var e=m.get_cell_config(this.base_type,this.get_cell_type());this.shootInterval=e.shoot_timer,this._shootTimer=this.shootInterval,this.muzzle&&this.show_for_node||y.error("Cell100Action: muzzle 或 cannon_sprite 节点未设置!"),y.log("大炮角度：",this._currentAngleDeg),this._currentAngleDeg=0,this.show_for_node&&(this.show_for_node.setRotationFromEuler(0,0,this._currentAngleDeg),this.show_for_node.setScale(1,1,1))},l.update=function(t){m.game_logic_action.isProcessing||m.get_game_state()==b.START&&(this._shootTimer+=t,this.aimAndShoot(t))},l.aimAndShoot=function(t){var e,n=null==(e=m.game_enemy_layer_action)?void 0:e.node;if(n&&this.show_for_node){var i=!1;if(this._targetEnemy){var o=this._targetEnemy.getComponent(v);this._targetEnemy.isValid&&this._targetEnemy.active&&!(o.get_current_hp()<=0)&&this.isTargetStillValid(this._targetEnemy)||(this._targetEnemy=null,i=!0)}else i=!0;if(i&&(this._targetEnemy=this.findTarget(n)),this._targetEnemy){var r=this._targetEnemy.getWorldPosition();this.calculateAimParams(r),this.smoothRotateCannon(t),this._shootTimer>=this.shootInterval&&(this.shootBullet(r),this._shootTimer=0)}else this._targetScaleX=1,this._targetAngleDeg=0,this.smoothRotateCannon(t),this.show_for_node.setScale(this._targetScaleX,1,1)}else this._targetEnemy=null},l.isTargetStillValid=function(t){var e=this.node.getWorldPosition().y,n=t.getWorldPosition(),i=t.getComponent(u),o=0;return i&&(o=i.height/2),Math.abs(n.y-e)<=this.verticalTolerance+o},l.calculateAimParams=function(t){if(this.muzzle){var e=this.muzzle.getWorldPosition(),n=t.clone().subtract(e);if(n.length()<=100)return this._targetScaleX=1,void(this._targetAngleDeg=this._currentAngleDeg);var i=180*Math.atan2(n.y,n.x)/Math.PI;n.x<0?(this._targetScaleX=1,this._targetAngleDeg=i-180):(this._targetScaleX=-1,this._targetAngleDeg=i)}},l.smoothRotateCannon=function(t){if(this.show_for_node){var e=function(t,e){for(var n=e-t;n>180;)n-=360;for(;n<=-180;)n+=360;return n}(this._currentAngleDeg,this._targetAngleDeg),n=this.rotationSpeed*t;Math.abs(e)<=n?this._currentAngleDeg=this._targetAngleDeg:e>0?this._currentAngleDeg+=n:this._currentAngleDeg-=n,this.show_for_node.setRotationFromEuler(0,0,this._currentAngleDeg),this.show_for_node.setScale(this._targetScaleX,1,1)}},l.findTarget=function(t){this.node.getWorldPosition().y;for(var e,n=[],i=r(t.children);!(e=i()).done;){var o=e.value;if(o.active){var a=o.getComponent(v);if(a&&!(a.get_current_hp()<=0)&&this.isTargetStillValid(o)){var s=Math.abs(o.getWorldPosition().x-this.node.getWorldPosition().x);n.push({distanceX:s,enemy:o})}}}return 0==n.length?null:1==n.length?n[0].enemy:(n.sort((function(t,e){return e.distanceX-t.distanceX})),D.get_enemy(this.node,n))},l.shootBullet=function(){var t=a(s().mark((function t(e){var n,i,o,r,a,l,c,h;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.muzzle&&this._targetEnemy){t.next=2;break}return t.abrupt("return");case 2:return n=this.muzzle.getWorldPosition(),i=this._targetEnemy.getWorldPosition(),o=(n.x+i.x)/2,r=Math.max(n.y,i.y)+this.arcHeight,a=_(o,r,0),l="bullet_"+this.base_type,t.prev=8,t.next=11,p.instance.create_by_Pool(l,n,m.game_enemy_layer_action.node,!1);case 11:c=t.sent,(h=c.getComponent(d))?(h.init(this._targetEnemy,n,a,i,this.flightDuration,this.base_type,this.step),A.instance.play_shot("cannonshoot")):(y.error("Bullet prefab "+l+" missing Bullet100Action component!"),p.instance.remove_node(c)),t.next=19;break;case 16:t.prev=16,t.t0=t.catch(8),y.error("Failed to create bullet "+l+":",t.t0);case 19:case"end":return t.stop()}}),t,this,[[8,16]])})));return function(e){return t.apply(this,arguments)}}(),e}(f)).prototype,"muzzle",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),X=e(x.prototype,"verticalTolerance",[E],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 30}}),M=e(x.prototype,"arcHeight",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 150}}),W=e(x.prototype,"flightDuration",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),B=e(x.prototype,"rotationSpeed",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 20}}),C=x))||C));l._RF.pop()}}}));

System.register("chunks:///_virtual/Cell200Action.ts",["./rollupPluginModLoBabelHelpers.js","cc","./CellAction.ts","./Global.ts","./ResourcePool.ts","./Logger.ts","./EnemyAction.ts","./Bullet200Action.ts","./AudioManager.ts","./Enums.ts","./ToolsEnemy.ts"],(function(t){var e,n,o,i,r,a,s,l,c,u,h,p,m,g,_,f,y,d,v,b;return{setters:[function(t){e=t.applyDecoratedDescriptor,n=t.inheritsLoose,o=t.initializerDefineProperty,i=t.assertThisInitialized,r=t.createForOfIteratorHelperLoose,a=t.asyncToGenerator,s=t.regeneratorRuntime},function(t){l=t.cclegacy,c=t._decorator,u=t.Node,h=t.CCFloat},function(t){p=t.CellAction},function(t){m=t.Global},function(t){g=t.ResourcePool},function(t){_=t.Logger},function(t){f=t.EnemyAction},function(t){y=t.Bullet200Action},function(t){d=t.AudioManager},function(t){v=t.GAME_STATE},function(t){b=t.ToolsEnemy}],execute:function(){var A,z,E,T,C,P,R;l._RF.push({},"73c19Ak/C9En7Vs2PauVrNE","Cell200Action",void 0);var k=c.ccclass,B=c.property;t("Cell200Action",(A=k("Cell200Action"),z=B(u),E=B({type:h,tooltip:"攻击圆形半径 (像素)"}),A((P=e((C=function(t){function e(){for(var e,n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return e=t.call.apply(t,[this].concat(r))||this,o(e,"muzzle",P,i(e)),e.shootInterval=.8,o(e,"attackRadius",R,i(e)),e._shootTimer=0,e}n(e,t);var l=e.prototype;return l.onLoad=function(){t.prototype.onLoad.call(this)},l.init_cell=function(){t.prototype.init_cell.call(this);var e=m.get_cell_config(this.base_type,this.get_cell_type());this.shootInterval=e.shoot_timer,this._shootTimer=this.shootInterval,this.muzzle||_.error("Cell200Action: muzzle 节点未设置!")},l.update=function(t){m.game_logic_action.isProcessing||m.get_game_state()==v.START&&(this._shootTimer+=t,this.aimAndShoot())},l.aimAndShoot=function(){var t,e=null==(t=m.game_enemy_layer_action)?void 0:t.node;if(e){if(this._targetEnemy=this.findTarget(e),this._targetEnemy){var n=this._targetEnemy.getWorldPosition();this._shootTimer>=this.shootInterval&&(this.shootBullet(n),this._shootTimer=0)}}else this._targetEnemy=null},l.findTarget=function(t){for(var e,n=this.attackRadius*this.attackRadius,o=this.node.getWorldPosition(),i=[],a=r(t.children);!(e=a()).done;){var s=e.value;if(s.active&&(s.getComponent(f)&&!(s.getComponent(f).get_current_hp()<=0))){var l=s.getWorldPosition(),c=o.clone().subtract(l).lengthSqr();c<=n&&i.push({distanceX:c,enemy:s})}}return 0==i.length?null:1==i.length?i[0].enemy:(i.sort((function(t,e){return t.distanceX-e.distanceX})),b.get_enemy(this.node,i))},l.shootBullet=function(){var t=a(s().mark((function t(e){var n,o,i,r;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.muzzle&&this._targetEnemy){t.next=2;break}return t.abrupt("return");case 2:return n=this.muzzle.getWorldPosition(),o="bullet_"+this.base_type,t.prev=4,t.next=7,g.instance.create_by_Pool(o,n,m.game_enemy_layer_action.node,!1);case 7:i=t.sent,(r=i.getComponent(y))?(r.init(n,this._targetEnemy,this.base_type,this.step),d.instance.play_shot("bowshoot")):(_.error("Bullet prefab "+o+" missing Bullet201Action component!"),g.instance.remove_node(i)),t.next=15;break;case 12:t.prev=12,t.t0=t.catch(4),_.error("Failed to create bullet "+o+":",t.t0);case 15:case"end":return t.stop()}}),t,this,[[4,12]])})));return function(e){return t.apply(this,arguments)}}(),e}(p)).prototype,"muzzle",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),R=e(C.prototype,"attackRadius",[E],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 155}}),T=C))||T));l._RF.pop()}}}));

System.register("chunks:///_virtual/Cell300Action.ts",["./rollupPluginModLoBabelHelpers.js","cc","./CellAction.ts","./Global.ts","./ResourcePool.ts","./Logger.ts","./Bullet300Action.ts","./EnemyAction.ts","./AudioManager.ts","./Enums.ts","./ToolsEnemy.ts"],(function(t){var e,o,i,n,r,s,a,l,c,u,h,_,f,p,g,d,y,m,b,v,z;return{setters:[function(t){e=t.applyDecoratedDescriptor,o=t.inheritsLoose,i=t.initializerDefineProperty,n=t.assertThisInitialized,r=t.createForOfIteratorHelperLoose,s=t.asyncToGenerator,a=t.regeneratorRuntime},function(t){l=t.cclegacy,c=t._decorator,u=t.Node,h=t.CCFloat,_=t.UITransform},function(t){f=t.CellAction},function(t){p=t.Global},function(t){g=t.ResourcePool},function(t){d=t.Logger},function(t){y=t.Bullet300Action},function(t){m=t.EnemyAction},function(t){b=t.AudioManager},function(t){v=t.GAME_STATE},function(t){z=t.ToolsEnemy}],execute:function(){var A,T,w,E,C,P,R,L,k,x,B,I,S,F,M;l._RF.push({},"2a8d2eQ+VpE7LFrYwOHlfRv","Cell300Action",void 0);var W=c.ccclass,G=c.property;t("Cell300Action",(A=W("Cell300Action"),T=G(u),w=G(u),E=G({type:h,tooltip:"弩箭垂直瞄准的水平容忍度（X轴范围）"}),C=G(u),P=G(u),R=G({type:h,tooltip:"弩箭的垂直攻击距离限制（像素）"}),A((x=e((k=function(t){function e(){for(var e,o=arguments.length,r=new Array(o),s=0;s<o;s++)r[s]=arguments[s];return e=t.call.apply(t,[this].concat(r))||this,i(e,"muzzle",x,n(e)),i(e,"crossbow_sprite",B,n(e)),e.shootInterval=.5,i(e,"horizontalTolerance",I,n(e)),i(e,"ready_node",S,n(e)),i(e,"fight_node",F,n(e)),i(e,"attackRange",M,n(e)),e._shootTimer=0,e._cellWidth=0,e.rotation=1,e}o(e,t);var l=e.prototype;return l.onLoad=function(){t.prototype.onLoad.call(this)},l.init_cell=function(){t.prototype.init_cell.call(this);var e=p.get_cell_config(this.base_type,this.get_cell_type());this.shootInterval=e.shoot_timer,this._shootTimer=this.shootInterval,this.muzzle&&this.crossbow_sprite||d.error("Cell300Action: muzzle 或 crossbow_sprite 节点未设置!"),this.status_ready()},l.status_ready=function(){this.ready_node&&(this.ready_node.active=!0),this.fight_node&&(this.fight_node.active=!1)},l.status_fight=function(){this.ready_node&&(this.ready_node.active=!1),this.fight_node&&(this.fight_node.active=!0)},l.update=function(t){p.game_logic_action.isProcessing||p.get_game_state()==v.START&&(this._shootTimer+=t,this.aimAndShoot())},l.aimAndShoot=function(){var t,e=null==(t=p.game_enemy_layer_action)?void 0:t.node;if(e&&this.crossbow_sprite)if(this._targetEnemy=this.findTarget(e),this._targetEnemy){var o=this._targetEnemy.getWorldPosition();this.aimAtTarget(o),this._shootTimer>=this.shootInterval&&(this.shootBullet(o),this._shootTimer=0)}else this.rotation=1,this.crossbow_sprite.setScale(1,this.rotation,1);else this._targetEnemy=null},l.findTarget=function(t){for(var e,o=[],i=this.node.getWorldPosition(),n=i.x,s=r(t.children);!(e=s()).done;){var a=e.value;if(a.active){var l=a.getComponent(m);if(l&&!(l.get_current_hp()<=0)){var c=a.getWorldPosition(),u=a.getComponent(_);if(u&&u.width,Math.abs(c.x-n)<=this.horizontalTolerance){var h=Math.abs(c.y-i.y);h<=this.attackRange&&o.push({distanceX:h,enemy:a})}}}}return 0==o.length?null:1==o.length?o[0].enemy:(o.sort((function(t,e){return t.distanceX-e.distanceX})),z.get_enemy(this.node,o))},l.aimAtTarget=function(t){if(this.crossbow_sprite&&this.muzzle){var e=this.node.getWorldPosition().y;t.y>e?this.rotation=-1:this.rotation=1,this.crossbow_sprite.setScale(1,this.rotation,1)}},l.shootBullet=function(){var t=s(a().mark((function t(e){var o,i,n,r,s=this;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.muzzle){t.next=2;break}return t.abrupt("return");case 2:return o=this.muzzle.getWorldPosition(),i="bullet_"+this.base_type,t.prev=4,t.next=7,g.instance.create_by_Pool(i,o,p.game_enemy_layer_action.node,!1);case 7:n=t.sent,this.status_fight(),(r=n.getComponent(y))?(r.init(o,this._targetEnemy,this.rotation,this.base_type,this.step),b.instance.play_shot("bowshoot")):(d.error("Bullet prefab "+i+" missing Bullet300Action component!"),g.instance.remove_node(n)),this.scheduleOnce((function(){s.status_ready()}),.2),t.next=17;break;case 14:t.prev=14,t.t0=t.catch(4),d.error("Failed to create bullet "+i+":",t.t0);case 17:case"end":return t.stop()}}),t,this,[[4,14]])})));return function(e){return t.apply(this,arguments)}}(),e}(f)).prototype,"muzzle",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),B=e(k.prototype,"crossbow_sprite",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),I=e(k.prototype,"horizontalTolerance",[E],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 30}}),S=e(k.prototype,"ready_node",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),F=e(k.prototype,"fight_node",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),M=e(k.prototype,"attackRange",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 400}}),L=k))||L));l._RF.pop()}}}));

System.register("chunks:///_virtual/Cell400Action.ts",["./rollupPluginModLoBabelHelpers.js","cc","./CellAction.ts","./Global.ts"],(function(t){var e,o,i,l,n,r,a,c,s;return{setters:[function(t){e=t.applyDecoratedDescriptor,o=t.inheritsLoose,i=t.initializerDefineProperty,l=t.assertThisInitialized},function(t){n=t.cclegacy,r=t._decorator,a=t.CCFloat},function(t){c=t.CellAction},function(t){s=t.Global}],execute:function(){var p,u,f,y,h,_,g;n._RF.push({},"33113Os9ihIx4WKLC7yXhOs","Cell400Action",void 0);var b=r.ccclass,C=r.property;t("Cell400Action",(p=b("Cell400Action"),u=C({type:a,tooltip:"城墙减速的水平容忍度（X轴范围） - 塔中心到边缘的距离"}),f=C({type:a,tooltip:"城墙中心点上下各延伸的减速影响距离"}),p((_=e((h=function(t){function e(){for(var e,o=arguments.length,n=new Array(o),r=0;r<o;r++)n[r]=arguments[r];return e=t.call.apply(t,[this].concat(n))||this,i(e,"horizontalTolerance",_,l(e)),i(e,"slowRangeY",g,l(e)),e.slowRatio=.3,e}o(e,t);var n=e.prototype;return n.onLoad=function(){t.prototype.onLoad.call(this)},n.update=function(t){},n.init_cell=function(){t.prototype.init_cell.call(this);var e=s.get_cell_config(this.base_type,this.get_cell_type());this.slowRatio=e.slow_ratio},e}(c)).prototype,"horizontalTolerance",[u],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 45}}),g=e(h.prototype,"slowRangeY",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 150}}),y=h))||y));n._RF.pop()}}}));

System.register("chunks:///_virtual/Cell500Action.ts",["./rollupPluginModLoBabelHelpers.js","cc","./CellAction.ts","./Logger.ts","./Global.ts","./Enums.ts","./EventsManager.ts","./XStorage.ts","./AudioManager.ts"],(function(t){var e,n,o,i,c,s,l,r,a,p,u,h,_;return{setters:[function(t){e=t.inheritsLoose,n=t.asyncToGenerator,o=t.regeneratorRuntime},function(t){i=t.cclegacy,c=t._decorator,s=t.Node},function(t){l=t.CellAction},function(t){r=t.Logger},function(t){a=t.Global},function(t){p=t.EventTyps},function(t){u=t.EventsManager},function(t){h=t.XStorage},function(t){_=t.AudioManager}],execute:function(){var g;i._RF.push({},"93fb4rjbX1AV4xEbs8NNc51","Cell500Action",void 0);var f=c.ccclass;c.property,t("Cell500Action",f("Cell500Action")(g=function(t){function i(){for(var e,n=arguments.length,o=new Array(n),i=0;i<n;i++)o[i]=arguments[i];return(e=t.call.apply(t,[this].concat(o))||this).swap_count=2,e}e(i,t);var c=i.prototype;return c.onEnable=function(){t.prototype.onEnable.call(this),this.node.off(s.EventType.TOUCH_END,t.prototype.onTouchEndOrCancel,this),this.node.off(s.EventType.TOUCH_CANCEL,t.prototype.onTouchEndOrCancel,this),this.node.on(s.EventType.TOUCH_END,this.onCellActionEnd,this),this.node.on(s.EventType.TOUCH_CANCEL,this.onCellActionEnd,this)},c.onDisable=function(){t.prototype.onDisable.call(this),this.node.off(s.EventType.TOUCH_END,this.onCellActionEnd,this),this.node.off(s.EventType.TOUCH_CANCEL,this.onCellActionEnd,this)},c.onCellActionEnd=function(e){a.game_logic_action.isProcessing?this.resetStateAndScale():(this.getIsDragging()||e.type!==s.EventType.TOUCH_END||(r.log("Cell "+this.get_cell_index()+" (Type "+this.get_cell_type()+") 触发点击事件。"),this._click()),t.prototype.onTouchEndOrCancel.call(this,e))},c._click=function(){var t=n(o().mark((function t(){var e,n,i,c;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(h.get_cur_swap()<=0)){t.next=3;break}return r.log("交换次数不足，无法打开宝箱"),t.abrupt("return");case 3:return _.instance.play_shot("chestopen"),e=this.node.getWorldPosition().clone(),n=a.get_cell_config(this.base_type,this.get_cell_type()),h.record_swap(h.get_cur_swap()+n.swap_count),u.Ins.emit(p.UPDATE_SWAP,e),a.game_logic_action.isProcessing=!0,i=[],(c=this.logic.remove_cell(this.get_cell_index()))&&i.push(c),t.next=14,Promise.all(i);case 14:return t.next=16,this.logic.processGameLogic(" cell 500 ");case 16:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),c.init_cell=function(){t.prototype.init_cell.call(this);var e=a.get_cell_config(this.base_type,this.get_cell_type());this.swap_count=e.swap_count},i}(l))||g);i._RF.pop()}}}));

System.register("chunks:///_virtual/Cell600Action.ts",["./rollupPluginModLoBabelHelpers.js","cc","./CellAction.ts","./Global.ts","./ResourcePool.ts","./Logger.ts","./EnemyAction.ts","./Bullet200Action.ts","./AudioManager.ts","./Enums.ts","./ResourceManger.ts"],(function(t){var e,o,n,i,r,a,s,l,c,u,h,p,_,f,g,m,y,d,v,b,A;return{setters:[function(t){e=t.applyDecoratedDescriptor,o=t.inheritsLoose,n=t.initializerDefineProperty,i=t.assertThisInitialized,r=t.createForOfIteratorHelperLoose,a=t.asyncToGenerator,s=t.regeneratorRuntime},function(t){l=t.cclegacy,c=t._decorator,u=t.Node,h=t.CCFloat,p=t.Sprite},function(t){_=t.CellAction},function(t){f=t.Global},function(t){g=t.ResourcePool},function(t){m=t.Logger},function(t){y=t.EnemyAction},function(t){d=t.Bullet200Action},function(t){v=t.AudioManager},function(t){b=t.GAME_STATE},function(t){A=t.default}],execute:function(){var z,C,E,T,R,P,w;l._RF.push({},"58a31sgo1tJKpEZyQOVNzrM","Cell600Action",void 0);var k=c.ccclass,B=c.property;t("Cell600Action",(z=k("Cell600Action"),C=B(u),E=B({type:h,tooltip:"攻击圆形半径 (像素)"}),z((P=e((R=function(t){function e(){for(var e,o=arguments.length,r=new Array(o),a=0;a<o;a++)r[a]=arguments[a];return e=t.call.apply(t,[this].concat(r))||this,n(e,"muzzle",P,i(e)),e.shootInterval=.8,n(e,"attackRadius",w,i(e)),e._shootTimer=0,e.arrow_type=600,e}o(e,t);var l=e.prototype;return l.onLoad=function(){t.prototype.onLoad.call(this)},l.onEnable=function(){m.log("Cell600Action onEnable")},l.onDisable=function(){m.log("Cell600Action onDisable")},l.reset_sprite=function(){var t=this.show_for_node.getComponent(p);if(t){var e=A.instance.get_ui("cell_"+(this.arrow_type+this.step));e&&(t.spriteFrame=e)}},l.init_cell=function(){t.prototype.init_cell.call(this);var e=f.get_cell_config(this.base_type,this.get_cell_type());this.shootInterval=e.shoot_timer,this._shootTimer=this.shootInterval,this.muzzle||m.error("Cell600Action: muzzle 节点未设置!")},l.update=function(t){f.game_logic_action.isProcessing||f.get_game_state()==b.START&&(this._shootTimer+=t,this.aimAndShoot())},l.aimAndShoot=function(){var t,e=null==(t=f.game_enemy_layer_action)?void 0:t.node;if(e){if(this._targetEnemy=this.findClosestTarget(e),this._targetEnemy){var o=this._targetEnemy.getWorldPosition();this._shootTimer>=this.shootInterval&&(this.shootBullet(o),this._shootTimer=0)}}else this._targetEnemy=null},l.findClosestTarget=function(t){for(var e,o=null,n=this.attackRadius*this.attackRadius,i=this.node.getWorldPosition(),a=r(t.children);!(e=a()).done;){var s=e.value;if(s.active&&(s.getComponent(y)&&!(s.getComponent(y).get_current_hp()<=0))){var l=s.getWorldPosition(),c=i.clone().subtract(l).lengthSqr();c<=n&&(n=c,o=s)}}return o},l.shootBullet=function(){var t=a(s().mark((function t(e){var o,n,i,r;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.muzzle&&this._targetEnemy){t.next=2;break}return t.abrupt("return");case 2:return o=this.muzzle.getWorldPosition(),n="bullet_"+this.base_type,t.prev=4,t.next=7,g.instance.create_by_Pool(n,o,f.game_enemy_layer_action.node,!1);case 7:i=t.sent,(r=i.getComponent(d))?(r.init(o,this._targetEnemy,this.base_type,this.step),v.instance.play_shot("bowshoot")):(m.error("Bullet prefab "+n+" missing Bullet201Action component!"),g.instance.remove_node(i)),t.next=15;break;case 12:t.prev=12,t.t0=t.catch(4),m.error("Failed to create bullet "+n+":",t.t0);case 15:case"end":return t.stop()}}),t,this,[[4,12]])})));return function(e){return t.apply(this,arguments)}}(),e}(_)).prototype,"muzzle",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),w=e(R.prototype,"attackRadius",[E],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 135}}),T=R))||T));l._RF.pop()}}}));

System.register("chunks:///_virtual/CellAction.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Global.ts","./EventsManager.ts","./Enums.ts","./ResourceManger.ts","./Tools.ts"],(function(t){var i,e,n,s,o,a,c,r,l,h,g,_,u,p,f,d,T,m,y,E,v;return{setters:[function(t){i=t.applyDecoratedDescriptor,e=t.inheritsLoose,n=t.initializerDefineProperty,s=t.assertThisInitialized},function(t){o=t.cclegacy,a=t._decorator,c=t.Label,r=t.Node,l=t.v3,h=t.v2,g=t.Sprite,_=t.tween,u=t.Vec2,p=t.Vec3,f=t.Component},function(t){d=t.Global},function(t){T=t.EventsManager},function(t){m=t.EventTyps,y=t.GAME_STATE},function(t){E=t.default},function(t){v=t.Tools}],execute:function(){var A,D,b,C,x,S,M;o._RF.push({},"32257N3YYJAC6N2lUuHSco8","CellAction",void 0);var P=a.ccclass,L=a.property;t("CellAction",(A=P("CellAction"),D=L(c),b=L(r),A((S=i((x=function(t){function i(){for(var i,e=arguments.length,o=new Array(e),a=0;a<e;a++)o[a]=arguments[a];return i=t.call.apply(t,[this].concat(o))||this,n(i,"cell_index_label",S,s(i)),n(i,"show_for_node",M,s(i)),i.cell_index=-1,i.base_type=0,i.step=0,i.initialPos=l(),i.touchStartPos=h(),i.isDragging=!1,i.dragDirection="",i.maxDragDistance=0,i.gameLogicAction=null,i.logic=void 0,i._targetEnemy=null,i}e(i,t);var o=i.prototype;return o.get_target_enemy=function(){return this._targetEnemy},o.onLoad=function(){this.gameLogicAction=d.game_logic_action,this.gameLogicAction&&(this.maxDragDistance=this.gameLogicAction.getCellSize())},o.onEnable=function(){this.node.on(r.EventType.TOUCH_START,this.onTouchStart,this),this.node.on(r.EventType.TOUCH_MOVE,this.onTouchMove,this),this.node.on(r.EventType.TOUCH_END,this.onTouchEndOrCancel,this),this.node.on(r.EventType.TOUCH_CANCEL,this.onTouchEndOrCancel,this)},o.onDisable=function(){this.node.off(r.EventType.TOUCH_START,this.onTouchStart,this),this.node.off(r.EventType.TOUCH_MOVE,this.onTouchMove,this),this.node.off(r.EventType.TOUCH_END,this.onTouchEndOrCancel,this),this.node.off(r.EventType.TOUCH_CANCEL,this.onTouchEndOrCancel,this)},o.init_base_cell=function(t,i,e,n){this.logic=t,this.cell_index=i,this.base_type=e,n>d.STEP_MAX?this.step=d.STEP_MAX:this.step=n,this.reset_initial_pos(),this.cell_index_label,this.reset_sprite(),this.init_cell(),this._targetEnemy=null,T.Ins.emit(m.CREATE_NEW_CELL,{base_type:this.base_type,step:this.step})},o.init_cell=function(){},o.reset_initial_pos=function(){var t=v.calculate_cell_position(this.cell_index,d.GAME_WIDTH,d.game_logic_action.game_scene_transform);this.initialPos.set(t)},o.get_initial_pos=function(){return this.initialPos},o.reset_sprite=function(){var t=this.show_for_node.getComponent(g);if(t){var i=this.get_node_sprite_frame();i&&(t.spriteFrame=i)}},o.get_node_sprite_frame=function(){var t=E.instance.get_ui("cell_"+this.get_cell_type());return t||null},o.get_cell_logic=function(){return this.logic},o.get_cell_type=function(){return this.base_type+this.step},o.get_base_type=function(){return this.base_type},o.get_cell_index=function(){return this.cell_index},o.set_cell_index=function(t){this.cell_index=t,this.reset_initial_pos(),this.reset_sprite()},o.getIsDragging=function(){return this.isDragging},o.onTouchStart=function(t){this.gameLogicAction&&!this.gameLogicAction.isProcessing&&d.get_game_state()==y.START&&(this.isDragging=!1,this.dragDirection="",this.touchStartPos.set(t.getLocation()),_(this.node).to(.1,{scale:l(1.1,1.1,1.1)}).start(),t.propagationStopped=!0)},o.onTouchMove=function(t){if(this.gameLogicAction&&!this.gameLogicAction.isProcessing&&d.get_game_state()==y.START){var i=t.getLocation(),e=h(i.x-this.touchStartPos.x,i.y-this.touchStartPos.y);if(!this.isDragging)u.distance(this.touchStartPos,i)>20&&(this.isDragging=!0,Math.abs(e.x)>Math.abs(e.y)?this.dragDirection=e.x>0?"right":"left":this.dragDirection=e.y>0?"up":"down");if(this.isDragging){var n=this.initialPos.x,s=this.initialPos.y,o=e.x,a=e.y,c=this.maxDragDistance;switch(this.dragDirection){case"right":n+=Math.min(Math.max(0,o),c);break;case"left":n+=Math.max(Math.min(0,o),-c);break;case"up":s+=Math.min(Math.max(0,a),c);break;case"down":s+=Math.max(Math.min(0,a),-c)}this.node.setPosition(n,s)}}},o.onTouchEndOrCancel=function(t){if(this.gameLogicAction&&!this.gameLogicAction.isProcessing&&d.get_game_state()==y.START){if(this.isDragging){var i=this.node.getPosition();p.distance(i,this.initialPos)>.25*this.maxDragDistance?this.logic.onCellMove({cellIndex:this.cell_index,direction:this.dragDirection}):this.snapBack()}else this.snapBack();this.resetStateAndScale()}else this.resetStateAndScale()},o.resetStateAndScale=function(){this.isDragging=!1,this.dragDirection="",_(this.node).to(.1,{scale:l(1,1,1)}).start()},o.snapBack=function(){_(this.node).to(.1,{position:this.initialPos},{easing:"quadOut"}).start()},o.move_self_pos=function(t){var i=this;return new Promise((function(e){_(i.node).to(t,{position:i.get_initial_pos()}).call((function(){e()})).start()}))},i}(f)).prototype,"cell_index_label",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),M=i(x.prototype,"show_for_node",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),C=x))||C));o._RF.pop()}}}));

System.register("chunks:///_virtual/CellForLogic.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Enums.ts","./EventsManager.ts","./ResourcePool.ts","./Logger.ts","./CellAction.ts","./Global.ts","./Tools.ts","./XStorage.ts","./AudioManager.ts","./WindowData.ts"],(function(e){var t,n,r,a,s,i,c,o,l,_,u,p,f,h,g,m,d,x,w,b,v,y;return{setters:[function(e){t=e.createForOfIteratorHelperLoose,n=e.asyncToGenerator,r=e.regeneratorRuntime},function(e){a=e.cclegacy,s=e._decorator,i=e.tween,c=e.v3,o=e.Size,l=e.UITransform,_=e.Vec3,u=e.UIOpacity},function(e){p=e.EventTyps,f=e.GAME_STATE},function(e){h=e.EventsManager},function(e){g=e.ResourcePool},function(e){m=e.Logger},function(e){d=e.CellAction},function(e){x=e.Global},function(e){w=e.Tools},function(e){b=e.XStorage},function(e){v=e.AudioManager},function(e){y=e.WindowData}],execute:function(){a._RF.push({},"bf81erPD4hAPpvrobxgsv9H","CellForLogic",void 0);s.ccclass,s.property,e("CellForLogic",function(){function e(){this.cell_layer=null,this.game_scene_transform=null,this.cell_size=0,this.game_scene_size=new o(0,0),this.swapped_indices=null,this.swap_data=null}var a=e.prototype;return a.init=function(e,t){this.cell_layer=e,this.game_scene_transform=t},a.destroy=function(){m.log("clear cell for logcis..."),this.clear_game_scene()},a.start_game=function(){var e=n(r().mark((function e(){var t=this;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.cell_layer&&this.game_scene_transform){e.next=3;break}return m.error("GameLogicAction: 无法开始游戏!"),e.abrupt("return");case 3:return x.set_game_state(f.READY),this.clear_game_scene(),m.log("GameLogicAction:清理完毕。。。。"),this.cell_size=this.game_scene_transform.width/x.GAME_WIDTH,this.game_scene_size.width=this.game_scene_transform.width,this.game_scene_size.height=this.game_scene_transform.height,e.next=11,this._load_game();case 11:if(!e.sent){e.next=24;break}return m.log("GameLogicAction: 成功读取存档，继续游戏。"),h.Ins.emit(p.INIT_GAME),h.Ins.emit(p.SYNC_SUN),h.Ins.emit(p.SYN_COIN),h.Ins.emit(p.CLEAR_ENEMY_LAYER),h.Ins.emit(p.SWAP_DATA_CHANGE),h.Ins.emit(p.REFRESH_ITEM_BTN),e.next=22,x.castle_action.load_arrow_towers(this);case 22:e.next=39;break;case 24:return m.log("GameLogicAction: 未发现存档，开始新游戏。"),b.record_item_btn(0),b.record_swap(5),b.record_heart(5),b.record_relife(0),b.record_sun(1),h.Ins.emit(p.INIT_GAME),h.Ins.emit(p.SYNC_SUN),h.Ins.emit(p.SYN_COIN),h.Ins.emit(p.CLEAR_ENEMY_LAYER),h.Ins.emit(p.SWAP_DATA_CHANGE),h.Ins.emit(p.REFRESH_ITEM_BTN),e.next=38,this._start_new_game();case 38:b.clear_arrow_towers();case 39:x.ui_layer_action.show_win("Ready",null,n(r().mark((function e(){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.processGameLogic("ready start");case 2:x.set_game_state(f.START);case 3:case"end":return e.stop()}}),e)}))));case 40:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),a._load_game=function(){var e=n(r().mark((function e(){var n,a,s,i,c,o,_,u,p,f,h,v,y,k;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((n=b.get_cell_data())&&0!==n.length){e.next=3;break}return e.abrupt("return",!1);case 3:a=x.GAME_WIDTH,s=[],i=t(n);case 6:if((c=i()).done){e.next=29;break}return o=c.value,_=o.index,u=o.base_type,p=o.step,f=w.calculate_cell_position(_,a,this.game_scene_transform),e.prev=10,h=u,p>=1&&(h=u+1),e.next=15,g.instance.create_by_Pool(x.CELL_PREFAB_NAME+h,null,this.cell_layer,!1);case 15:(v=e.sent).setPosition(f),(y=v.getComponent(d))&&y.init_base_cell(this,_,u,p),(k=v.getComponent(l))&&k.setContentSize(this.cell_size,this.cell_size),s.push(Promise.resolve()),e.next=27;break;case 24:e.prev=24,e.t0=e.catch(10),m.error("加载 Cell 节点失败 (索引 "+_+"):",e.t0);case 27:e.next=6;break;case 29:return e.next=31,Promise.all(s);case 31:return e.abrupt("return",!0);case 32:case"end":return e.stop()}}),e,this,[[10,24]])})));return function(){return e.apply(this,arguments)}}(),a._start_new_game=function(){var e=n(r().mark((function e(){var t,n,a,s,c,o,u,p,f=this;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=x.GAME_WIDTH,n=x.GAME_HEIGHT,a=.5,s=x.cell_type_arr,c=[],o=0;case 8:if(!(o<t)){e.next=22;break}u=r().mark((function e(){var n,u,h,b,v,y,k,A;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=p*t+o,u=w.calculate_cell_position(n,t,f.game_scene_transform),h=new _(u.x,u.y+280+w.random_between_floor(0,80)),e.prev=3,b=s[w.random_between_floor(0,s.length)],e.next=7,g.instance.create_by_Pool(x.CELL_PREFAB_NAME+b,null,f.cell_layer,!1);case 7:(v=e.sent).setPosition(h),(y=v.getComponent(d))&&y.init_base_cell(f,n,b,0),(k=v.getComponent(l))&&k.setContentSize(f.cell_size,f.cell_size),A=new Promise((function(e){i(v).to(a,{position:y.get_initial_pos()},{easing:"quadIn"}).call((function(){v.setPosition(y.get_initial_pos()),e()})).start()})),c.push(A),e.next=23;break;case 19:return e.prev=19,e.t0=e.catch(3),m.error("生成 Cell 节点失败 (索引 "+n+"):",e.t0),e.abrupt("return",1);case 23:case"end":return e.stop()}}),e,null,[[3,19]])})),p=0;case 12:if(!(p<n)){e.next=19;break}return e.delegateYield(u(),"t0",14);case 14:if(!e.t0){e.next=16;break}return e.abrupt("break",19);case 16:p++,e.next=12;break;case 19:o++,e.next=8;break;case 22:return e.next=24,Promise.all(c);case 24:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),a.getCellSize=function(){return 0===this.cell_size&&this.game_scene_transform&&(this.cell_size=this.game_scene_transform.width/x.GAME_WIDTH),this.cell_size},a.get_all_cell=function(){return this.cell_layer.children.slice()},a.get_cell_by_index=function(e){for(var t=this.cell_layer.children.slice(),n=null,r=0;r<t.length;r++){if(this.cell_layer.children[r])if(this.cell_layer.children[r].getComponent(d).get_cell_index()===e){n=this.cell_layer.children[r];break}}return n},a.clear_game_scene=function(){if(this.cell_layer){for(var e=this.cell_layer.children.slice(),t=0;t<e.length;t++)g.instance.remove_node(e[t]);m.log("GameLogicAction:开始清理。。。。")}else m.error("GameLogicAction: game_scene 节点未设置!")},a.getTargetIndex=function(e,t){var n=x.GAME_WIDTH,r=x.TOTAL_CELLS,a=Math.floor(e/n),s=e%n,i=-1;switch(t){case"up":a<x.GAME_HEIGHT-1&&(i=e+n);break;case"down":a>0&&(i=e-n);break;case"left":s>0&&(i=e-1);break;case"right":s<n-1&&(i=e+1)}return i>=0&&i<r?i:-1},a.swapCells=function(){var e=n(r().mark((function e(t,n){var a,s,i,c,o,l;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=this.get_cell_by_index(t),s=this.get_cell_by_index(n),a&&s){e.next=5;break}return m.error("交换失败: 索引 "+t+" 或 "+n+" 处的 Cell 不存在."),e.abrupt("return");case 5:return(i=a.getComponent(d)).set_cell_index(n),(c=s.getComponent(d)).set_cell_index(t),.2,o=i.move_self_pos(.2),l=c.move_self_pos(.2),v.instance.play_shot("swap"),e.next=15,Promise.all([o,l]);case 15:m.log("交换完成: Cell "+t+" <--\x3e Cell "+n);case 16:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}(),a.moveCellToEmpty=function(){var e=n(r().mark((function e(t,n){var a,s,c;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=this.get_cell_by_index(t)){e.next=3;break}return e.abrupt("return");case 3:return.2,(s=a.getComponent(d)).set_cell_index(n),c=new Promise((function(e){i(a).to(.2,{position:s.get_initial_pos()}).call((function(){return e()})).start()})),v.instance.play_shot("swap"),e.next=10,c;case 10:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}(),a.checkAndFillGaps=function(){var e=n(r().mark((function e(){var t,n,a,s,c,o,l,_,u,p=this;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=!1,n=[],a=x.GAME_WIDTH,s=x.GAME_HEIGHT,c=.15,o=0;case 6:if(!(o<a)){e.next=18;break}l=0,_=r().mark((function e(){var s,_,f,h,g;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:s=u*a+o,null===p.get_cell_by_index(s)?l++:l>0&&(t=!0,_=p.get_cell_by_index(s),f=_.getComponent(d),h=(u-l)*a+o,f.set_cell_index(h),g=new Promise((function(e){i(_).to(c,{position:f.get_initial_pos()},{easing:"quadIn"}).call((function(){return e()})).start()})),n.push(g));case 2:case"end":return e.stop()}}),e)})),u=0;case 10:if(!(u<s)){e.next=15;break}return e.delegateYield(_(),"t0",12);case 12:u++,e.next=10;break;case 15:o++,e.next=6;break;case 18:return e.next=20,Promise.all(n);case 20:return e.abrupt("return",t);case 21:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),a.checkMatches=function(){for(var e=[],n=x.GAME_WIDTH,r=x.GAME_HEIGHT,a=0;a<r;a++)for(var s=0;s<n-2;s++){var i=a*n+s,c=this.get_cell_by_index(i);if(c){var o=c.getComponent(d).get_cell_type();if(!(s>0&&this.get_cell_by_index(i-1)&&this.get_cell_by_index(i-1).getComponent(d).get_cell_type()===o)){for(var l=new Set([i]),_=s+1;_<n;_++){var u=a*n+_,p=this.get_cell_by_index(u);if(!p||p.getComponent(d).get_cell_type()!==o)break;l.add(u)}l.size>=3&&e.push(l)}}}for(var f=0;f<n;f++)for(var h=0;h<r-2;h++){var g=h*n+f,m=this.get_cell_by_index(g);if(m){var w=m.getComponent(d).get_cell_type();if(!(h>0&&this.get_cell_by_index(g-n)&&this.get_cell_by_index(g-n).getComponent(d).get_cell_type()===w)){for(var b=new Set([g]),v=h+1;v<r;v++){var y=v*n+f,k=this.get_cell_by_index(y);if(!k||k.getComponent(d).get_cell_type()!==w)break;b.add(y)}if(b.size>=3){for(var A,C=!1,E=function(){for(var e,n=A.value,r=t(b);!(e=r()).done;){var a=e.value;if(n.has(a)){b.forEach((function(e){return n.add(e)})),C=!0;break}}if(C)return 1},P=t(e);!(A=P()).done&&!E(););C||e.push(b)}}}}return e},a.createNewSpecialCell=function(){var e=n(r().mark((function e(t,n,a){var s,o,_,u,p,f;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return m.log("createNewSpecialCell >>>>",t,n,a),s=x.GAME_WIDTH,o=w.calculate_cell_position(t,s,this.game_scene_transform),_=n,a>0&&(_=n+1),e.next=7,g.instance.create_by_Pool(x.CELL_PREFAB_NAME+_,null,this.cell_layer,!1);case 7:return(u=e.sent).setPosition(o),u.setScale(c(0,0,0)),(p=u.getComponent(d))&&p.init_base_cell(this,t,n,a),(f=u.getComponent(l))&&f.setContentSize(this.cell_size,this.cell_size),e.next=16,new Promise((function(e){i(u).to(.3,{scale:c(1,1,1)},{easing:"backOut"}).call((function(){return e()})).start()}));case 16:return e.abrupt("return",u);case 17:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}(),a.destory_create_new_cell=function(){var e=n(r().mark((function e(n){var a,s,i,c,o,l,_,u,f,g,m,x,y,k,A,C,E,P,I,T,G,S,L,M,H,z,N,D,W,R,F;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(a=[],s=new Set,i=[],c=t(n.entries());!(o=c()).done;)for(l=o.value,_=l[0],u=l[1],f=null,u.size>=3&&(this.swapped_indices&&0===_&&(g=this.swapped_indices,m=g[0],x=g[1],u.has(x)?f=x:u.has(m)&&(f=m)),null===f&&(y=Array.from(u).filter((function(e){return!s.has(e)}))).length>0&&(f=y[w.random_between_floor(0,y.length)]),(k=u.size-3)>0&&(A=this.get_cell_by_index(f),C=this.cell_layer.getWorldPosition().clone(),A&&(C=A.getWorldPosition().clone()),b.record_swap(b.get_cur_swap()+k),h.Ins.emit(p.UPDATE_SWAP,C))),null===f||s.has(f)||(E=this.get_cell_by_index(f))&&(P=E.getComponent(d).base_type,I=E.getComponent(d).step,i.push({index:f,base_cell_type:P,step:I+1}),s.add(f)),T=t(u);!(G=T()).done;)S=G.value,s.has(S)||s.add(S);for(L=t(s);!(M=L()).done;)H=M.value,this.get_cell_by_index(H)&&(z=this.remove_cell(H))&&a.push(z);return N="match3",4==s.size?N="match4":s.size>4&&(N="match5"),v.instance.play_shot(N),e.next=10,Promise.all(a);case 10:D=[],W=0,R=i;case 12:if(!(W<R.length)){e.next=21;break}return F=R[W],e.next=16,this.createNewSpecialCell(F.index,F.base_cell_type,F.step);case 16:e.sent,D.push(new Promise((function(e){e()})));case 18:W++,e.next=12;break;case 21:return e.next=23,Promise.all(D);case 23:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),a.placement=function(){var e=n(r().mark((function e(t,n){var a;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return x.game_logic_action.isProcessing=!0,e.next=3,this.remove_cell(t);case 3:return a=[],e.next=6,this.createNewSpecialCell(t,n.base_type,n.step);case 6:return e.sent,a.push(new Promise((function(e){e()}))),e.next=10,Promise.all(a);case 10:return e.next=12,this.processGameLogic(" placement ");case 12:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}(),a.remove_cell=function(){var e=n(r().mark((function e(t){var n,a;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n=this.get_cell_by_index(t))){e.next=4;break}return a=new Promise((function(e){var t=n.getComponent(u)||n.addComponent(u);i(n).parallel(i().to(.2,{scale:c(0,0,0)}),i(t).to(.2,{opacity:0})).call((function(){g.instance.remove_node(n),t.opacity=255,n.setScale(c(1,1,1)),e()})).start()})),e.abrupt("return",a);case 4:return e.abrupt("return",null);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),a.processGameLogic=function(){var e=n(r().mark((function e(t){var n,a,s,i,c;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=!1,a=!0,s=0,i=10;case 4:if(!(s++>i)){e.next=7;break}return m.error("GameLogicAction: 消除逻辑进入无限循环，强制中断!"),e.abrupt("break",26);case 7:if(n=!1,!((c=this.checkMatches()).length>0)){e.next=14;break}return e.next=12,this.destory_create_new_cell(c);case 12:n=!0,this._remove_swap_data();case 14:if(a&&(this.swapped_indices=null),!n&&!a){e.next=24;break}return e.next=18,this.checkAndFillGaps();case 18:return e.sent&&(n=!0),e.next=22,this.generateNewCells();case 22:e.sent&&(n=!0);case 24:a=!1;case 25:if(n){e.next=4;break}case 26:if(this.save_game_progress(),x.game_logic_action.isProcessing=!1,m.log("游戏逻辑处理流程完成，解除锁定,tag>>>",t),!(b.get_cur_swap()<=0)){e.next=32;break}return e.next=32,this.add_enemy();case 32:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),a.add_enemy=function(){var e=n(r().mark((function e(){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:x.game_enemy_layer_action.random_enemy();case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),a.move_target_empty=function(){var e=n(r().mark((function e(t,a){var s,i,c,o,l,_,u,f,g,m=this;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=t.getComponent(d),"up"!==a){e.next=37;break}if(200!=s.get_base_type()||0!==s.step){e.next=18;break}return b.record_swap(b.get_cur_swap()-1),h.Ins.emit(p.UPDATE_SWAP),b.record_heart(b.get_cur_heart()+1),h.Ins.emit(p.UPDATE_HEART),v.instance.play_shot("metaltap"),i=[],(c=this.remove_cell(s.get_cell_index()))&&i.push(c),e.next=14,Promise.all(i);case 14:return e.next=16,this.processGameLogic(" move_target_enemy 1 ");case 16:e.next=35;break;case 18:if(!(200==s.get_base_type()&&s.step>0)){e.next=33;break}return b.record_swap(b.get_cur_swap()-1),h.Ins.emit(p.UPDATE_SWAP),v.instance.play_shot("metaltap"),o=[],(l=x.castle_action.add_arrow_tower(this,s.node.worldPosition,s.get_base_type(),s.step))&&o.push(l),(_=this.remove_cell(s.get_cell_index()))&&o.push(_),e.next=29,Promise.all(o);case 29:return e.next=31,this.processGameLogic(" move_target_enemy 1 ");case 31:e.next=35;break;case 33:return e.next=35,this.snapBackCell(t);case 35:e.next=47;break;case 37:if(u=function(){var e=n(r().mark((function e(){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,m.snapBackCell(t);case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),f=function(){var e=n(r().mark((function e(){var t,n;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return b.record_swap(b.get_cur_swap()-1),h.Ins.emit(p.UPDATE_SWAP),v.instance.play_shot("offedge"),t=[],(n=m.remove_cell(s.get_cell_index()))&&t.push(n),e.next=8,Promise.all(t);case 8:return e.next=10,m.processGameLogic("move_target_enemy 2");case 10:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),x.drop_flag){e.next=45;break}(g=new y).data=s,x.ui_layer_action.show_win("Drop",g,n(r().mark((function e(t){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t,e.next=0===e.t0?3:1===e.t0?6:9;break;case 3:return e.next=5,u();case 5:return e.abrupt("break",9);case 6:return e.next=8,f();case 8:return e.abrupt("break",9);case 9:case"end":return e.stop()}}),e)})))),e.next=47;break;case 45:return e.next=47,f();case 47:x.game_logic_action.isProcessing=!1;case 48:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}(),a.undo_swap=function(){var e=n(r().mark((function e(){var t,n;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.swap_data){e.next=14;break}return x.game_logic_action.isProcessing=!0,t=this.swap_data.from_index,n=this.swap_data.to_index,b.record_swap(b.get_cur_swap()+1),h.Ins.emit(p.UPDATE_SWAP),this._remove_swap_data(),m.log("撤销交换操作 >>> ",this.swap_data),e.next=10,this.swapCells(t,n);case 10:return e.next=12,this.processGameLogic("undo_swap");case 12:e.next=16;break;case 14:m.log("没有可撤销的交换操作."),this._remove_swap_data();case 16:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),a.onCellMove=function(){var e=n(r().mark((function e(t){var n,a,s,i;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!x.game_logic_action.isProcessing){e.next=3;break}return m.log("移动 限制中，忽略此次操作 --\x3e",t),e.abrupt("return");case 3:if(x.game_logic_action.isProcessing=!0,n=t.cellIndex,a=t.direction,s=this.get_cell_by_index(n),i=this.getTargetIndex(n,a),!(b.get_cur_swap()<=0)){e.next=14;break}return m.log("move 1.0  --\x3e",s),e.next=12,this.snapBackCell(s);case 12:return x.game_logic_action.isProcessing=!1,e.abrupt("return");case 14:if(-1!==i){e.next=18;break}return e.next=17,this.move_target_empty(s,a);case 17:return e.abrupt("return");case 18:if(!this.get_cell_by_index(i)){e.next=31;break}return m.log("move 2 交换cell --\x3e"),b.record_swap(b.get_cur_swap()-1),h.Ins.emit(p.UPDATE_SWAP),this.swapped_indices=[n,i],e.next=26,this.swapCells(n,i);case 26:return this._add_swap_data(n,i),e.next=29,this.processGameLogic("   onCellMove");case 29:e.next=40;break;case 31:if(m.log("move 3 空位置 --\x3e"),"left"!==a&&"right"!==a){e.next=37;break}return e.next=35,this.moveCellToEmpty(n,i);case 35:e.next=39;break;case 37:return e.next=39,this.snapBackCell(s);case 39:x.game_logic_action.isProcessing=!1;case 40:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),a._add_swap_data=function(e,t){this.swap_data={from_index:e,to_index:t},h.Ins.emit(p.SWAP_DATA_CHANGE)},a._remove_swap_data=function(){this.swap_data&&m.log("移除交换数据 >>> ",this.swap_data),this.swap_data=null,h.Ins.emit(p.SWAP_DATA_CHANGE)},a.get_swap_data=function(){return this.swap_data},a.snapBackCell=function(e){if(!e)return Promise.resolve();var t=e.getComponent(d);return new Promise((function(n){t?(i(e).to(.1,{position:t.get_initial_pos()},{easing:"quadOut"}).call((function(){n()})).start(),i(e).to(.1,{scale:c(1,1,1)}).start()):n()}))},a.generateNewCells=function(){var e=n(r().mark((function e(){var t,n,a,s,c,o,_,u,p,f,h=this;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=!1,n=[],a=x.GAME_WIDTH,s=x.GAME_HEIGHT,c=.3,o=x.cell_type_arr,_=0;case 7:if(!(_<a)){e.next=22;break}u=0,p=r().mark((function e(){var p,b,v,y,k,A,C,E;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(p=f*a+_,null!==h.get_cell_by_index(p)){e.next=26;break}return u++,t=!0,e.prev=4,b=s+(u-1),v=w.calculate_cell_position(b*a+_,a,h.game_scene_transform),y=o[w.random_between_floor(0,o.length)],e.next=10,g.instance.create_by_Pool(x.CELL_PREFAB_NAME+y,null,h.cell_layer,!1);case 10:(k=e.sent).setPosition(v),(A=k.getComponent(d))&&A.init_base_cell(h,p,y,0),(C=k.getComponent(l))&&C.setContentSize(h.cell_size,h.cell_size),E=new Promise((function(e){i(k).to(c,{position:A.get_initial_pos()},{easing:"quadIn"}).call((function(){return e()})).start()})),n.push(E),e.next=24;break;case 20:return e.prev=20,e.t0=e.catch(4),m.error("生成新的 Cell 节点失败 (索引 "+p+"):",e.t0),e.abrupt("return",0);case 24:e.next=27;break;case 26:return e.abrupt("return",0);case 27:case"end":return e.stop()}}),e,null,[[4,20]])})),f=s-1;case 11:if(!(f>=0)){e.next=19;break}return e.delegateYield(p(),"t0",13);case 13:if(0!==e.t0){e.next=16;break}return e.abrupt("break",19);case 16:f--,e.next=11;break;case 19:_++,e.next=7;break;case 22:return e.next=24,Promise.all(n);case 24:return e.abrupt("return",t);case 25:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),a.save_game_progress=function(){for(var e,n=this.get_all_cell(),r=[],a=t(n);!(e=a()).done;){var s=e.value.getComponent(d);s&&r.push({index:s.get_cell_index(),base_type:s.base_type,step:s.step})}r.length>0?b.record_cell_data(r):b.clear_cell_data()},a.print_info=function(){m.log("game_scene children length :",this.cell_layer.children),m.log("processing state :",x.game_logic_action.isProcessing),m.log("game state state :",x.get_state_info_msg()),m.log("swap data :",this.get_swap_data())},e}());a._RF.pop()}}}));

System.register("chunks:///_virtual/CellManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Logger.ts","./CombinationData.ts","./Tools.ts","./Global.ts","./CellAction.ts"],(function(e){var n,t,r,l,a,c,o,i,u,s;return{setters:[function(e){n=e.asyncToGenerator,t=e.regeneratorRuntime},function(e){r=e.cclegacy,l=e._decorator,a=e.tween},function(e){c=e.Logger},function(e){o=e.CombinationData},function(e){i=e.Tools},function(e){u=e.Global},function(e){s=e.CellAction}],execute:function(){var _,p;r._RF.push({},"72b791pugZLl5rxi0CAblX9","CellManager",void 0);var f=l.ccclass;l.property,e("CellManager",f("CellManager")(((p=function(){function e(){}return e.init_empty_cells=function(){c.log("init base cells");for(var e=u.GAME_WIDTH,n=u.GAME_HEIGHT,t=0;t<e;t++)for(var r=0;r<n;r++){var l=r*e+t,a=i.calculate_cell_position(l,e,u.game_logic_action.game_scene_transform),s=new o;s.init(l,a),this.cell_map[l]=s}},e.init_clear=function(){for(var n=0;n<e.cell_map.length;n++)e.cell_map[n].clear()},e.swapCells=function(){var r=n(t().mark((function n(r,l){var o,i,u,s,_,p,f,m;return t().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(o=e.cell_map[r],i=e.cell_map[l],o&&i){n.next=5;break}return c.error("交换失败: 索引 "+r+" 或 "+l+" 处的 Cell 不存在."),n.abrupt("return");case 5:if(o.get_cell_node()&&i.get_cell_node()){n.next=8;break}return c.error("交换失败: 索引 "+r+" 或 "+l+" 处的 Cell 不存在."),n.abrupt("return");case 8:return u=o.get_local_postion(),s=i.get_local_postion(),_=o.get_cell_node(),p=i.get_cell_node(),o.add_cell(p),i.add_cell(_),.2,f=new Promise((function(e){a(_).to(.2,{position:s}).call((function(){return e()})).start()})),m=new Promise((function(e){a(p).to(.2,{position:u}).call((function(){return e()})).start()})),n.next=19,Promise.all([f,m]);case 19:case"end":return n.stop()}}),n)})));return function(e,n){return r.apply(this,arguments)}}(),e.moveCellToEmpty=function(){var r=n(t().mark((function n(r,l){var c,o,i,u;return t().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(c=e.cell_map[r]){n.next=3;break}return n.abrupt("return");case 3:if(c.get_cell_node()){n.next=5;break}return n.abrupt("return");case 5:return o=c.get_cell_node(),i=e.cell_map[l].get_local_postion(),.2,e.cell_map[l].add_cell(o),c.add_cell(null),o.getComponent(s).set_cell_index(l),u=new Promise((function(e){a(o).to(.2,{position:i}).call((function(){return e()})).start()})),n.next=15,u;case 15:case"end":return n.stop()}}),n)})));return function(e,n){return r.apply(this,arguments)}}(),e.add_cell_by_index=function(n,t){e.cell_map[n].add_cell(t)},e.checkAndFillGaps=function(){var r=n(t().mark((function n(){var r,l,c,o,i,_,p,f,m;return t().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:r=!1,l=[],c=u.GAME_WIDTH,o=u.GAME_HEIGHT,i=.15,_=0;case 6:if(!(_<c)){n.next=18;break}p=0,f=t().mark((function n(){var o,u,f,d,g;return t().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:o=m*c+_,null===e.cell_map[o]||e.cell_map[o].get_cell_node()?p++:p>0&&(r=!0,(u=e.cell_map[o].get_cell_node()).getComponent(s),f=(m-p)*c+_,e.cell_map[f].add_cell(u),e.cell_map[o].add_cell(null),d=e.cell_map[f].get_local_postion(),g=new Promise((function(e){a(u).to(i,{position:d},{easing:"quadIn"}).call((function(){return e()})).start()})),l.push(g));case 2:case"end":return n.stop()}}),n)})),m=0;case 10:if(!(m<o)){n.next=15;break}return n.delegateYield(f(),"t0",12);case 12:m++,n.next=10;break;case 15:_++,n.next=6;break;case 18:return n.next=20,Promise.all(l);case 20:return n.abrupt("return",r);case 21:case"end":return n.stop()}}),n)})));return function(){return r.apply(this,arguments)}}(),e}()).cell_map=[],_=p))||_);r._RF.pop()}}}));

System.register("chunks:///_virtual/CombinationData.ts",["cc","./CellAction.ts"],(function(t){var n,o,i;return{setters:[function(t){n=t.cclegacy,o=t._decorator},function(t){i=t.CellAction}],execute:function(){n._RF.push({},"2032e2sPhNKX4oWLHeMkUNd","CombinationData",void 0);o.ccclass,o.property,t("CombinationData",function(){function t(){this.local_postion=void 0,this.cell_node=void 0,this.index=-1}var n=t.prototype;return n.clear=function(){this.cell_node=null,this.index=-1},n.init=function(t,n){this.clear(),this.index=t,this.local_postion=n},n.add_cell=function(t){this.cell_node=t,this.cell_node&&this.cell_node.getComponent(i).set_cell_index(this.index)},n.get_cell_node=function(){return this.cell_node},n.get_local_postion=function(){return this.local_postion},t}());n._RF.pop()}}}));

System.register("chunks:///_virtual/CountTimerAction.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Enums.ts","./BaseWindows.ts","./AudioManager.ts","./Logger.ts"],(function(i){var t,e,n,r,o,l,s,a,u,c,p,h;return{setters:[function(i){t=i.applyDecoratedDescriptor,e=i.inheritsLoose,n=i.initializerDefineProperty,r=i.assertThisInitialized},function(i){o=i.cclegacy,l=i._decorator,s=i.Label,a=i.Sprite},function(i){u=i.GAME_STATE},function(i){c=i.BaseWindows},function(i){p=i.AudioManager},function(i){h=i.Logger}],execute:function(){var m,d,T,f,y,g,w,b,C;o._RF.push({},"88a84LprthDA75WR7ZuUy2e","CountTimerAction",void 0);var L=l.ccclass,A=l.property;i("CountTimerAction",(m=L("CountTimerAction"),d=A({type:s,tooltip:"显示倒计时时间的文本标签"}),T=A({type:a,tooltip:"饼状图（Sprite 组件 Type 需设置为 FILLED）"}),f=A({tooltip:"倒计时的总时长（秒）"}),m((w=t((g=function(i){function t(){for(var t,e=arguments.length,o=new Array(e),l=0;l<e;l++)o[l]=arguments[l];return t=i.call.apply(i,[this].concat(o))||this,n(t,"timerLabel",w,r(t)),n(t,"timerCircle",b,r(t)),n(t,"totalTime",C,r(t)),t.currentTime=0,t.isRunning=!1,t.timerCallback=null,t}e(t,i);var o=t.prototype;return o.show_windows=function(t,e,n){void 0===e&&(e=null),void 0===n&&(n=u.PAUSE),i.prototype.show_windows.call(this,t,e,n);var r=this;this.startCountdown(3,(function(){e&&(p.instance.play_shot("ding"),e()),r.close_windows(null)}))},o.close_windows=function(t){i.prototype.close_windows.call(this,t)},o.startCountdown=function(i,t){this.timerLabel&&this.timerCircle?(this.totalTime=i,this.currentTime=i,this.isRunning=!0,this.timerCallback=t,this.timerCircle.type===a.Type.FILLED&&this.timerCircle.fillType===a.FillType.RADIAL||h.warn("TimerCircle 的 Sprite Type 或 Fill Type 设置不正确，请确保为 FILLED/RADIAL。"),this.updateTimeDisplay(this.currentTime),this.timerCircle.fillRange=1,this.schedule(this.updateTimer,.05)):h.error("CountTimerAction: 缺少 Label 或 Sprite 引用！")},o.updateTimer=function(i){if(this.isRunning){if(this.currentTime-=i,this.currentTime<=0)return this.currentTime=0,this.isRunning=!1,this.unschedule(this.updateTimer),this.updateDisplay(0),void(this.timerCallback&&this.timerCallback());this.updateDisplay(this.currentTime)}},o.updateDisplay=function(i){var t=i/this.totalTime;this.timerCircle.fillRange=-1*t,this.updateTimeDisplay(i)},o.updateTimeDisplay=function(i){var t=Math.ceil(i);this.timerLabel.string=t.toString()},o.stopCountdown=function(){this.isRunning=!1,this.unschedule(this.updateTimer)},t}(c)).prototype,"timerLabel",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),b=t(g.prototype,"timerCircle",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),C=t(g.prototype,"totalTime",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 10}}),y=g))||y));o._RF.pop()}}}));

System.register("chunks:///_virtual/CrazyAdManger.ts",["cc","./WxPlatform.ts","./CrazySDK.ts"],(function(e){var r,a,n,o,t,d;return{setters:[function(e){r=e.cclegacy,a=e._decorator,n=e.log,o=e.sys},function(e){t=e.WxPlatform},function(e){d=e.default}],execute:function(){var c;r._RF.push({},"9338fMf1a5PN5HhX/svZ6mP","CrazyAdManger",void 0);var i=a.ccclass;a.property,e("CrazyAdManger",i("CrazyAdManger")(c=function(){function e(){}return e.show_video=function(e){d.ad.requestAd("rewarded",{adError:function(r){n("crateblade Rewarded video error",r),e(0),console.log("show_video 获取奖励失败")},adStarted:function(){n("crateblade Rewarded video started")},adFinished:function(){n("crateblade Rewarded video finished"),e(1),console.log("crateblade show_video 获取奖励成功")}})},e.show_banner=function(){},e.close_ad=function(){switch(o.platform){case o.Platform.WECHAT_GAME:t.ins.hide_banner()}},e}())||c);r._RF.pop()}}}));

System.register("chunks:///_virtual/CrazySDK.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var e,n,i,r,s,o,a,u;return{setters:[function(t){e=t.asyncToGenerator,n=t.createClass,i=t.regeneratorRuntime},function(t){r=t.cclegacy,s=t.error,o=t.sys,a=t.DebugMode,u=t.game}],execute:function(){r._RF.push({},"954943rZC9D25RCFh4kmaEB","CrazySDK",void 0);var c=function(){function t(){}return t.Log=function(){var t;if(!([a.VERBOSE,a.INFO].indexOf(u.config.debugMode)<0)){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];(t=console).log.apply(t,["[CrazySDK]"].concat(n))}},t}(),d=function(t){return t[t.UNINITIALIZED=0]="UNINITIALIZED",t[t.REQUESTED=1]="REQUESTED",t[t.INITIALIZED=2]="INITIALIZED",t}(d||{});t("default",new(function(){function t(){this.initResolvers=[],this.initState=d.UNINITIALIZED,this.sdk=void 0,this._isSupportedPlatform=void 0,this._version="2.0.0";var t=[o.Platform.MOBILE_BROWSER,o.Platform.DESKTOP_BROWSER];this._isSupportedPlatform=t.indexOf(o.platform)>=0}var r=t.prototype;return r.ensureInitialized=function(){if(this.initState!==d.INITIALIZED)throw new Error("CrazySDK is not initialized yet. Please call CrazySDK.init() first.")},r.is_inited=function(){return this.initState===d.INITIALIZED},r.initInternal=function(){var t=this;if(this.initState===d.UNINITIALIZED){this.initState=d.REQUESTED;var n=document.createElement("script");n.src="https://sdk.crazygames.com/crazygames-sdk-v3.js",n.async=!0,n.onload=e(i().mark((function e(){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c.Log("JS SDK loaded"),t.sdk=window.CrazyGames.SDK,e.next=4,t.sdk.init({wrapper:{engine:"cocos",sdkVersion:t._version}});case 4:t.initState=d.INITIALIZED,t.initResolvers.forEach((function(t){return t()})),t.initResolvers=[];case 7:case"end":return e.stop()}}),e)}))),n.onerror=function(){return s("Failed to load CrazySDK JS. Please check your internet connection.")},document.head.appendChild(n)}},r.init=function(){var t=this;if(!this.isSupportedPlatform)throw new Error("CrazySDK is not enabled on this platform");return new Promise((function(e){t.initState===d.INITIALIZED?e():(t.initResolvers.push(e),t.initInternal())}))},n(t,[{key:"isSupportedPlatform",get:function(){return this._isSupportedPlatform}},{key:"environment",get:function(){return this.ensureInitialized(),this.sdk.environment}},{key:"isQaTool",get:function(){return this.ensureInitialized(),this.sdk.isQaTool}},{key:"ad",get:function(){return this.ensureInitialized(),this.sdk.ad}},{key:"game",get:function(){return this.ensureInitialized(),this.sdk.game}},{key:"user",get:function(){return this.ensureInitialized(),this.sdk.user}},{key:"data",get:function(){return this.ensureInitialized(),this.sdk.data}}]),t}()));r._RF.pop()}}}));

System.register("chunks:///_virtual/CrazySDK.types.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(r){var e,t;return{setters:[function(r){e=r.inheritsLoose},function(r){t=r.cclegacy}],execute:function(){t._RF.push({},"b581fU4oyxMdp3d+3NdYqW4","CrazySDK.types",void 0);var n=r("GeneralError",(function(r,e){this.code=r,this.message=e}));r("AdError",function(r){function t(e,t){var n;return(n=r.call(this,e,t)||this).code=e,n.message=t,n}return e(t,r),t}(n)),r("UserError",function(r){function t(e,t){var n;return(n=r.call(this,e,t)||this).code=e,n.message=t,n}return e(t,r),t}(n)),r("DataError",function(r){function t(e,t){var n;return(n=r.call(this,e,t)||this).code=e,n.message=t,n}return e(t,r),t}(n)),r("BannerError",function(r){function t(e,t,n){var s;return(s=r.call(this,e,t)||this).code=e,s.message=t,s.containerId=n,s}return e(t,r),t}(n));t._RF.pop()}}}));

System.register("chunks:///_virtual/CrazySDKDemo.ts",["./rollupPluginModLoBabelHelpers.js","cc","./CrazySDK.ts"],(function(e){var t,r,n,a,i,o,c,s,u,l,d,p,f;return{setters:[function(e){t=e.applyDecoratedDescriptor,r=e.inheritsLoose,n=e.initializerDefineProperty,a=e.assertThisInitialized,i=e.asyncToGenerator,o=e.regeneratorRuntime},function(e){c=e.cclegacy,s=e._decorator,u=e.Label,l=e.log,d=e.Component,p=e.error},function(e){f=e.default}],execute:function(){var m,g,h,b,v,y,k,L,w,S,A;c._RF.push({},"2b9c8PBkTNLKZmCD6gzqFNl","CrazySDKDemo",void 0);var z=s.ccclass,D=s.property;e("CrazySDKDemo",(m=z("CrazySDKDemo"),g=D({type:u}),h=D({type:u}),b=D({type:u}),v=D({type:u}),m((L=t((k=function(e){function t(){for(var t,r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return t=e.call.apply(e,[this].concat(i))||this,n(t,"supportedPlatformLabel",L,a(t)),n(t,"environmentLabel",w,a(t)),n(t,"adblockUsageLabel",S,a(t)),n(t,"inviteLinkLabel",A,a(t)),t}r(t,e);var c=t.prototype;return c.onLoad=function(){var e=this;this.supportedPlatformLabel.string="Supported platform: "+(f.isSupportedPlatform?"yes":"no"),f.isSupportedPlatform&&f.init().then((function(){e.environmentLabel.string="Environment: "+f.environment})).catch((function(e){e("Initialization failed "+e)}))},c.showRewardedVideo=function(){f.ad.requestAd("rewarded",{adError:function(e){l("Rewarded video error",e)},adStarted:function(){l("Rewarded video started")},adFinished:function(){l("Rewarded video finished")}})},c.showAdBreakVideo=function(){f.ad.requestAd("midgame",{adError:function(e){l("Ad break video error",e)},adStarted:function(){l("Ad break video started")},adFinished:function(){l("Ad break video finished")}})},c.checkAdblockUsage=function(){var e=i(o().mark((function e(){var t;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,f.ad.hasAdblock();case 3:t=e.sent,this.adblockUsageLabel.string="Adblock: "+(t?"on":"off"),e.next=11;break;case 7:e.prev=7,e.t0=e.catch(0),this.adblockUsageLabel.string="Adblock check failed",p("Adblock check failed",e.t0);case 11:case"end":return e.stop()}}),e,this,[[0,7]])})));return function(){return e.apply(this,arguments)}}(),c.gameplayStart=function(){f.game.gameplayStart()},c.gameplayStop=function(){f.game.gameplayStop()},c.sdkGameLoadingStart=function(){f.game.loadingStart()},c.sdkGameLoadingStop=function(){f.game.loadingStop()},c.happytime=function(){f.game.happytime()},c.inviteLink=function(){var e=i(o().mark((function e(){var t;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f.game.inviteLink({roomId:"123"});case 2:t=e.sent,this.inviteLinkLabel.string=t;case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),c.getUser=function(){var e=i(o().mark((function e(){var t;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f.user.getUser();case 2:t=e.sent,console.log("User retrieved: "+JSON.stringify(t));case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),c.showAuthPrompt=function(){var e=i(o().mark((function e(){var t;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f.user.showAuthPrompt();case 2:t=e.sent,console.log("Auth prompt result: "+JSON.stringify(t));case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),t}(d)).prototype,"supportedPlatformLabel",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),w=t(k.prototype,"environmentLabel",[h],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),S=t(k.prototype,"adblockUsageLabel",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),A=t(k.prototype,"inviteLinkLabel",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),y=k))||y));c._RF.pop()}}}));

System.register("chunks:///_virtual/CrazySDKDemoLoadScript.ts",["./rollupPluginModLoBabelHelpers.js","cc","./CrazySDK.ts"],(function(e){var n,t,r,i,o,a,c,s,l,u;return{setters:[function(e){n=e.applyDecoratedDescriptor,t=e.inheritsLoose,r=e.initializerDefineProperty,i=e.assertThisInitialized},function(e){o=e.cclegacy,a=e._decorator,c=e.CCString,s=e.director,l=e.Component},function(e){u=e.default}],execute:function(){var p,S,f,d,y;o._RF.push({},"fc47bGV3W5HJathgkkNsHj8","CrazySDKDemoLoadScript",void 0);var h=a.ccclass,m=a.property;e("CrazySDKDemoLoadScene",(p=h("CrazySDKDemoLoadScene"),S=m(c),p((y=n((d=function(e){function n(){for(var n,t=arguments.length,o=new Array(t),a=0;a<t;a++)o[a]=arguments[a];return n=e.call.apply(e,[this].concat(o))||this,r(n,"nextSceneName",y,i(n)),n}t(n,e);var o=n.prototype;return o.start=function(){var e=this;u.init().then((function(){e.loadScene()})).catch((function(e){e("Initialization failed "+e)}))},o.loadScene=function(){this.nextSceneName?s.loadScene(this.nextSceneName):console.warn("Scene name is not provided")},n}(l)).prototype,"nextSceneName",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),f=d))||f));o._RF.pop()}}}));

System.register("chunks:///_virtual/DataIninterface.ts",["cc"],(function(){var t;return{setters:[function(e){t=e.cclegacy}],execute:function(){t._RF.push({},"6bafcRrMBBFv6vOQMCUhFYt","DataIninterface",void 0),t._RF.pop()}}}));

System.register("chunks:///_virtual/DropAction.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Enums.ts","./BaseWindows.ts","./AudioManager.ts","./CellAction.ts","./Global.ts"],(function(t){var n,e,r,o,i,a,c,s,l,u,p,f,_,h,d;return{setters:[function(t){n=t.applyDecoratedDescriptor,e=t.inheritsLoose,r=t.initializerDefineProperty,o=t.assertThisInitialized,i=t.asyncToGenerator,a=t.regeneratorRuntime},function(t){c=t.cclegacy,s=t._decorator,l=t.Node,u=t.Sprite},function(t){p=t.GAME_STATE},function(t){f=t.BaseWindows},function(t){_=t.AudioManager},function(t){h=t.CellAction},function(t){d=t.Global}],execute:function(){var w,b,k,v,y;c._RF.push({},"d31bfF/LjZMNL745j0N/Bmd","DropAction",void 0);var g=s.ccclass,m=s.property;t("DropAction",(w=g("DropAction"),b=m(l),w((y=n((v=function(t){function n(){for(var n,e=arguments.length,i=new Array(e),a=0;a<e;a++)i[a]=arguments[a];return n=t.call.apply(t,[this].concat(i))||this,r(n,"target_node",y,o(n)),n.call_back=null,n}e(n,t);var c=n.prototype;return c.start=function(){},c.update=function(t){},c.show_windows=function(n,e,r){if(void 0===e&&(e=null),void 0===r&&(r=p.PAUSE),t.prototype.show_windows.call(this,n,e,r),this.call_back=e,this.target_node&&n&&n.data&&n.data instanceof h!=0){var o=n.data;if(null!=o){var i=o.get_node_sprite_frame();if(i&&this.target_node){var a=this.target_node.getComponent(u);a&&(a.spriteFrame=i)}}}},c.close_windows=function(n,e){t.prototype.close_windows.call(this,n,e)},c.on_click_confirm=function(){var t=i(a().mark((function t(){return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(_.instance.play_shot("menuclose"),this.close_windows(p.START),t.t0=this.call_back,!t.t0){t.next=6;break}return t.next=6,this.call_back(1);case 6:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),c.on_click_confirm_no_tips=function(){var t=i(a().mark((function t(){return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(_.instance.play_shot("menuclose"),this.close_windows(p.START),d.drop_flag=!0,t.t0=this.call_back,!t.t0){t.next=7;break}return t.next=7,this.call_back(1);case 7:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),c.on_click_cancel=function(){var t=i(a().mark((function t(){return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(_.instance.play_shot("menuclose"),this.close_windows(p.START),t.t0=this.call_back,!t.t0){t.next=6;break}return t.next=6,this.call_back(0);case 6:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),n}(f)).prototype,"target_node",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),k=v))||k));c._RF.pop()}}}));

System.register("chunks:///_virtual/EnemyAction.ts",["./rollupPluginModLoBabelHelpers.js","cc","./ResourcePool.ts","./Global.ts","./Cell400Action.ts","./Enums.ts","./AudioManager.ts","./Tools.ts","./XStorage.ts","./EventsManager.ts"],(function(e){var t,n,i,o,a,r,s,c,l,h,d,u,p,_,g,m,f,v,b,y,M,A;return{setters:[function(e){t=e.applyDecoratedDescriptor,n=e.inheritsLoose,i=e.initializerDefineProperty,o=e.assertThisInitialized,a=e.createForOfIteratorHelperLoose},function(e){r=e.cclegacy,s=e._decorator,c=e.Node,l=e.Label,h=e.Animation,d=e.v3,u=e.Component},function(e){p=e.ResourcePool},function(e){_=e.Global},function(e){g=e.Cell400Action},function(e){m=e.DRAGON_TYPE,f=e.EventTyps,v=e.GAME_STATE},function(e){b=e.AudioManager},function(e){y=e.Tools},function(e){M=e.XStorage},function(e){A=e.EventsManager}],execute:function(){var H,S,T,w,E,R,P,O,k,z,D,G,x,C,I,L,N;r._RF.push({},"6386faecB5MCo2JjhvM0TVK","EnemyAction",void 0);var F=s.ccclass,W=s.property;e("EnemyAction",(H=F("EnemyAction"),S=W(c),T=W(l),w=W(l),E=W(c),R=W(c),P=W(h),O=W(h),H((D=t((z=function(e){function t(){for(var t,n=arguments.length,a=new Array(n),r=0;r<n;r++)a[r]=arguments[r];return t=e.call.apply(e,[this].concat(a))||this,i(t,"collider_",D,o(t)),t.baseMoveSpeed=50,t.currentMoveSpeed=0,t.currentHp=50,t.maxHp=50,t.attack=2,i(t,"hp_label",G,o(t)),i(t,"speed_label",x,o(t)),i(t,"dragon",C,o(t)),i(t,"dragon_mother",I,o(t)),i(t,"dragon_animation",L,o(t)),i(t,"dragon_mother_animation",N,o(t)),t.dragon_type=void 0,t.can_move=!0,t.logic=void 0,t}n(t,e);var r=t.prototype;return r.get_current_hp=function(){return this.currentHp},r.init_enemy=function(e,t,n){this.logic=e,this.dragon_type=t,this.init_dragon(n),this.resetHp(),this.resetSpeed(),this.can_move=!0},r.init_dragon=function(e){var t=this,n=_.get_dragon_config(this.dragon_type);switch(n&&(this.baseMoveSpeed=n.move_speed,this.maxHp=n.hp,this.attack=n.attack),this.dragon_type){case m.DRAGON_MOTHER:this.dragon&&(this.dragon.active=!1),this.dragon_mother&&(this.dragon_mother.active=!0),b.instance.play_shot("dragonmother"),this.dragon_mother_animation.play(),this.dragon_animation.pause();break;default:this.dragon_mother&&(this.dragon_mother.active=!1),this.dragon&&(this.dragon.active=!0),this.scheduleOnce((function(){t.dragon_animation.play(),t.dragon_mother_animation.pause()}),Math.random()+.3)}},r.resetHp=function(){this.currentHp=this.maxHp,this.show_hp()},r.resetSpeed=function(){this.currentMoveSpeed=this.baseMoveSpeed},r.show_hp=function(){this.hp_label&&(this.hp_label.string=this.currentHp+"/"+this.maxHp)},r.takeDamage=function(e){if(this.node.active&&!(this.currentHp<=0)&&(this.currentHp-=e,this.currentHp<0&&(this.currentHp=0),b.instance.play_shot("dragonheadfalloff",.5),this.show_hp(),this.currentHp<=0)){var t="dragondie";switch(this.dragon_type){case m.DRAGON_MOTHER:t="dragonmotherdie";var n=this.node.worldPosition.clone();_.game_enemy_layer_action.dragonmother_boom(n)}b.instance.play_shot(t);var i=this;this.scheduleOnce((function(){i.remove_node()}),.3)}},r.remove_node=function(){this.resetSpeed(),p.instance?p.instance.remove_node(this.node):this.node.destroy(),b.instance.play_shot("dragonheadfalloff"),A.Ins.emit(f.FIGHT_RESULT)},r.update=function(e){if(!_.game_logic_action.isProcessing&&this.can_move&&_.get_game_state()==v.START){this.applySlowEffect();var t=this.currentMoveSpeed*e*1;this.speed_label.string=this.currentMoveSpeed+"/s",this.node.translate(d(0,t,0)),this.check_is_end()}},r.check_is_end=function(){if(y.checkRectIntersection(this.collider_,_.castle_action.collider)){this.can_move=!1;var e="dragondie";switch(this.dragon_type){case m.DRAGON_MOTHER:e="dragonmotherdie",_.game_enemy_layer_action.dragonmother_boom(this.node.worldPosition.clone());break;default:var t=M.get_cur_heart()-1;t<0&&(t=0),M.record_heart(t),A.Ins.emit(f.UPDATE_HEART),A.Ins.emit(f.ATTACK_CASTLE)}b.instance.play_shot(e);var n=this;this.scheduleOnce((function(){n.remove_node()}),.6)}},r.applySlowEffect=function(){if(null!=this.logic){var e=this.logic.get_all_cell();if(e&&0!==e.length){for(var t,n=this.node.getWorldPosition().x,i=this.node.getWorldPosition().y,o=this.baseMoveSpeed,r=a(e);!(t=r()).done;){var s=t.value;if(s&&s.active){var c=s.getComponent(g);if(c){var l=s.getWorldPosition();if(Math.abs(l.x-n)<=c.horizontalTolerance)if(Math.abs(l.y-i)<=c.slowRangeY){var h=1-c.slowRatio,d=this.baseMoveSpeed*h;d<o&&(o=d)}}}}this.currentMoveSpeed=o}}},t}(u)).prototype,"collider_",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),G=t(z.prototype,"hp_label",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),x=t(z.prototype,"speed_label",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),C=t(z.prototype,"dragon",[E],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),I=t(z.prototype,"dragon_mother",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),L=t(z.prototype,"dragon_animation",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),N=t(z.prototype,"dragon_mother_animation",[O],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),k=z))||k));r._RF.pop()}}}));

System.register("chunks:///_virtual/Enums.ts",["cc"],(function(E){var _,A,T,R,S,D;return{setters:[function(E){_=E.cclegacy,A=E.JsonAsset,T=E.Prefab,R=E.AudioClip,S=E.SpriteFrame,D=E.SpriteAtlas}],execute:function(){_._RF.push({},"7e487cMjFRIuLD0MJmB5pdE","Enums",void 0);E("EventTyps",{UPDATE_DIRECTION:"UPDATE_DIRECTION",LOAD_ASSETS_OVER:"LOAD_ASSETS_OVER",ROLL_UPDATE_SCORE:"ROLL_UPDATE_SCORE",UPDATE_COIN:"UPDATE_COIN",SYN_COIN:"SYN_COIN",CELL_PREVIEW_MOVE_REQUEST:"CELL_PREVIEW_MOVE_REQUEST",CELL_PREVIEW_SNAP_BACK:"CELL_PREVIEW_SNAP_BACK",CELL_DESTROY_OUT_OF_BOUNDS_REQUEST:"CELL_DESTROY_OUT_OF_BOUNDS_REQUEST",RESTART_GAME:"RESTART_GAME",RERUSH_SHOW_GG:"RERUSH_SHOW_GG",START_GAME:"START_GAME",READY_START_GAME:"READY_START_GAME",CELL_MOVE:"CELL_MOVE",CLEAR_GAME_LAYER:"clear_game_layer",REFRESH_ITEM_BTN:"REFRESH_ITEM_BTN",CELL_SWAPPED:"CELL_SWAPPED",DOUYIN_SILDER_show_gift_btn:"DOUYIN_SILDER_show_gift_btn",DOUYIN_SILDER_show_refrush_data:"DOUYIN_SILDER_refrush_data",UPDATE_SWAP:"UPDATE_SWAP",INIT_GAME:"INIT_GAME",UPDATE_HEART:"UPDATE_HEART",UPDATE_SUN:"UPDATE_SUN",SYNC_SUN:"SYNC_SUN",RELIFE:"RELIFE",CLEAR_ENEMY_LAYER:"CLEAR_ENEMY_LAYER",FIGHT_RESULT:"FIGHT_RESULT",ATTACK_CASTLE:"ATTACK_CASTLE",SWAP_DATA_CHANGE:"SWAP_DATA_CHANGE",REVIEW_TIPS_DRAG:"REVIEW_TIPS_DRAG",REVIEW_USERCELL_500_TIPS_DRAG:"REVIEW_USERCELL_500_TIPS_DRAG",CREATE_NEW_CELL:"CREATE_NEW_CELL",ITEM_SELECTED:"ITEM_SELECTED",ITEM_PLACEMENT_ATTEMPT:"ITEM_PLACEMENT_ATTEMPT",BUY_ITEM:"BUY_ITEM",ADD_NEW_ITEM:"ADD_NEW_ITEM",UPDATE_ITEM_COUNT:"UPDATE_ITEM_COUNT"}),E("DRAGON_TYPE",function(E){return E[E.DRAGON=0]="DRAGON",E[E.DRAGON_MOTHER=1]="DRAGON_MOTHER",E[E.DRAGON_DEFAULT=2]="DRAGON_DEFAULT",E}({})),E("GAME_STATE",function(E){return E[E.READY=0]="READY",E[E.START=1]="START",E[E.END=2]="END",E[E.PAUSE=3]="PAUSE",E}({})),E("AssetType",{Json:{type:A,path:"jsons/"},Prefab:{type:T,path:"prefabs/"},Sound:{type:R,path:"sounds/"},Ui:{type:S,path:"ui/"},Atlas:{type:D,path:"atlas/"}});_._RF.pop()}}}));

System.register("chunks:///_virtual/EventsManager.ts",["cc"],(function(t){var n;return{setters:[function(t){n=t.cclegacy}],execute:function(){var e;n._RF.push({},"02f4ay82JhL25vC6G9ttu9u","EventsManager",void 0);var r=t("EventsManager",function(){function t(){this.dict={}}t.getInstance=function(){return this.Ins};var n=t.prototype;return n.addListener=function(t,n,e){var r=this.dict[t];null==r&&(r=new Array,this.dict[t]=r);for(var i=0,a=r.length;i<a;i++)if(r[i][0]==n&&r[i][1]==e)return;r.push([n,e])},n.removeListener=function(t,n,e){var r=this.dict[t];if(null!=r){for(var i=0,a=r.length;i<a;i++)if(r[i][0]==n&&r[i][1]==e){r.splice(i,1);break}0==r.length&&(this.dict[t]=null,delete this.dict[t])}},n.emit=function(t){if(null!=this.dict[t]){for(var n=arguments.length,e=new Array(n>1?n-1:0),r=1;r<n;r++)e[r-1]=arguments[r];this.dealMsg(t,void 0,e)}},n.dealMsg=function(t,n){for(var e,r=this.dict[t],i=0,a=r.length,c=null,s=arguments.length,u=new Array(s>2?s-2:0),l=2;l<s;l++)u[l-2]=arguments[l];for(;i<a;){var h;if(c=r[i],!n||n&&n==c[1])e=(h=c[0]).apply.apply(h,[c[1]].concat(u));r.length!=a&&(a=r.length,i--),i++}return e},t}());e=r,r.Ins=new e,n._RF.pop()}}}));

System.register("chunks:///_virtual/FailVideoAction.ts",["./rollupPluginModLoBabelHelpers.js","cc","./BaseWindows.ts","./Enums.ts","./Global.ts","./XStorage.ts","./EventsManager.ts","./AudioManager.ts","./TipsManagerAction.ts","./TipsAction.ts","./CrazyAdManger.ts"],(function(n){var o,i,t,e,c,a,s,r,l,u,_,d,f,p,h,w,A;return{setters:[function(n){o=n.applyDecoratedDescriptor,i=n.inheritsLoose,t=n.initializerDefineProperty,e=n.assertThisInitialized},function(n){c=n.cclegacy,a=n._decorator,s=n.Label},function(n){r=n.BaseWindows},function(n){l=n.GAME_STATE,u=n.EventTyps},function(n){_=n.Global},function(n){d=n.XStorage},function(n){f=n.EventsManager},function(n){p=n.AudioManager},function(n){h=n.TipsManagerAction},function(n){w=n.TIPS_TYPE},function(n){A=n.CrazyAdManger}],execute:function(){var g,v,y,b,E;c._RF.push({},"34cbaiC49dNrKkCdHygHlqQ","FailVideoAction",void 0);var I=a.ccclass,M=a.property;n("FailVideoAction",(g=I("FailVideoAction"),v=M(s),g((E=o((b=function(n){function o(){for(var o,i=arguments.length,c=new Array(i),a=0;a<i;a++)c[a]=arguments[a];return o=n.call.apply(n,[this].concat(c))||this,t(o,"coin_label",E,e(o)),o.call_back=null,o}i(o,n);var c=o.prototype;return c.start=function(){},c.update=function(n){},c.show_windows=function(o,i,t){void 0===o&&(o=null),void 0===i&&(i=null),void 0===t&&(t=l.PAUSE),n.prototype.show_windows.call(this,o,i,t),this.coin_label.string=_.FAIL_VIDEO_COIN+"",this.call_back=i},c.close_windows=function(o,i){n.prototype.close_windows.call(this,o,i)},c.on_click_video=function(){p.instance.play_shot("menuclose");var n=this;A.show_video((function(o){1==o?(d.reset_fail_count(),n.reward()):h.show("Watch Video to Continue",w.WARN)}))},c.on_click_coin=function(){p.instance.play_shot("menuclose");var n=d.get_cur_coins(),o=_.FAIL_VIDEO_COIN;n>=o?(d.record_coins(n-o),f.Ins.emit(u.UPDATE_COIN),d.reset_fail_count(),this.reward()):h.show("Not Enough Gold",w.WARN)},c.reward=function(){this.close_windows(null),this.call_back()},o}(r)).prototype,"coin_label",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),y=b))||y));c._RF.pop()}}}));

System.register("chunks:///_virtual/GameBgLayer.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Logger.ts","./Global.ts","./CellManager.ts"],(function(e){var r,t,l,a,n,o,i,c,s,g,u,p,f,_;return{setters:[function(e){r=e.applyDecoratedDescriptor,t=e.inheritsLoose,l=e.initializerDefineProperty,a=e.assertThisInitialized},function(e){n=e.cclegacy,o=e._decorator,i=e.Prefab,c=e.UITransform,s=e.instantiate,g=e.Vec3,u=e.Component},function(e){p=e.Logger},function(e){f=e.Global},function(e){_=e.CellManager}],execute:function(){var h,d,m,v,y,L,b;n._RF.push({},"c6dffdlrmVLoICdg8ZKjdIB","GameBgLayer",void 0);var C=o.ccclass,G=o.property;e("GameBgLayer",(h=C("GameBgLayer"),d=G(i),m=G(i),h((L=r((y=function(e){function r(){for(var r,t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return r=e.call.apply(e,[this].concat(n))||this,l(r,"cell_light",L,a(r)),l(r,"cell_dark",b,a(r)),r}t(r,e);var n=r.prototype;return n.onLoad=function(){f.game_bg_layer=this},n.start=function(){},n.update=function(e){},n.init_bg_cell=function(){if(this.cell_light&&this.cell_dark){f.game_logic_action;var e=_.cell_map.length,r=f.GAME_WIDTH,t=f.GAME_HEIGHT;e%t!=0&&p.warn("Cell Map 长度 ("+e+") 无法被 COLS ("+t+") 整除。请检查 COLS 设置是否正确。"),this.node.removeAllChildren();for(var l=this.getComponent(c),a=0;a<e;a++){var n=_.cell_map[a];if(n){var o=(Math.floor(a/t)+a%t)%2==0?this.cell_dark:this.cell_light,i=s(o);this.node.addChild(i);var u=new g;f.game_logic_action.game_scene_transform.convertToWorldSpaceAR(n.get_local_postion(),u);var h=new g;l&&l.convertToNodeSpaceAR(u,h),i.setPosition(h)}}p.log("成功根据 Cell Map (1D) 创建 "+r+"x"+t+" 格子背景。")}else p.error("GameBgLayer: Light or Dark cell prefabs are not set.")},r}(u)).prototype,"cell_light",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),b=r(y.prototype,"cell_dark",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),v=y))||v));n._RF.pop()}}}));

System.register("chunks:///_virtual/GameEnemyLayerAction.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Global.ts","./ResourcePool.ts","./EnemyAction.ts","./Enums.ts","./CellManager.ts","./Tools.ts","./EventsManager.ts","./Logger.ts","./XStorage.ts","./AudioManager.ts","./AdManger.ts"],(function(e){var t,n,r,o,s,a,i,c,_,l,u,h,f,p,g,m,d,y,b,E,v,A,w,M,x,R;return{setters:[function(e){t=e.applyDecoratedDescriptor,n=e.inheritsLoose,r=e.initializerDefineProperty,o=e.assertThisInitialized,s=e.asyncToGenerator,a=e.regeneratorRuntime},function(e){i=e.cclegacy,c=e._decorator,_=e.Sprite,l=e.Node,u=e.Vec3,h=e.Component,f=e.UITransform},function(e){p=e.Global},function(e){g=e.ResourcePool},function(e){m=e.EnemyAction},function(e){d=e.EventTyps,y=e.GAME_STATE,b=e.DRAGON_TYPE},function(e){E=e.CellManager},function(e){v=e.Tools},function(e){A=e.EventsManager},function(e){w=e.Logger},function(e){M=e.XStorage},function(e){x=e.AudioManager},function(e){R=e.AdManger}],execute:function(){var T,P,N,k,G,L,D;i._RF.push({},"7bb18+JFFJEWJK0ZyDZheFd","GameEnemyLayerAction",void 0);var S=c.ccclass,F=c.property;e("GameEnemyLayerAction",(T=S("GameEnemyLayerAction"),P=F(_),N=F(l),T((L=t((G=function(e){function t(){for(var t,n=arguments.length,s=new Array(n),a=0;a<n;a++)s[a]=arguments[a];return(t=e.call.apply(e,[this].concat(s))||this).ENEMY_PREFAB_NAME="enemy",r(t,"enemy_bg_sprite",L,o(t)),r(t,"boss_tips_layer",D,o(t)),t.boss_pos=null,t.is_fight=!1,t}n(t,e);var i=t.prototype;return i.onLoad=function(){p.game_enemy_layer_action=this,A.Ins.addListener(d.CLEAR_ENEMY_LAYER,this.clear_layer,this),A.Ins.addListener(d.FIGHT_RESULT,this.check_fight_result,this)},i.start=function(){},i.is_fight_status=function(){return this.is_fight},i.fight_status=function(e){this.is_fight=e,this.enemy_bg_sprite.node.active=!!e},i.update=function(e){},i.check_fight_result=function(){if(this.is_fight)if(M.get_cur_heart()<=0)this.fight_status(!1),p.set_game_state(y.PAUSE),p.ui_layer_action.show_win("Lose");else{for(var e=this.node.children,t=0,n=e.length-1;n>=0;n--){if(e[n].getComponent(m)){t++;break}}if(0==t){this.fight_status(!1),M.record_swap(5),A.Ins.emit(d.UPDATE_SWAP);var r=M.get_cur_sun()+1;M.record_sun(r),A.Ins.emit(d.UPDATE_SUN),this.create_target_pos(),r%10==0&&this.create_jt(),R.show_interstial(1)}}else w.log("战斗结束了。重复检测，跳过")},i.clear_layer=function(){this.fight_status(!1);for(var e=this.node.children,t=e.length-1;t>=0;t--){var n=e[t];g.instance.remove_node(n)}this.clear_jt()},i.clear_jt=function(){for(var e=this.boss_tips_layer.children,t=e.length-1;t>=0;t--){var n=e[t];g.instance.remove_node(n)}},i.random_enemy=function(){var e=s(a().mark((function e(){var t;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.fight_status(!0),x.instance.play_shot("battlestart"),(t=M.get_cur_sun())%10!=0){e.next=8;break}return e.next=6,this.create_boss();case 6:e.next=10;break;case 8:return e.next=10,this.create_dragon(t);case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),i.create_jt=function(){var e=s(a().mark((function e(){var t;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new u,this.boss_tips_layer.getComponent(f).convertToNodeSpaceAR(this.boss_pos,t),t.y=0,e.next=5,g.instance.create_by_Pool("Jt",null,this.boss_tips_layer,!0);case 5:e.sent.setPosition(t);case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),i.create_target_pos=function(){var e=E.cell_map.slice(0,p.GAME_WIDTH),t=e[v.random_between_floor(0,e.length)];this.boss_pos=new u,p.game_logic_action.game_scene_transform.convertToWorldSpaceAR(t.get_local_postion(),this.boss_pos);var n=v.random_between_floor(0,20)*(Math.random()>.5?1:-1),r=v.random_between_floor(20,130)*(Math.random()>.5?1:-1);this.boss_pos=new u(this.boss_pos.x+n,this.boss_pos.y+r-500)},i.create_boss=function(){var e=s(a().mark((function e(){var t,n;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.clear_jt(),null==this.boss_pos&&this.create_target_pos(),e.next=4,g.instance.create_by_Pool(this.ENEMY_PREFAB_NAME,this.boss_pos,this.node,!0);case 4:n=e.sent,null==(t=n.getComponent(m))||t.init_enemy(p.game_logic_action.get_cell_logic(),b.DRAGON_MOTHER,!0);case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),i.create_dragon=function(){var e=s(a().mark((function e(t){var n,r,o,s,i,c,_,l,h,f;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=3*t,r=0;case 3:if(!(r<n)){e.next=19;break}return s=E.cell_map,i=s.slice(0,p.GAME_WIDTH),c=i[v.random_between_floor(0,i.length)],_=new u,p.game_logic_action.game_scene_transform.convertToWorldSpaceAR(c.get_local_postion(),_),l=v.random_between_floor(0,20)*(Math.random()>.5?1:-1),h=v.random_between_floor(20,130)*(Math.random()>.5?1:-1),_=new u(_.x+l,_.y+h-800),e.next=14,g.instance.create_by_Pool(this.ENEMY_PREFAB_NAME,_,this.node,!0);case 14:f=e.sent,null==(o=f.getComponent(m))||o.init_enemy(p.game_logic_action.get_cell_logic(),b.DRAGON,!0);case 16:r++,e.next=3;break;case 19:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),i.dragonmother_boom=function(){var e=s(a().mark((function e(t){var n,r,o,s,i,c,_;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=M.get_cur_sun(),r=0;case 2:if(!(r<n)){e.next=13;break}return s=v.random_between_floor(10,35)*(Math.random()>.5?1:-1),i=v.random_between_floor(10,30)*(Math.random()>.5?1:-1),c=new u(t.x+s,t.y+i),e.next=8,g.instance.create_by_Pool(this.ENEMY_PREFAB_NAME,c,this.node,!0);case 8:_=e.sent,null==(o=_.getComponent(m))||o.init_enemy(p.game_logic_action.get_cell_logic(),b.DRAGON,0==r);case 10:r++,e.next=2;break;case 13:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),t}(h)).prototype,"enemy_bg_sprite",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),D=t(G.prototype,"boss_tips_layer",[N],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),k=G))||k));i._RF.pop()}}}));

System.register("chunks:///_virtual/GameLogicAction.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Enums.ts","./EventsManager.ts","./Logger.ts","./Global.ts","./XStorage.ts","./CellForLogic.ts","./CellAction.ts","./CrazySDK.ts"],(function(e){var t,n,i,r,s,o,a,c,l,_,g,u,m,h,f,p,d,y,A,T,v;return{setters:[function(e){t=e.applyDecoratedDescriptor,n=e.inheritsLoose,i=e.initializerDefineProperty,r=e.assertThisInitialized,s=e.asyncToGenerator,o=e.regeneratorRuntime},function(e){a=e.cclegacy,c=e._decorator,l=e.Node,_=e.Size,g=e.UITransform,u=e.Component},function(e){m=e.EventTyps,h=e.GAME_STATE},function(e){f=e.EventsManager},function(e){p=e.Logger},function(e){d=e.Global},function(e){y=e.XStorage},function(e){A=e.CellForLogic},function(e){T=e.CellAction},function(e){v=e.default}],execute:function(){var w,E,S,C,L;a._RF.push({},"62db10fdkdEVZw6xd4OqZb/","GameLogicAction",void 0);var z=c.ccclass,I=c.property;e("GameLogicAction",(w=z("GameLogicAction"),E=I(l),w((L=t((C=function(e){function t(){for(var t,n=arguments.length,s=new Array(n),o=0;o<n;o++)s[o]=arguments[o];return t=e.call.apply(e,[this].concat(s))||this,i(t,"game_scene",L,r(t)),t.game_scene_transform=null,t.cell_size=0,t.game_scene_size=new _(0,0),t.isProcessing=!1,t.cell_logic=null,t}n(t,e);var a=t.prototype;return a.onLoad=function(){d.game_logic_action=this,f.Ins.addListener(m.START_GAME,this.start_game,this),f.Ins.addListener(m.RELIFE,this.relife,this),f.Ins.addListener(m.ITEM_PLACEMENT_ATTEMPT,this.item_placement_attempt,this),this.game_scene&&(this.game_scene_transform=this.game_scene.getComponent(g),this.game_scene_transform&&(this.game_scene_size.width=this.game_scene_transform.width,this.game_scene_size.height=this.game_scene_transform.height))},a.item_placement_attempt=function(){var e=s(o().mark((function e(t,n){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:p.log("item_placement_attempt>>",t,n),this.cell_logic.placement(n.getComponent(T).get_cell_index(),t);case 2:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}(),a.relife=function(){var e=s(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:d.game_enemy_layer_action.clear_layer(),d.set_game_state(h.READY),y.record_heart(5),y.record_swap(5),f.Ins.emit(m.UPDATE_SWAP),f.Ins.emit(m.UPDATE_HEART),d.ui_layer_action.show_win("Count",null,(function(){p.log("~~~~~ 倒计时结束，start game！"),d.set_game_state(h.START)})),d.set_game_state(h.START);case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),a.start_game=function(){var e=s(o().mark((function e(t){var n,i=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:void 0===t&&(t=!1),this.cell_logic&&this.cell_logic.destroy(),this.game_scene.removeAllChildren(),d.castle_action.clear_arrow_tower(),f.Ins.emit(m.SYNC_SUN),f.Ins.emit(m.SYN_COIN),f.Ins.emit(m.SWAP_DATA_CHANGE),n=function(){t?p.log("默认游戏"):(y.clear_cell_data(),p.log("手动游戏"),y.increase_today_fail_count()),i.cell_logic=new A,p.log("初始化 CellForLogic");var e=new l("cell_layer");i.game_scene.addChild(e),i.cell_logic.init(e,i.game_scene_transform),i.cell_logic.start_game()},y.is_fail_count_reached()?d.ui_layer_action.show_win("Fail_video",null,(function(e){p.log("返回游戏继续操作",e),n()})):n(),this.scheduleOnce((function(){v.is_inited()?v.game.gameplayStart():(console.log("CrazySDK 1 没有初始化"),i.scheduleOnce((function(){v.is_inited()?v.game.gameplayStart():console.log("CrazySDK 2 没有初始化")}),5.2))}),1.2);case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),a.onDestroy=function(){f.Ins.removeListener(m.START_GAME,this.start_game,this)},a.getCellSize=function(){return 0===this.cell_size&&this.game_scene_transform&&(this.cell_size=this.game_scene_transform.width/d.GAME_WIDTH),this.cell_size},a.get_cell_logic=function(){return this.cell_logic},a.print_info=function(){this.cell_logic&&this.cell_logic.print_info()},t}(u)).prototype,"game_scene",[E],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),S=C))||S));a._RF.pop()}}}));

System.register("chunks:///_virtual/Global.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Enums.ts","./Logger.ts"],(function(o){var t,_,e,a,s,i;return{setters:[function(o){t=o.createClass},function(o){_=o.cclegacy,e=o._decorator},function(o){a=o.GAME_STATE,s=o.DRAGON_TYPE},function(o){i=o.Logger}],execute:function(){var n,r;_._RF.push({},"044d17e2pBH87JlclEC1tow","Global",void 0);var m=e.ccclass;e.property,o("Global",m("Global")(((r=function(){function o(){}return o.get_dragon_config=function(t){var _=o.dragon_config_map.get(t);return _||(_=o.dragon_config_map.get(s.DRAGON_DEFAULT)),_},o.get_cell_config=function(t,_){var e=o.cell_config_map.get(_);return e||(e=o.cell_config_map.get(t)),e},o.get_bullet_config=function(t,_){var e=o.bullet_config_map.get(_);return e||(e=o.bullet_config_map.get(t)),e},o.init_once=function(t,_,e){o.volum_sound=t,o.volum_music=_,o.cell_500_tips=e,i.log(">>>>>>>loaded_once>>")},o.loaded_once=function(){},o.set_game_state=function(t,_){void 0===_&&(_="default"),o.game_stat=t,i.log("set game state,",o.get_state_info_msg()," actions:",_)},o.get_state_info_msg=function(){return o._game_state==a.READY?"READY":o._game_state==a.START?"START":o._game_state==a.END?"END":o._game_state==a.PAUSE?"PAUSE":"--"},o.get_game_state=function(){return o.game_stat},o.upgrade_cell=function(o){return o+1},t(o,null,[{key:"_game_state",get:function(){return o.game_stat}}]),o}()).loading_rate=0,r.game_stat=a.READY,r.ui_layer_action=void 0,r.game_logic_action=void 0,r.game_enemy_layer_action=void 0,r.game_bg_layer=void 0,r.castle_action=void 0,r.gift_coins=500,r.skin_cost=1800,r.MAX_LOTTERY_COUNT=4,r.MAX_FAIL_COUNT=10,r.RELIFE_COST=100,r.REFRESH_BUY_ITEM=500,r.FAIL_VIDEO_COIN=100,r.volum_sound=0,r.volum_music=0,r.drop_flag=!1,r.cell_500_tips=!1,r.is_review_model=!1,r.ad_intersitial_arr=["adunit-877b93ffa0735727","adunit-6a9633f0443525f1"],r.ad_video_id="adunit-66f14362012d3692",r.ad_banner_id=void 0,r.ad_custom_id=["adunit-e82fe192ca3ac3a1","adunit-5284a0c41694165b"],r.GAME_WIDTH=6,r.GAME_HEIGHT=6,r.STEP_MAX=5,r.TOTAL_CELLS=r.GAME_WIDTH*r.GAME_HEIGHT,r.CELL_PREFAB_NAME="Cell_",r.cell_type_arr=[100,200,300,400,500],r.dragon_config_map=new Map([[s.DRAGON,{move_speed:100,attack:1,hp:100}],[s.DRAGON_MOTHER,{move_speed:100,attack:1,hp:1200}],[s.DRAGON_DEFAULT,{move_speed:100,attack:1,hp:1600}]]),r.cell_config_map=new Map([[100,{shoot_timer:2,slow_ratio:0,swap_count:0}],[101,{shoot_timer:2,slow_ratio:0,swap_count:0}],[102,{shoot_timer:1.2,slow_ratio:0,swap_count:0}],[103,{shoot_timer:.6,slow_ratio:0,swap_count:0}],[104,{shoot_timer:.5,slow_ratio:0,swap_count:0}],[105,{shoot_timer:.4,slow_ratio:0,swap_count:0}],[200,{shoot_timer:1.2,slow_ratio:0,swap_count:0}],[201,{shoot_timer:1.2,slow_ratio:0,swap_count:0}],[202,{shoot_timer:.8,slow_ratio:0,swap_count:0}],[203,{shoot_timer:.3,slow_ratio:0,swap_count:0}],[204,{shoot_timer:.2,slow_ratio:0,swap_count:0}],[205,{shoot_timer:.1,slow_ratio:0,swap_count:0}],[300,{shoot_timer:3,slow_ratio:0,swap_count:0}],[301,{shoot_timer:3,slow_ratio:0,swap_count:0}],[302,{shoot_timer:1.5,slow_ratio:0,swap_count:0}],[303,{shoot_timer:.7,slow_ratio:0,swap_count:0}],[304,{shoot_timer:.6,slow_ratio:0,swap_count:0}],[304,{shoot_timer:.5,slow_ratio:0,swap_count:0}],[400,{shoot_timer:0,slow_ratio:.5,swap_count:0}],[401,{shoot_timer:0,slow_ratio:.5,swap_count:0}],[402,{shoot_timer:0,slow_ratio:.6,swap_count:0}],[403,{shoot_timer:0,slow_ratio:.7,swap_count:0}],[404,{shoot_timer:0,slow_ratio:.8,swap_count:0}],[405,{shoot_timer:0,slow_ratio:.85,swap_count:0}],[500,{shoot_timer:0,slow_ratio:0,swap_count:3}],[501,{shoot_timer:0,slow_ratio:0,swap_count:4}],[502,{shoot_timer:0,slow_ratio:0,swap_count:5}],[503,{shoot_timer:0,slow_ratio:0,swap_count:6}],[504,{shoot_timer:0,slow_ratio:0,swap_count:7}],[505,{shoot_timer:0,slow_ratio:0,swap_count:8}]]),r.bullet_config_map=new Map([[100,{move_speed:200,damage:100}],[101,{move_speed:200,damage:100}],[102,{move_speed:200,damage:100}],[103,{move_speed:200,damage:100}],[104,{move_speed:200,damage:100}],[105,{move_speed:200,damage:100}],[200,{move_speed:500,damage:50}],[201,{move_speed:500,damage:50}],[202,{move_speed:500,damage:50}],[203,{move_speed:500,damage:50}],[204,{move_speed:500,damage:50}],[205,{move_speed:500,damage:50}],[300,{move_speed:500,damage:100}],[301,{move_speed:500,damage:100}],[302,{move_speed:500,damage:100}],[303,{move_speed:500,damage:100}],[304,{move_speed:500,damage:100}],[305,{move_speed:500,damage:100}]]),n=r))||n);_._RF.pop()}}}));

System.register("chunks:///_virtual/ItemAction.ts",["./rollupPluginModLoBabelHelpers.js","cc","./EventsManager.ts","./Enums.ts","./ResourceManger.ts","./AudioManager.ts"],(function(t){var e,i,n,r,o,s,a,u,l,c,p,m,h,_,f,y,b;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,n=t.initializerDefineProperty,r=t.assertThisInitialized},function(t){o=t.cclegacy,s=t._decorator,a=t.Button,u=t.Sprite,l=t.Label,c=t.Node,p=t.UITransform,m=t.Size,h=t.Component},function(t){_=t.EventsManager},function(t){f=t.EventTyps},function(t){y=t.default},function(t){b=t.AudioManager}],execute:function(){var d,g,I,v,E,C,A,D,M;o._RF.push({},"6b3a2F7eApNh6+jRpa5M2nQ","ItemAction",void 0);var T=s.ccclass,z=s.property;t("ItemAction",(d=T("ItemAction"),g=z(a),I=z(u),v=z(l),d((A=e((C=function(t){function e(){for(var e,i=arguments.length,o=new Array(i),s=0;s<i;s++)o[s]=arguments[s];return(e=t.call.apply(t,[this].concat(o))||this).itemDataIndex=-1,n(e,"itemButton",A,r(e)),n(e,"item_sprite",D,r(e)),n(e,"item_num_label",M,r(e)),e.base_type=0,e.step=0,e}i(e,t);var o=e.prototype;return o.onLoad=function(){this.itemButton?this.itemButton.node.on(a.EventType.CLICK,this.onClickItem,this):this.node.on(c.EventType.TOUCH_END,this.onClickItem,this)},o.init=function(t,e,i,n){this.itemDataIndex=t,this.base_type=e,this.step=i,this.item_num_label.string=n+"",this.reset_sprite()},o.get_cell_type=function(){return this.base_type+this.step},o.reset_sprite=function(){if(this.item_sprite){var t=y.instance.get_ui("cell_"+this.get_cell_type());t&&(this.item_sprite.spriteFrame=t),this.item_sprite.node.getComponent(p).setContentSize(new m(50,50))}},o.onClickItem=function(){b.instance.play_shot("menuclose"),_.Ins.emit(f.ITEM_SELECTED,this.itemDataIndex,this.node)},e}(h)).prototype,"itemButton",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),D=e(C.prototype,"item_sprite",[I],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),M=e(C.prototype,"item_num_label",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),E=C))||E));o._RF.pop()}}}));

System.register("chunks:///_virtual/ItemsAction.ts",["./rollupPluginModLoBabelHelpers.js","cc","./BaseWindows.ts","./Enums.ts","./AudioManager.ts","./ResourcePool.ts","./ItemAction.ts","./EventsManager.ts","./ResourceManger.ts","./Global.ts","./Logger.ts","./CellAction.ts","./XStorage.ts","./BuyShowAction.ts"],(function(e){var t,i,o,n,s,r,h,a,c,d,l,g,u,_,p,m,v,f,w,I,N,b,y,T,E,C,H,S,x,A,M;return{setters:[function(e){t=e.applyDecoratedDescriptor,i=e.inheritsLoose,o=e.initializerDefineProperty,n=e.assertThisInitialized,s=e.createForOfIteratorHelperLoose,r=e.asyncToGenerator,h=e.regeneratorRuntime,a=e.extends},function(e){c=e.cclegacy,d=e._decorator,l=e.ScrollView,g=e.Node,u=e.UITransform,_=e.Sprite,p=e.UIOpacity,m=e.Color,v=e.Size,f=e.v3},function(e){w=e.BaseWindows},function(e){I=e.EventTyps,N=e.GAME_STATE},function(e){b=e.AudioManager},function(e){y=e.ResourcePool},function(e){T=e.ItemAction},function(e){E=e.EventsManager},function(e){C=e.default},function(e){H=e.Global},function(e){S=e.Logger},function(e){x=e.CellAction},function(e){A=e.XStorage},function(e){M=e.BuyShowAction}],execute:function(){var L,k,P,D,U,z,O,B,R,V,W;c._RF.push({},"ccd14zh0JVL6aOqvzChnJms","ItemsAction",void 0);var F=d.ccclass,G=d.property;e("ItemsAction",(L=F("ItemsAction"),k=G(l),P=G(g),D=G(M),U=G(g),L((B=t((O=function(e){function t(){for(var t,i=arguments.length,s=new Array(i),r=0;r<i;r++)s[r]=arguments[r];return t=e.call.apply(e,[this].concat(s))||this,o(t,"scroll_view",B,n(t)),o(t,"base_show",R,n(t)),o(t,"buy_show_action",V,n(t)),o(t,"selected_show",W,n(t)),t.currentSelectedItem=null,t.draggedItemNode=null,t.hoveredHighlightNode=null,t}i(t,e);var c=t.prototype;return c.onLoad=function(){e.prototype.onLoad.call(this),E.Ins.addListener(I.ITEM_SELECTED,this.onItemSelected,this),E.Ins.addListener(I.ADD_NEW_ITEM,this.add_new_item,this),this.node.on(g.EventType.TOUCH_MOVE,this.onTouchMove,this,!0),this.node.on(g.EventType.TOUCH_END,this.onTouchEnd,this,!0),this.node.on(g.EventType.TOUCH_CANCEL,this.onTouchEnd,this,!0),this.selected_show.active=!1,this.hoveredHighlightNode=new g("HoveredHighlight");this.hoveredHighlightNode.addComponent(u);var t=this.hoveredHighlightNode.addComponent(_),i=this.hoveredHighlightNode.addComponent(p);t.spriteFrame=C.instance.get_ui("b12"),t.color=new m(255,255,0,128),i.opacity=128,this.hoveredHighlightNode.parent=this.selected_show,this.hoveredHighlightNode.active=!1},c.onDestroy=function(){e.prototype.onDestroy.call(this),E.Ins.removeListener(I.ITEM_SELECTED,this.onItemSelected,this),this.node.off(g.EventType.TOUCH_MOVE,this.onTouchMove,this,!0),this.node.off(g.EventType.TOUCH_END,this.onTouchEnd,this,!0),this.node.off(g.EventType.TOUCH_CANCEL,this.onTouchEnd,this,!0),this.hoveredHighlightNode&&this.hoveredHighlightNode.isValid&&(this.hoveredHighlightNode.destroy(),this.hoveredHighlightNode=null)},c.onItemSelected=function(e,t){if(this.base_show&&this.selected_show){var i=t.getComponent(T);if(i){this.base_show.active=!1,this.buy_show_action.node.active=!1,this.currentSelectedItem={index:e,base_type:i.base_type,step:i.step},this.draggedItemNode&&this.draggedItemNode.isValid&&(y.instance.remove_node(this.draggedItemNode),this.draggedItemNode=null);var o=C.instance.get_ui("cell_"+i.get_cell_type());this.draggedItemNode=new g("DraggedItem"),this.draggedItemNode.addComponent(u),this.draggedItemNode.addComponent(_).spriteFrame=o,this.draggedItemNode.getComponent(u).setContentSize(new v(100,100)),this.draggedItemNode.parent=this.selected_show,this.draggedItemNode.setSiblingIndex(this.hoveredHighlightNode.getSiblingIndex()+1),this.selected_show.active=!0;var n=t.worldPosition.clone();this.draggedItemNode.setWorldPosition(n),this.hoveredHighlightNode&&(this.hoveredHighlightNode.active=!1)}}},c.onTouchMove=function(e){var t;if(this.draggedItemNode&&this.selected_show.active&&H.game_logic_action.get_cell_logic()&&this.hoveredHighlightNode){var i=e.getUILocation(),o=(null==(t=this.selected_show.getComponent(u))?void 0:t.convertToNodeSpaceAR(f(i.x,i.y,0)))||f();this.draggedItemNode.setPosition(o);for(var n,r=null,h=H.game_logic_action.get_cell_logic().get_all_cell(),a=s(h);!(n=a()).done;){var c=n.value,d=c.getComponent(u);if(d)if(d.getBoundingBoxToWorld().contains(i)){r=c;break}}if(r){this.hoveredHighlightNode.active=!0;var l,g=r.getComponent(u);if(g)null==(l=this.hoveredHighlightNode.getComponent(u))||l.setContentSize(g.contentSize),this.hoveredHighlightNode.setWorldPosition(r.worldPosition);this.hoveredHighlightNode.setSiblingIndex(0),this.draggedItemNode.setSiblingIndex(1)}else this.hoveredHighlightNode.active=!1}},c.onTouchEnd=function(e){if(this.draggedItemNode&&this.selected_show.active&&this.hoveredHighlightNode){this.hoveredHighlightNode.active=!1;for(var t,i=e.getUILocation(),o=(f(i.x,i.y,0),null),n=H.game_logic_action.get_cell_logic().get_all_cell(),r=s(n);!(t=r()).done;){var h=t.value,a=h.getComponent(u);if(a)if(a.getBoundingBoxToWorld().contains(i)){o=h;break}}var c=!1;if(o){var d=o.getComponent(x);this.currentSelectedItem&&d&&(S.log("在 Cell "+d.get_cell_index()+" 上释放",this.currentSelectedItem),c=!0)}var l=null;this.currentSelectedItem&&(l={index:this.currentSelectedItem.index,base_type:this.currentSelectedItem.base_type,step:this.currentSelectedItem.step}),this.currentSelectedItem=null,this.selected_show.active=!1,this.draggedItemNode&&this.draggedItemNode.isValid&&(y.instance.remove_node(this.draggedItemNode),this.draggedItemNode=null),c?(E.Ins.emit(I.ITEM_PLACEMENT_ATTEMPT,l,o),this.on_click_close(),this.deduct_item(l),A.record_item_btn(1),E.Ins.emit(I.REFRESH_ITEM_BTN)):this.base_show&&(this.base_show.active=!0,this.buy_show_action.node.active=!0)}},c.start=function(){},c.update=function(e){},c.clear_scroll=function(){if(this.draggedItemNode&&this.draggedItemNode.isValid&&(y.instance.remove_node(this.draggedItemNode),this.draggedItemNode=null),this.hoveredHighlightNode&&(this.hoveredHighlightNode.active=!1),this.scroll_view&&this.scroll_view.content)for(var e=this.scroll_view.content.children.slice(),t=0;t<e.length;t++)y.instance.remove_node(e[t])},c.show_windows=function(){var t=r(h().mark((function t(i,o,n){return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(void 0===i&&(i=null),void 0===o&&(o=null),void 0===n&&(n=N.PAUSE),e.prototype.show_windows.call(this,i,o,n),this.scroll_view&&this.scroll_view.content){t.next=7;break}return S.error("ScrollView or its content node is missing!"),t.abrupt("return");case 7:return t.next=9,this._show_items();case 9:return t.next=11,this.buy_show_action.init();case 11:case"end":return t.stop()}}),t,this)})));return function(e,i,o){return t.apply(this,arguments)}}(),c.deduct_item=function(){var e=r(h().mark((function e(t){var i,o,n,s,r,c;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(S.log("deduct item >>>",t),i=A.get_item_list(),o=[],n=!1,s=0;s<i.length;s++)r=i[s],n||r.base_type!==t.base_type||r.step!==t.step?o.push(a({},r)):((c=r.itemNum-1)>0&&o.push({base_type:r.base_type,step:r.step,itemNum:c}),n=!0);A.record_item_list(o);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),c.add_new_item=function(){var e=r(h().mark((function e(t){var i,o,n,s;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:S.log("add_new_item>>>",t),i=A.get_item_list(),o=!1,n=0;case 4:if(!(n<i.length)){e.next=13;break}if((s=i[n]).base_type!=t.base_type||s.step!=t.step){e.next=10;break}return s.itemNum+=1,o=!0,e.abrupt("break",13);case 10:n++,e.next=4;break;case 13:o||i.push({base_type:t.base_type,step:t.step,itemNum:1}),A.record_item_list(i),this._show_items();case 16:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),c._show_items=function(){var e=r(h().mark((function e(){var t,i,o,n,r,a,c;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.clear_scroll(),this.base_show.active=!0,this.buy_show_action.node.active=!0,t=A.get_item_list(),i=0,o=s(t);case 6:if((n=o()).done){e.next=17;break}if(!((r=n.value).itemNum<=0||void 0===r.base_type||void 0===r.step)){e.next=10;break}return e.abrupt("continue",15);case 10:return e.next=12,y.instance.create_by_Pool("Item",null,this.scroll_view.content,!1);case 12:a=e.sent,(c=a.getComponent(T))&&c.init(i++,r.base_type,r.step,r.itemNum);case 15:e.next=6;break;case 17:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),c.close_windows=function(t,i){this.clear_scroll(),e.prototype.close_windows.call(this,t,i),E.Ins.emit(I.UPDATE_ITEM_COUNT)},c.on_click_close=function(){b.instance.play_shot("menuclose"),this.close_windows(N.START)},t}(w)).prototype,"scroll_view",[k],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),R=t(O.prototype,"base_show",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),V=t(O.prototype,"buy_show_action",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),W=t(O.prototype,"selected_show",[U],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),z=O))||z));c._RF.pop()}}}));

System.register("chunks:///_virtual/LimitedCollect.ts",["./rollupPluginModLoBabelHelpers.js","cc","./TipsManagerAction.ts","./TipsAction.ts","./XStorage.ts","./EventsManager.ts","./Enums.ts","./Logger.ts","./AudioManager.ts"],(function(t){var e,i,o,n,a,s,l,r,c,u,h,d,p,m,g,f,C,_,v,T,y;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,o=t.initializerDefineProperty,n=t.assertThisInitialized},function(t){a=t.cclegacy,s=t._decorator,l=t.Label,r=t.Button,c=t.Node,u=t.tween,h=t.Vec3,d=t.Animation,p=t.isValid,m=t.Component},function(t){g=t.TipsManagerAction},function(t){f=t.TIPS_TYPE},function(t){C=t.XStorage},function(t){_=t.EventsManager},function(t){v=t.EventTyps},function(t){T=t.Logger},function(t){y=t.AudioManager}],execute:function(){var L,I,S,D,w,b,A,E,M;a._RF.push({},"b9b237ST4lKa6C+FLuvFM14","LimitedCollect",void 0);var B=s.ccclass,U=s.property,O=6e5,F="LAST_COLLECT_DATE",R="DAILY_COLLECT_COUNT",k="LAST_COLLECT_TIME",N="USER_DIAMONDS";t("LimitedCollect",(L=B("LimitedCollect"),I=U(l),S=U(r),D=U(c),L((A=e((b=function(t){function e(){for(var e,i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return e=t.call.apply(t,[this].concat(a))||this,o(e,"statusLabel",A,n(e)),o(e,"collectButton",E,n(e)),o(e,"dou_2_animation_node",M,n(e)),e.userDiamonds=0,e.dailyCount=0,e.lastCollectTime=0,e}i(e,t);var a=e.prototype;return a.onLoad=function(){this.collectButton&&this.collectButton.node.on(r.EventType.CLICK,this.onCollectButtonClick,this)},a.start=function(){var t=this;this.node.active=!0,this.loadLocalData(),this.checkAndResetDailyData(),this.startUpdateLoop(),this.show_this_();var e=this;this.node.active&&this.scheduleOnce((function(){e.node.active&&u(t.node).to(.15,{scale:new h(2,2,2)}).to(.15,{scale:new h(1,1,1)}).call((function(){})).start()}),5)},a.onDestroy=function(){this.unschedule(this.updateUI)},a.padZero=function(t){return("0"+String(t)).slice(-2)},a.getFormattedDate=function(t){var e=t.getFullYear(),i=t.getMonth()+1,o=t.getDate();return e+"-"+this.padZero(i)+"-"+this.padZero(o)},a.loadLocalData=function(){this.userDiamonds=parseInt(localStorage.getItem(N)||"0"),this.dailyCount=parseInt(localStorage.getItem(R)||"0"),this.lastCollectTime=parseInt(localStorage.getItem(k)||"0"),0===this.lastCollectTime&&this.dailyCount>0&&(this.lastCollectTime=1)},a.checkAndResetDailyData=function(){var t=this.getFormattedDate(new Date);localStorage.getItem(F)!==t&&(this.dailyCount=0,this.lastCollectTime=0,localStorage.setItem(R,"0"),localStorage.setItem(k,"0"),localStorage.setItem(F,t),T.log("已跨天，每日领取次数重置。"))},a.startUpdateLoop=function(){this.schedule(this.updateUI,1),this.updateUI()},a.updateUI=function(){if(this.dailyCount>=6)this.setButtonState(!1,"Claim");else{if(this.lastCollectTime>0){var t=Date.now()-this.lastCollectTime,e=O-t;if(e>1e3){var i=Math.ceil(e/1e3),o=Math.floor(i/60),n=i%60,a=this.padZero(o),s=this.padZero(n);return void this.setButtonState(!1,a+":"+s)}}if(this.setButtonState(!0,"Claim"),this.dou_2_animation_node){var l=this.dou_2_animation_node.getComponent(d);l&&(l.once(d.EventType.FINISHED,(function(){}),this),l.play())}}},a.setButtonState=function(t,e){p(this.statusLabel)&&(this.statusLabel.string=e)},a.show_this_=function(){var t=this;if(this.dailyCount>=6){var e=this.node.position;u(this.node).to(.15,{position:new h(e.x+300,e.y,1)}).call((function(){t.node.active=!1})).start()}else t.node.active=!0},a.onCollectButtonClick=function(){if(y.instance.play_shot("menuclose"),this.dailyCount>=6)return g.show("Check Back Tomorrow",f.WARN),void this.show_this_();var t=Date.now();this.lastCollectTime>0&&t-this.lastCollectTime<O?g.show("One Moment",f.WARN):(this.userDiamonds+=25,this.dailyCount+=1,this.lastCollectTime=t,localStorage.setItem(N,this.userDiamonds.toString()),localStorage.setItem(R,this.dailyCount.toString()),localStorage.setItem(k,this.lastCollectTime.toString()),C.record_coins(C.get_cur_coins()+25),_.Ins.emit(v.UPDATE_COIN),g.show("Gold Received 25",f.OK),this.updateUI(),this.show_this_())},e}(m)).prototype,"statusLabel",[I],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),E=e(b.prototype,"collectButton",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),M=e(b.prototype,"dou_2_animation_node",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),w=b))||w));a._RF.pop()}}}));

System.register("chunks:///_virtual/LoadingAction.ts",["./rollupPluginModLoBabelHelpers.js","cc","./ResourceManger.ts","./Enums.ts","./Global.ts","./EventsManager.ts","./WxPlatform.ts","./BytePlantform.ts","./BaseWindows.ts","./Logger.ts","./CellManager.ts"],(function(e){var t,n,r,o,a,i,s,c,l,u,d,p,f,_,h,g,m,y,w,v,b;return{setters:[function(e){t=e.applyDecoratedDescriptor,n=e.inheritsLoose,r=e.initializerDefineProperty,o=e.assertThisInitialized,a=e.asyncToGenerator,i=e.regeneratorRuntime},function(e){s=e.cclegacy,c=e._decorator,l=e.Sprite,u=e.Label},function(e){d=e.default},function(e){p=e.EventTyps,f=e.GAME_STATE,_=e.AssetType},function(e){h=e.Global},function(e){g=e.EventsManager},function(e){m=e.WxPlatform},function(e){y=e.BytePlantform},function(e){w=e.BaseWindows},function(e){v=e.Logger},function(e){b=e.CellManager}],execute:function(){var L,A,x,E,S,k,M;s._RF.push({},"0f1e4kMbLNMJ6ryLe8c0HF5","LoadingAction",void 0);var R=c.ccclass,T=c.property;e("LoadingAction",(L=R("LoadingAction"),A=T({type:l}),x=T({type:u}),L((k=t((S=function(e){function t(){for(var t,n=arguments.length,a=new Array(n),i=0;i<n;i++)a[i]=arguments[i];return t=e.call.apply(e,[this].concat(a))||this,r(t,"load",k,o(t)),r(t,"ld_rate",M,o(t)),t._call_back=null,t._is_loading_completed=!1,t}n(t,e);var s=t.prototype;return s.onLoad=function(){g.Ins.addListener(p.LOAD_ASSETS_OVER,this.loaded_completed,this),h.loading_rate=0,this._is_loading_completed=!1},s.onDestroy=function(){g.Ins.removeListener(p.LOAD_ASSETS_OVER,this.loaded_completed,this)},s.start=function(){var e=a(i().mark((function e(){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),s.show_windows=function(){var t=a(i().mark((function t(n,r){return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return void 0===r&&(r=null),e.prototype.show_windows.call(this),this._call_back=r,m.ins.wechat_setting(),y.ins.bytedance_setting(),t.next=8,this.loadRes();case 8:case"end":return t.stop()}}),t,this)})));return function(e,n){return t.apply(this,arguments)}}(),s.close_windows=function(){var t=a(i().mark((function t(n){return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.prototype.close_windows.call(this,n);case 1:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}(),s.loadRes=function(){var e=a(i().mark((function e(){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,d.instance.load_bundle("remote",.2);case 3:return e.next=5,d.instance.load_resource("remote",_.Prefab,.3);case 5:return e.next=7,d.instance.load_resource("remote",_.Sound,.2);case 7:return e.next=9,d.instance.load_resource("remote",_.Ui,.3);case 9:h.loading_rate=1,g.Ins.emit(p.LOAD_ASSETS_OVER),e.next=16;break;case 13:e.prev=13,e.t0=e.catch(0),v.error("资源加载失败:",e.t0);case 16:case"end":return e.stop()}}),e,null,[[0,13]])})));return function(){return e.apply(this,arguments)}}(),s.loaded_completed=function(){var e=this;this._is_loading_completed||(this._is_loading_completed=!0,this.scheduleOnce((function(){h.loaded_once(),b.init_empty_cells(),e.close_windows(f.READY),e._call_back&&e._call_back()}),.5))},s.update=function(e){var t=Math.min(h.loading_rate,1);this.load&&(this.load.fillRange=t),this.ld_rate&&(this.ld_rate.string=Math.floor(100*t)+"")},t}(w)).prototype,"load",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),M=t(S.prototype,"ld_rate",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),E=S))||E));s._RF.pop()}}}));

System.register("chunks:///_virtual/Logger.ts",["cc"],(function(n){var r,o;return{setters:[function(n){r=n.cclegacy,o=n._decorator}],execute:function(){var L,e;r._RF.push({},"0dfbcHiIeRKFYETT+nxcfH3","Logger",void 0);var c=o.ccclass;n("Logger",c("Logger")(((e=function(){function n(){}return n.setEnable=function(r){n.ENABLE_LOG=r},n.setLevel=function(r){n.LOG_LEVEL=r},n.log=function(r){if(n.ENABLE_LOG&&n.LOG_LEVEL<=0){for(var o,L=arguments.length,e=new Array(L>1?L-1:0),c=1;c<L;c++)e[c-1]=arguments[c];(o=console).log.apply(o,[n.LOG_PREFIX,r].concat(e))}},n.warn=function(r){if(n.ENABLE_LOG&&n.LOG_LEVEL<=1){for(var o,L=arguments.length,e=new Array(L>1?L-1:0),c=1;c<L;c++)e[c-1]=arguments[c];(o=console).warn.apply(o,[n.LOG_PREFIX,r].concat(e))}},n.error=function(r){if(n.ENABLE_LOG&&n.LOG_LEVEL<=2){for(var o,L=arguments.length,e=new Array(L>1?L-1:0),c=1;c<L;c++)e[c-1]=arguments[c];(o=console).error.apply(o,[n.LOG_PREFIX,r].concat(e))}},n.network=function(r){if(n.ENABLE_LOG&&n.LOG_LEVEL<=0){for(var o,L=arguments.length,e=new Array(L>1?L-1:0),c=1;c<L;c++)e[c-1]=arguments[c];(o=console).log.apply(o,["[NetWork]",r].concat(e))}},n.uiWarning=function(r){if(n.ENABLE_LOG&&n.LOG_LEVEL<=1){for(var o,L=arguments.length,e=new Array(L>1?L-1:0),c=1;c<L;c++)e[c-1]=arguments[c];(o=console).warn.apply(o,["[UI_WARN]",r].concat(e))}},n}()).ENABLE_LOG=!0,e.LOG_LEVEL=0,e.LOG_PREFIX="[Tower]",L=e))||L);r._RF.pop()}}}));

System.register("chunks:///_virtual/LoseAction.ts",["./rollupPluginModLoBabelHelpers.js","cc","./BaseWindows.ts","./XStorage.ts","./LoseContent_1_Action.ts","./LoseContent_2_Action.ts","./AudioManager.ts"],(function(t){var n,o,e,i,c,s,r,a,_,u,l,h,p;return{setters:[function(t){n=t.applyDecoratedDescriptor,o=t.inheritsLoose,e=t.initializerDefineProperty,i=t.assertThisInitialized},function(t){c=t.cclegacy,s=t._decorator,r=t.Node,a=t.UIOpacity},function(t){_=t.BaseWindows},function(t){u=t.XStorage},function(t){l=t.LoseContent_1_Action},function(t){h=t.LoseContent_2_Action},function(t){p=t.AudioManager}],execute:function(){var w,f,d,g,y,b,A,v,L;c._RF.push({},"d3aafJMF9NESb9HYi/uvnj0","LoseAction",void 0);var m=s.ccclass,z=s.property;t("LoseAction",(w=m("LoseAction"),f=z(l),d=z(h),g=z(r),w((A=n((b=function(t){function n(){for(var n,o=arguments.length,c=new Array(o),s=0;s<o;s++)c[s]=arguments[s];return(n=t.call.apply(t,[this].concat(c))||this).random_coins=0,e(n,"content_1",A,i(n)),e(n,"content_2",v,i(n)),e(n,"bg_node",L,i(n)),n}o(n,t);var c=n.prototype;return c.start=function(){},c.update=function(t){},c.show_windows=function(){t.prototype.show_windows.call(this),this.bg_node&&(this.bg_node.getComponent(a).opacity=255),p.instance.play_shot("gameover"),u.get_cur_relife()>0?this.show_content_2():this.show_content_1()},c.show_content_1=function(){this.content_2.close_content(),this.content_1.show_content(this),this.content=this.content_1.node,this.show_content_tween()},c.show_content_2=function(){this.content_1.close_content(),this.content_2.show_content(this),this.content=this.content_2.node,this.show_content_tween()},c.close_windows=function(n){t.prototype.close_windows.call(this,n)},c.waitTime=function(t){var n=this;return new Promise((function(o,e){n.scheduleOnce((function(){o(!0)}),t)}))},n}(_)).prototype,"content_1",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),v=n(b.prototype,"content_2",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),L=n(b.prototype,"bg_node",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),y=b))||y));c._RF.pop()}}}));

System.register("chunks:///_virtual/LoseContent_1_Action.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Global.ts","./AudioManager.ts","./TipsManagerAction.ts","./TipsAction.ts","./Logger.ts","./XStorage.ts","./EventsManager.ts","./Enums.ts","./CrazyAdManger.ts"],(function(t){var n,e,i,o,a,c,s,r,_,l,f,u,h,p,m,d,b,g,v;return{setters:[function(t){n=t.applyDecoratedDescriptor,e=t.inheritsLoose,i=t.initializerDefineProperty,o=t.assertThisInitialized},function(t){a=t.cclegacy,c=t._decorator,s=t.Label,r=t.Node,_=t.Animation,l=t.Component},function(t){f=t.Global},function(t){u=t.AudioManager},function(t){h=t.TipsManagerAction},function(t){p=t.TIPS_TYPE},function(t){m=t.Logger},function(t){d=t.XStorage},function(t){b=t.EventsManager},function(t){g=t.EventTyps},function(t){v=t.CrazyAdManger}],execute:function(){var y,w,A,E,L,C,I,T,z,M,R;a._RF.push({},"93b46rG1qVM5Izzar/5tsSL","LoseContent_1_Action",void 0);var S=c.ccclass,N=c.property;t("LoseContent_1_Action",(y=S("LoseContent_1_Action"),w=N(s),A=N(r),E=N(r),L=N(s),y((T=n((I=function(t){function n(){for(var n,e=arguments.length,a=new Array(e),c=0;c<e;c++)a[c]=arguments[c];return n=t.call.apply(t,[this].concat(a))||this,i(n,"time",T,o(n)),i(n,"close_btn_node",z,o(n)),i(n,"coin_btn_node",M,o(n)),i(n,"coin_label",R,o(n)),n.root=void 0,n.effect_animation=void 0,n}e(n,t);var a=n.prototype;return a.start=function(){},a.update=function(t){},a.cur_=function(t){u.instance.play_shot("ztime")},a.close_content=function(){this.node.active=!1},a.show_content=function(t){var n=this;this.root=t,this.node.active=!0,this.effect_animation=this.node.getComponent(_);var e=this,i=d.get_cur_coins(),o=f.RELIFE_COST;i>=o?(this.coin_btn_node.active=!0,this.coin_label.string=o+""):this.coin_btn_node.active=!1,this.effect_animation&&(this.effect_animation.once(_.EventType.FINISHED,(function(t){m.log("倒计时结束",t),e.effect_animation=null,n.root.show_content_2()}),this),this.effect_animation.play()),this.close_btn_node.active=!1,this.scheduleOnce((function(){e.close_btn_node.active=!0}),1)},a.on_click_close=function(){u.instance.play_shot("menuclose"),this.effect_animation&&(this.effect_animation.stop(),this.effect_animation=null),this.root.show_content_2()},a.on_click_continue_by_coin=function(){u.instance.play_shot("menuclose"),this.effect_animation&&this.effect_animation.pause();var t=d.get_cur_coins(),n=f.RELIFE_COST;t>=n?(d.record_coins(t-n),b.Ins.emit(g.UPDATE_COIN),this.reward()):(h.show("Not Enough Gold",p.WARN),this.effect_animation&&this.effect_animation.play())},a.on_click_continue_by_video=function(){var t=this;u.instance.play_shot("menuclose"),this.effect_animation&&this.effect_animation.pause();var n=this;v.show_video((function(e){1==e?(h.show("Reward Claimed",p.OK),n.reward()):(h.show("Watch Video to Revive",p.WARN),t.effect_animation&&t.effect_animation.play())}))},a.reward=function(){this.root.close_windows(null),this.effect_animation&&(this.effect_animation.stop(),this.effect_animation=null),d.record_relife(1),b.Ins.emit(g.RELIFE);var t=d.get_cur_sun()+1;d.record_sun(t),b.Ins.emit(g.UPDATE_SUN)},n}(l)).prototype,"time",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),z=n(I.prototype,"close_btn_node",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),M=n(I.prototype,"coin_btn_node",[E],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),R=n(I.prototype,"coin_label",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),C=I))||C));a._RF.pop()}}}));

System.register("chunks:///_virtual/LoseContent_2_Action.ts",["./rollupPluginModLoBabelHelpers.js","cc","./AudioManager.ts","./XStorage.ts","./Global.ts","./Logger.ts","./TipsAction.ts","./TipsManagerAction.ts","./EventsManager.ts","./Enums.ts","./CrazyAdManger.ts"],(function(t){var n,e,o,i,r,a,s,c,l,u,_,f,g,p,d,h,v,b,y,m;return{setters:[function(t){n=t.applyDecoratedDescriptor,e=t.inheritsLoose,o=t.initializerDefineProperty,i=t.assertThisInitialized,r=t.asyncToGenerator,a=t.regeneratorRuntime},function(t){s=t.cclegacy,c=t._decorator,l=t.Label,u=t.Node,_=t.Component},function(t){f=t.AudioManager},function(t){g=t.XStorage},function(t){p=t.Global},function(t){d=t.Logger},function(t){h=t.TIPS_TYPE},function(t){v=t.TipsManagerAction},function(t){b=t.EventsManager},function(t){y=t.EventTyps},function(t){m=t.CrazyAdManger}],execute:function(){var A,w,M,T,C,L,z,E,I,P,R;s._RF.push({},"636bfkFXHxPu6694FXSImNb","LoseContent_2_Action",void 0);var S=c.ccclass,F=c.property;t("LoseContent_2_Action",(A=S("LoseContent_2_Action"),w=F(l),M=F(u),T=F(l),C=F({type:u,tooltip:"展示视频广告标识"}),A((E=n((z=function(t){function n(){for(var n,e=arguments.length,r=new Array(e),a=0;a<e;a++)r[a]=arguments[a];return n=t.call.apply(t,[this].concat(r))||this,o(n,"coin_label",E,i(n)),o(n,"sun_layout",I,i(n)),o(n,"sun_label",P,i(n)),o(n,"ad_video_node",R,i(n)),n.root=void 0,n}e(n,t);var s=n.prototype;return s.start=function(){},s.update=function(t){},s.close_content=function(){this.node.active=!1},s.show_content=function(t){this.root=t,this.node.active=!0,this.ad_video_node.active=!1,this.sun_label.string=g.get_cur_sun()+"";var n=g.get_cur_sun();d.log("本局获得阳光:",Math.floor(n)),n+=n/2,n=Math.floor(n),d.log("本局获得阳光(含额外奖励):",n),this.coin_label.string=n+"",g.record_coins(g.get_cur_coins()+n),b.Ins.emit(y.UPDATE_COIN),g.is_fail_count_reached()?(d.log("达到每日失败次数上限，展示广告选项。"),this.ad_video_node.active=!0):(d.log("未达到每日失败次数上限，不展示广告选项。"),this.ad_video_node.active=!1)},s.on_click_restart=function(){var t=r(a().mark((function t(){var n;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:f.instance.play_shot("menuclose"),n=this,g.is_fail_count_reached()?(d.log("每日游戏失败次数已达上限 "+p.MAX_FAIL_COUNT+"，尝试播放广告。"),m.show_video((function(t){1==t?(v.show("Limit Reset. Continue Game.",h.OK),g.reset_fail_count(),n._start_game_flow()):v.show("Watch Video to Continue",h.WARN)}))):(d.log("未达每日次数限制，直接开始游戏。"),this._start_game_flow());case 3:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),s._start_game_flow=function(){this.root.close_windows(null),b.Ins.emit(y.START_GAME)},n}(_)).prototype,"coin_label",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),I=n(z.prototype,"sun_layout",[M],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),P=n(z.prototype,"sun_label",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),R=n(z.prototype,"ad_video_node",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),L=z))||L));s._RF.pop()}}}));

System.register("chunks:///_virtual/LotteryAction.ts",["./rollupPluginModLoBabelHelpers.js","cc","./BaseWindows.ts","./TipsManagerAction.ts","./TipsAction.ts","./XStorage.ts","./EventsManager.ts","./Enums.ts","./AudioManager.ts","./Logger.ts","./Global.ts","./CrazyAdManger.ts"],(function(t){var e,n,i,o,a,r,l,s,c,u,p,d,b,_,h,y,g,f,T,v,R,L;return{setters:[function(t){e=t.applyDecoratedDescriptor,n=t.inheritsLoose,i=t.initializerDefineProperty,o=t.assertThisInitialized},function(t){a=t.cclegacy,r=t._decorator,l=t.Node,s=t.Label,c=t.Component,u=t.math,p=t.tween},function(t){d=t.BaseWindows},function(t){b=t.TipsManagerAction},function(t){_=t.TIPS_TYPE},function(t){h=t.XStorage},function(t){y=t.EventsManager},function(t){g=t.EventTyps,f=t.GAME_STATE},function(t){T=t.AudioManager},function(t){v=t.Logger},function(t){R=t.Global},function(t){L=t.CrazyAdManger}],execute:function(){var A,m,w,E,I,H,N,z,O,S,C,D,M,F,U,P,X,G,k,Y,x,B,W;a._RF.push({},"0cc20PVfx5KSp1UadplMB4x","LotteryAction",void 0);var V=r.ccclass,K=r.property,j=function(t){return t[t.FIRST=1]="FIRST",t[t.SECOND=2]="SECOND",t[t.THIRD=3]="THIRD",t[t.FOURTH=4]="FOURTH",t[t.FIFTH=5]="FIFTH",t[t.SIXTH=6]="SIXTH",t[t.SEVENTH=7]="SEVENTH",t[t.EIGHTH=8]="EIGHTH",t}(j||{}),q=[{type:j.FIRST,name:"一等奖",centerAngle:22.5,data:40},{type:j.SECOND,name:"二等奖",centerAngle:67.5,data:80},{type:j.THIRD,name:"三等奖",centerAngle:112.5,data:90},{type:j.FOURTH,name:"四等奖",centerAngle:157.5,data:100},{type:j.FIFTH,name:"五等奖",centerAngle:202.5,data:120},{type:j.SIXTH,name:"六等奖",centerAngle:247.5,data:70},{type:j.SEVENTH,name:"七等奖",centerAngle:292.5,data:110},{type:j.EIGHTH,name:"八等奖",centerAngle:337.5,data:200}];t("LotteryAction",(A=V("LotteryAction"),m=K({type:l,tooltip:"实际进行旋转的转盘节点 (例如：Turntable Sprite)"}),w=K({type:l,tooltip:"点击抽奖的按钮节点"}),E=K({type:l,tooltip:"点击抽奖的按钮节点"}),I=K({type:s,tooltip:"显示最终中奖结果的 Label 组件 (这里改为显示次数/提示)"}),H=K({type:s,tooltip:"显示剩余免费或广告次数的 Label 组件"}),N=K({type:l,tooltip:"显示视频播放 "}),z=K({type:[l],tooltip:"转盘上 8 个奖项的文字节点 (按1-8等奖顺序)"}),O=K({slide:!0,range:[100,300,10],step:10,tooltip:"奖项文字距离转盘中心的径向距离"}),S=K({slide:!0,range:[3,5,1],step:1,tooltip:"转盘至少旋转的圈数"}),C=K({slide:!0,range:[2.5,5,.1],step:.1,tooltip:"转盘旋转总时长 (秒)"}),A((F=e((M=function(t){function e(){for(var e,n=arguments.length,a=new Array(n),r=0;r<n;r++)a[r]=arguments[r];return e=t.call.apply(t,[this].concat(a))||this,i(e,"turntableNode",F,o(e)),i(e,"btn_lottery",U,o(e)),i(e,"btn_close",P,o(e)),i(e,"resultLabel",X,o(e)),i(e,"countLabel",G,o(e)),i(e,"video_node",k,o(e)),i(e,"prizeTextNodes",Y,o(e)),i(e,"radialDistance",x,o(e)),i(e,"minRotationRounds",B,o(e)),i(e,"rotationDuration",W,o(e)),e.isRotating=!1,e.call_back=void 0,e}n(e,t);var a=e.prototype;return a.start=function(){this.updateLotteryUI(),this.initializePrizeLabels()},a.on_start_lottery=function(){if(!this.isRotating){var t=h.get_today_lottery_count();R.MAX_LOTTERY_COUNT-t<=0?b.show("Come Back Tomorrow",_.OK):0===t?(v.log("Lottery: 第一次抽奖，免费开始！"),this._startRotation()):(v.log("Lottery: 第 "+(t+1)+" 次抽奖，观看广告获取！"),this._showAdForLottery())}},a._showAdForLottery=function(){var t=this;this.btn_lottery.getComponent(c).enabled=!1,L.show_video((function(e){t.btn_lottery.getComponent(c).enabled=!0,1==e?(v.log("Lottery: 广告观看成功，开始抽奖。"),t._startRotation()):(b.show("Watch Ad to Spin",_.WARN),v.warn("Lottery: 广告观看失败或跳过，无法抽奖。"))}))},a._startRotation=function(){this.isRotating=!0;var t=this.simulatePrizeResult(),e=this.turntableNode.angle,n=this.calculateTargetAngle(t,e);this.btn_close&&(this.btn_close.active=!1),this.runRotation(n,t)},a.onRotationFinished=function(t){this.isRotating=!1;var e=this.turntableNode.angle;this.turntableNode.angle=e%360;var n=q[t-1].data;h.increase_today_lottery_count(R.MAX_LOTTERY_COUNT),h.record_coins(h.get_cur_coins()+n),y.Ins.emit(g.UPDATE_COIN),b.show("Gold Gained "+n,_.OK),y.Ins.emit(g.RERUSH_SHOW_GG),this.updateLotteryUI(),this.btn_close&&(this.btn_close.active=!0)},a.updateLotteryUI=function(){var t=h.get_today_lottery_count(),e=R.MAX_LOTTERY_COUNT-t;this.btn_lottery.active=!0,this.resultLabel.node.active=!1,e<=0?(this.btn_lottery.active=!1,this.video_node.active=!1,this.resultLabel.node.active=!0,this.resultLabel.string="Daily limit reached",this.countLabel.string="Daily Count: 0/"+R.MAX_LOTTERY_COUNT):0===t?(this.video_node.active=!1,this.countLabel.string="Daily Count: 1/"+R.MAX_LOTTERY_COUNT):(this.video_node.active=!0,this.countLabel.string="Daily Count: "+e+"/"+R.MAX_LOTTERY_COUNT),v.log("Lottery UI Updated. Current Count: "+t+", Remaining: "+e)},a.initializePrizeLabels=function(){for(var t=0;t<q.length;t++){var e=this.prizeTextNodes[t],n=q[t],i=e.getComponent(s);i&&(i.string=n.data+"");var o=u.toRadian(n.centerAngle),a=this.radialDistance*Math.cos(o),r=this.radialDistance*Math.sin(o);e.setPosition(a,r);var l=n.centerAngle-90;l<0&&(l+=360),e.angle=l}},a.calculateTargetAngle=function(t,e){var n=90-q[t-1].centerAngle;n<0&&(n+=360);var i=n-e%360;return i<=0&&(i+=360),360*this.minRotationRounds+i},a.simulatePrizeResult=function(){return Math.floor(8*Math.random())+1},a.runRotation=function(t,e){var n=this;T.instance.play_shot("lottery_start"),p(this.turntableNode).by(this.rotationDuration,{angle:t},{easing:"quadInOut"}).call((function(){n.onRotationFinished(e)})).start()},a.show_windows=function(e,n){void 0===n&&(n=null),t.prototype.show_windows.call(this),this.call_back=n,this.updateLotteryUI(),this.btn_close&&(this.btn_close.active=!0)},a.close_windows=function(e){t.prototype.close_windows.call(this,e)},a.on_click_btn_continue=function(){T.instance.play_shot("menuclose"),this.close_windows(f.START);var t=this;t.call_back&&(t.call_back(),t.call_back=null),this.btn_close&&(this.btn_close.active=!1)},e}(d)).prototype,"turntableNode",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),U=e(M.prototype,"btn_lottery",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),P=e(M.prototype,"btn_close",[E],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),X=e(M.prototype,"resultLabel",[I],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),G=e(M.prototype,"countLabel",[H],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),k=e(M.prototype,"video_node",[N],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Y=e(M.prototype,"prizeTextNodes",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),x=e(M.prototype,"radialDistance",[O],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 200}}),B=e(M.prototype,"minRotationRounds",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 4}}),W=e(M.prototype,"rotationDuration",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 3.5}}),D=M))||D));a._RF.pop()}}}));

System.register("chunks:///_virtual/main",["./CrazySDK.ts","./CrazySDK.types.ts","./CrazySDKDemo.ts","./CrazySDKDemoLoadScript.ts","./AudioManager.ts","./BaseReviewAction.ts","./BaseWindows.ts","./Bullet100Action.ts","./Bullet200Action.ts","./Bullet300Action.ts","./BuyItemAction.ts","./BuyShowAction.ts","./CastleAction.ts","./Cell100Action.ts","./Cell200Action.ts","./Cell300Action.ts","./Cell400Action.ts","./Cell500Action.ts","./Cell600Action.ts","./CellAction.ts","./CellForLogic.ts","./CellManager.ts","./CombinationData.ts","./CountTimerAction.ts","./DataIninterface.ts","./DropAction.ts","./EnemyAction.ts","./Enums.ts","./EventsManager.ts","./FailVideoAction.ts","./GameBgLayer.ts","./GameEnemyLayerAction.ts","./GameLogicAction.ts","./Global.ts","./ItemAction.ts","./ItemsAction.ts","./LimitedCollect.ts","./LoadingAction.ts","./Logger.ts","./LoseAction.ts","./LoseContent_1_Action.ts","./LoseContent_2_Action.ts","./LotteryAction.ts","./MainAction.ts","./MainUiLayerAction.ts","./NumberAction.ts","./NumberTexture.ts","./ReadyAction.ts","./ResourceManger.ts","./ResourcePool.ts","./ReviewTipsLayerAction.ts","./SettingAction.ts","./SiderAction.ts","./SilderManager.ts","./TipsAction.ts","./TipsManagerAction.ts","./Tools.ts","./ToolsEnemy.ts","./UILayerAction.ts","./WindowData.ts","./XStorage.ts","./AdManger.ts","./BytePlantform.ts","./CrazyAdManger.ts","./WxPlatform.ts"],(function(){return{setters:[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],execute:function(){}}}));

System.register("chunks:///_virtual/MainAction.ts",["./rollupPluginModLoBabelHelpers.js","cc","./ResourcePool.ts","./Global.ts","./Enums.ts","./Logger.ts","./EventsManager.ts","./XStorage.ts","./AudioManager.ts","./CrazySDK.ts"],(function(t){var n,o,e,a,i,r,c,s,l,u,f,g,p,_,d,m,y,b;return{setters:[function(t){n=t.applyDecoratedDescriptor,o=t.inheritsLoose,e=t.initializerDefineProperty,a=t.assertThisInitialized},function(t){i=t.cclegacy,r=t._decorator,c=t.Prefab,s=t.game,l=t.Component},function(t){u=t.ResourcePool},function(t){f=t.Global},function(t){g=t.GAME_STATE,p=t.EventTyps},function(t){_=t.Logger},function(t){d=t.EventsManager},function(t){m=t.XStorage},function(t){y=t.AudioManager},function(t){b=t.default}],execute:function(){var h,v,A,M,R;i._RF.push({},"ccac8TcsuhARqpsTdW1ldoy","MainAction",void 0);var S=r.ccclass,E=r.property;t("MainAction",(h=S("MainAction"),v=E(c),h((R=n((M=function(t){function n(){for(var n,o=arguments.length,i=new Array(o),r=0;r<o;r++)i[r]=arguments[r];return n=t.call.apply(t,[this].concat(i))||this,e(n,"loading_prefab",R,a(n)),n}o(n,t);var i=n.prototype;return i.onLoad=function(){b.isSupportedPlatform?b.init().then((function(){console.log("main  onload  init CrazySDK... success")})).catch((function(t){t("Initialization failed "+t)})):console.log("main  onload  init CrazySDK... fail,not support this platform")},i.start=function(){f.set_game_state(g.READY,"Main"),_.log("当前设备的帧率为: ",s.frameRate),s.frameRate=30,_.log("已将游戏帧率设置为: ",s.frameRate);var t=this;u.instance.set_prefab("Loading",this.loading_prefab),f.ui_layer_action.show_win("Loading",null,(function(){f.init_once(m.get_volum_sound(),m.get_volum_music(),m.get_cell_500_tips()),y.instance.start_bg_music(),t.start_game(),f.game_bg_layer.init_bg_cell()}))},i.update=function(t){},i.start_game=function(){_.log("start game "),d.Ins.emit(p.START_GAME,!0)},n}(l)).prototype,"loading_prefab",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),A=M))||A));i._RF.pop()}}}));

System.register("chunks:///_virtual/MainUiLayerAction.ts",["./rollupPluginModLoBabelHelpers.js","cc","./EventsManager.ts","./Enums.ts","./Global.ts","./AudioManager.ts","./ResourcePool.ts","./Tools.ts","./XStorage.ts","./Logger.ts"],(function(e){var t,n,r,a,i,s,o,c,u,_,l,p,f,h,d,g,b,w,y,m,v,A,k,S,x;return{setters:[function(e){t=e.applyDecoratedDescriptor,n=e.inheritsLoose,r=e.initializerDefineProperty,a=e.assertThisInitialized,i=e.createForOfIteratorHelperLoose,s=e.asyncToGenerator,o=e.regeneratorRuntime},function(e){c=e.cclegacy,u=e._decorator,_=e.Node,l=e.Label,p=e.Layout,f=e.UIOpacity,h=e.Vec3,d=e.tween,g=e.Component},function(e){b=e.EventsManager},function(e){w=e.EventTyps,y=e.GAME_STATE},function(e){m=e.Global},function(e){v=e.AudioManager},function(e){A=e.ResourcePool},function(e){k=e.Tools},function(e){S=e.XStorage},function(e){x=e.Logger}],execute:function(){var P,T,I,L,E,R,U,C,M,N,z,O,G,D,H,W,Y,F,X,q,B,J,Q,V,j,K,Z,$;c._RF.push({},"0dda5eQge5OMZflJHSQ7CJK","MainUiLayerAction",void 0);var ee=u.ccclass,te=u.property;e("MainUiLayerAction",(P=ee("MainUiLayerAction"),T=te(_),I=te(l),L=te(p),E=te(_),R=te(l),U=te(_),C=te(l),M=te(_),N=te(_),z=te(l),O=te(_),G=te(_),P((($=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),s=0;s<n;s++)i[s]=arguments[s];return t=e.call.apply(e,[this].concat(i))||this,r(t,"swap_sprite",W,a(t)),r(t,"swap_label",Y,a(t)),r(t,"layout_heart",F,a(t)),r(t,"sun_sprite",X,a(t)),r(t,"sun_label",q,a(t)),r(t,"coin_sprite",B,a(t)),r(t,"coin_label",J,a(t)),r(t,"btn_undo_mask",Q,a(t)),r(t,"item_btn_node",V,a(t)),r(t,"item_count",j,a(t)),r(t,"lottery_node",K,a(t)),r(t,"gg_node",Z,a(t)),t}n(t,e);var c=t.prototype;return c.onLoad=function(){b.Ins.addListener(w.INIT_GAME,this.init_heart,this),b.Ins.addListener(w.UPDATE_SWAP,this.event_update_swap,this),b.Ins.addListener(w.UPDATE_HEART,this.update_heart,this),b.Ins.addListener(w.SYN_COIN,this.sync_coin,this),b.Ins.addListener(w.UPDATE_COIN,this.event_update_coin,this),b.Ins.addListener(w.SYNC_SUN,this.async_sun,this),b.Ins.addListener(w.UPDATE_SUN,this.event_update_sun,this),b.Ins.addListener(w.SWAP_DATA_CHANGE,this.swap_data_change,this),b.Ins.addListener(w.UPDATE_ITEM_COUNT,this.update_item_count,this),b.Ins.addListener(w.REFRESH_ITEM_BTN,this.event_refresh_item_btn,this),b.Ins.addListener(w.RERUSH_SHOW_GG,this.rerush_gg,this)},c.start=function(){this.update_item_count(),b.Ins.emit(w.RERUSH_SHOW_GG)},c.update=function(e){},c.init_heart=function(){var e=s(o().mark((function e(){var t,n,r,a,i,s,c=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(this.sync_update_swap(),t=this.layout_heart.node.children,n=t.length-1;n>=0;n--)r=t[n],A.instance.remove_node(r);a=S.get_cur_heart(),i=o().mark((function e(t){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,A.instance.create_by_Pool("heart",null,c.layout_heart.node,!1).then((function(e){var n=e.getComponent(f);k.setSpriteAlpha(n,0),k.TweenAlphaAni(n,0,.5).call((function(){})).delay(.3+.2*t).call((function(){k.setSpriteAlpha(n,1)})).start()}));case 2:e.sent;case 3:case"end":return e.stop()}}),e)})),s=0;case 6:if(!(s<a)){e.next=11;break}return e.delegateYield(i(s),"t0",8);case 8:s++,e.next=6;break;case 11:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),c.async_sun=function(){var e=s(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.sun_label.string=S.get_cur_sun()+"";case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),c.sync_coin=function(){var e=s(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.coin_label.string=S.get_cur_coins()+"";case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),c.update_heart=function(){var e=s(o().mark((function e(){var t,n,r,a,i,s,c,u,_,l=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=S.get_cur_heart(),n=this.layout_heart.node.children,!(t>n.length)){e.next=13;break}r=t-n.length,a=o().mark((function e(t){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,A.instance.create_by_Pool("heart",null,l.layout_heart.node,!1).then((function(e){var n=e.getComponent(f);k.setSpriteAlpha(n,0),k.TweenAlphaAni(n,0,.5).call((function(){})).delay(.3+.2*t).call((function(){k.setSpriteAlpha(n,1)})).start()}));case 2:e.sent;case 3:case"end":return e.stop()}}),e)})),i=0;case 6:if(!(i<r)){e.next=11;break}return e.delegateYield(a(i),"t0",8);case 8:i++,e.next=6;break;case 11:e.next=14;break;case 13:if(t<n.length)for(s=n.length-t,c=n.slice(0,s),u=c.length-1;u>=0;u--)_=c[u],A.instance.remove_node(_);case 14:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),c.sync_update_swap=function(){this.swap_label.string=S.get_cur_swap()+""},c.event_update_sun=function(e){var n=this;e||(e=m.ui_layer_action.node.worldPosition);if(""!=this.sun_label.string){var r=Number(this.sun_label.string),a=S.get_cur_coins()-r;a>0?(this._show_add_tween(a,e,t.Sun_Prefab,this.sun_sprite),this.scheduleOnce((function(){n.sun_label.string=S.get_cur_sun()+""}),2.2)):this.sun_label.string=S.get_cur_sun()+""}else this.sun_label.string=S.get_cur_sun()+""},c.event_update_coin=function(e){var n=this;e||(e=m.ui_layer_action.node.worldPosition);if(""!=this.coin_label.string){var r=Number(this.coin_label.string),a=S.get_cur_coins()-r;a>0?(this._show_add_tween(a,e,t.Coin_Prefab,this.coin_sprite),this.scheduleOnce((function(){n.coin_label.string=S.get_cur_coins()+""}),2.2)):this.coin_label.string=S.get_cur_coins()+""}else this.coin_label.string=S.get_cur_coins()+""},c.event_update_swap=function(e){var n=this;e||(e=m.ui_layer_action.node.worldPosition);if(""!=this.swap_label.string){var r=Number(this.swap_label.string),a=S.get_cur_swap()-r;a>0?(this._show_add_tween(a,e,t.Swap_Prefab,this.swap_sprite),this.scheduleOnce((function(){n.swap_label.string=S.get_cur_swap()+""}),2.2)):this.swap_label.string=S.get_cur_swap()+""}else this.swap_label.string=S.get_cur_swap()+""},c._show_add_tween=function(e,t,n,r){var a=this,i=m.ui_layer_action.node;v.instance.play_shot("coin"),A.instance.create_by_Pool(n,t.clone(),i,!0).then((function(i){var s=i.getComponent(f);k.setSpriteAlpha(s,1),k.TweenAlphaAni(s,1,.5).call((function(){var i=25;switch(e){case 2:a._create_prefab(new h(i,i,0),1,t,n,r);break;case 3:a._create_prefab(new h(i,i,0),1,t,n,r),a._create_prefab(new h(-25,-25,0),2,t,n,r);break;case 4:a._create_prefab(new h(i,i,0),1,t,n,r),a._create_prefab(new h(-25,-25,0),2,t,n,r),a._create_prefab(new h(-25,i,0),3,t,n,r);break;case 5:a._create_prefab(new h(i,i,0),1,t,n,r),a._create_prefab(new h(-25,-25,0),2,t,n,r),a._create_prefab(new h(-25,i,0),3,t,n,r),a._create_prefab(new h(i,-25,0),4,t,n,r)}})).delay(.3).call((function(){a._fly(i,0,r)})).start()}))},c._create_prefab=function(e,t,n,r,a){var i=this,s=m.ui_layer_action.node;A.instance.create_by_Pool(r,n,s,!0).then((function(n){k.setSpriteAlpha(n.getComponent(f),1);var r=new h(e.x+n.x,e.y+n.y);d(n).to(.3,{position:r}).call((function(){i._fly(n,t,a)})).start()}))},c._fly=function(e,t,n){var r=n.worldPosition.clone();r.y-=80,r.x+=50;var a=e.getComponent(f);d(e).delay(.2*t).to(.5,{worldPosition:r},{easing:"quadIn"}).to(.2,{worldPosition:n.worldPosition},{easing:"quadIn"}).call((function(){d(a).to(.3,{opacity:0}).start(),v.instance.play_shot("towershoot"),A.instance.remove_node(e)})).union().start()},c.swap_data_change=function(){var e=m.game_logic_action.get_cell_logic();if(e){var t=e.get_swap_data();this.btn_undo_mask.active=!t}else this.btn_undo_mask.active=!0},c.update_item_count=function(){var e=this;this.scheduleOnce((function(){for(var t,n=S.get_item_list(),r=0,a=i(n);!(t=a()).done;){r+=t.value.itemNum}e.item_count&&(e.item_count.string=r+"")}),1)},c.on_test_add_enemy=function(){var e=s(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,m.game_enemy_layer_action.random_enemy();case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),c.on_test_restart=function(){var e=s(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:b.Ins.emit(w.START_GAME);case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),c.on_click_open_setting=function(){var e=s(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:v.instance.play_shot("menuclose"),m.ui_layer_action.show_win("Setting");case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),c.on_click_undo=function(){var e=s(o().mark((function e(){var t;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(v.instance.play_shot("menuclose"),!m.game_logic_action.isProcessing){e.next=3;break}return e.abrupt("return");case 3:if(m.get_game_state()==y.START){e.next=5;break}return e.abrupt("return");case 5:if(!m.game_enemy_layer_action.is_fight_status()){e.next=8;break}return x.log("战斗状态跳过"),e.abrupt("return");case 8:(t=m.game_logic_action.get_cell_logic())&&t.get_swap_data()&&(v.instance.play_shot("menuclose"),t.undo_swap());case 10:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),c.on_click_item=function(){var e=s(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!m.game_logic_action.isProcessing){e.next=2;break}return e.abrupt("return");case 2:if(m.get_game_state()==y.START){e.next=4;break}return e.abrupt("return");case 4:if(!m.game_enemy_layer_action.is_fight_status()){e.next=7;break}return x.log("战斗状态跳过"),e.abrupt("return");case 7:v.instance.play_shot("menuclose"),m.ui_layer_action.show_win("Items");case 9:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),c.event_refresh_item_btn=function(){var e=s(o().mark((function e(){var t;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=S.get_item_btn(),this.item_btn_node.active=!(t>0);case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),c.rerush_gg=function(){if(this.gg_node){var e=S.get_today_lottery_count();m.MAX_LOTTERY_COUNT-e>0?(this.gg_node.active=!0,this.lottery_node.active=!0):(this.gg_node.active=!1,this.lottery_node.active=!1)}},c.on_click_lottery=function(){v.instance.play_shot("menuclose"),m.ui_layer_action.show_win("Lottery")},c.on_print_info=function(){var e=s(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:m.game_logic_action.print_info();case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),c.on_test_lose=function(){var e=s(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:m.set_game_state(y.PAUSE),m.ui_layer_action.show_win("Lose");case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),c.on_test_cell501_tips=function(){var e=s(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:b.Ins.emit(w.REVIEW_USERCELL_500_TIPS_DRAG);case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),t}(g)).Swap_Prefab="Swap",$.Coin_Prefab="Coin",$.Sun_Prefab="Sun",W=t((H=$).prototype,"swap_sprite",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Y=t(H.prototype,"swap_label",[I],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),F=t(H.prototype,"layout_heart",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),X=t(H.prototype,"sun_sprite",[E],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),q=t(H.prototype,"sun_label",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),B=t(H.prototype,"coin_sprite",[U],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),J=t(H.prototype,"coin_label",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Q=t(H.prototype,"btn_undo_mask",[M],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),V=t(H.prototype,"item_btn_node",[N],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),j=t(H.prototype,"item_count",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),K=t(H.prototype,"lottery_node",[O],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Z=t(H.prototype,"gg_node",[G],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),D=H))||D));c._RF.pop()}}}));

System.register("chunks:///_virtual/NumberAction.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var r,e,i,n,o,u,l,s;return{setters:[function(t){r=t.applyDecoratedDescriptor,e=t.inheritsLoose,i=t.initializerDefineProperty,n=t.assertThisInitialized},function(t){o=t.cclegacy,u=t._decorator,l=t.tween,s=t.Label}],execute:function(){var a,c,b,h;o._RF.push({},"ed01fIhkRdIQJb2dbbRK1/I","NumberAction",void 0);var g=u.ccclass,m=u.property;t("NumberAction",g("NumberAction")((b=r((c=function(t){function r(){for(var r,e=arguments.length,o=new Array(e),u=0;u<e;u++)o[u]=arguments[u];return r=t.call.apply(t,[this].concat(o))||this,i(r,"targetNumber",b,n(r)),i(r,"rollSpeed",h,n(r)),r._currentNumber=0,r._isRolling=!1,r}e(r,t);var o=r.prototype;return o.startRoll=function(){this._isRolling||(this._isRolling=!0,this._rollToTargetNumber())},o._rollToTargetNumber=function(){for(var t=this.targetNumber>this._currentNumber?1:-1,r=Math.ceil(Math.abs(this.targetNumber-this._currentNumber)/this.rollSpeed),e=0;e<r;e++)if(this._currentNumber+=t,this.string=this._currentNumber.toString(),this._currentNumber>=this.targetNumber){this._currentNumber=this.targetNumber,this.string=this.targetNumber.toString(),this._isRolling=!1;break}this._isRolling&&l(this).delay(.05).call(this._rollToTargetNumber.bind(this)).start()},r}(s)).prototype,"targetNumber",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),h=r(c.prototype,"rollSpeed",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 10}}),a=c))||a);o._RF.pop()}}}));

System.register("chunks:///_virtual/NumberTexture.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var t,r,i,n,c,o,u,a;return{setters:[function(e){t=e.applyDecoratedDescriptor,r=e.inheritsLoose,i=e.initializerDefineProperty,n=e.assertThisInitialized},function(e){c=e.cclegacy,o=e._decorator,u=e.RichText,a=e.Component}],execute:function(){var s,l,p,h,f;c._RF.push({},"c4663gCuCFGeJcVRKN4hj92","NumberTexture",void 0);var g=o.ccclass,m=o.property;e("NumberTexture",(s=g("NumberTexture"),l=m(u),s((f=t((h=function(e){function t(){for(var t,r=arguments.length,c=new Array(r),o=0;o<r;o++)c[o]=arguments[o];return t=e.call.apply(e,[this].concat(c))||this,i(t,"richText",f,n(t)),t}r(t,e);var c=t.prototype;return c.start=function(){},c.update=function(e){},c.setNum=function(e){for(var t=(e+"").split(""),r="",i=0;i<t.length;i++)r+='<img src="'+t[i]+'"/>';this.richText.string=r},t}(a)).prototype,"richText",[l],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),p=h))||p));c._RF.pop()}}}));

System.register("chunks:///_virtual/ReadyAction.ts",["./rollupPluginModLoBabelHelpers.js","cc","./BaseWindows.ts","./Enums.ts","./AudioManager.ts"],(function(t){var e,n,i,r,s,a,o,c,l,u,p,h;return{setters:[function(t){e=t.applyDecoratedDescriptor,n=t.inheritsLoose,i=t.initializerDefineProperty,r=t.assertThisInitialized,s=t.asyncToGenerator,a=t.regeneratorRuntime},function(t){o=t.cclegacy,c=t._decorator,l=t.Label},function(t){u=t.BaseWindows},function(t){p=t.GAME_STATE},function(t){h=t.AudioManager}],execute:function(){var f,d,_,w,y;o._RF.push({},"3b4e4aiiEhIzojF7HPlPgjt","ReadyAction",void 0);var g=c.ccclass,b=c.property;t("ReadyAction",(f=g("ReadyAction"),d=b(l),f((y=e((w=function(t){function e(){for(var e,n=arguments.length,s=new Array(n),a=0;a<n;a++)s[a]=arguments[a];return e=t.call.apply(t,[this].concat(s))||this,i(e,"dialog_label",y,r(e)),e.TYPE_SPEED=.12,e.FULL_DIALOG_TEXT="Beware! A Grand Boss will appear after 10 battles",e.call_back=null,e.isTyping=!1,e}n(e,t);var o=e.prototype;return o.show_windows=function(){var e=s(a().mark((function e(n,i){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0===i&&(i=null),t.prototype.show_windows.call(this),this.call_back=i,this.dialog_label.string="",e.next=6,this.startTypewriter(this.FULL_DIALOG_TEXT);case 6:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}(),o.startTypewriter=function(){var t=s(a().mark((function t(e){var n;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.isTyping){t.next=2;break}return t.abrupt("return");case 2:this.isTyping=!0,n=0;case 4:if(!(n<e.length)){t.next=13;break}return this.dialog_label.string=e.substring(0,n+1),t.next=8,h.instance.play_shot("speech");case 8:return t.next=10,this.waitTime(this.TYPE_SPEED);case 10:n++,t.next=4;break;case 13:this.isTyping=!1;case 14:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}(),o.close_windows=function(e){t.prototype.close_windows.call(this,e)},o.waitTime=function(t){var e=this;return new Promise((function(n,i){e.scheduleOnce((function(){n(!0)}),t)}))},o.on_click_ready=function(){var t=s(a().mark((function t(){return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.isTyping&&(this.unscheduleAllCallbacks(),this.dialog_label.string=this.FULL_DIALOG_TEXT,this.isTyping=!1),this.close_windows(p.READY),!this.call_back){t.next=5;break}return t.next=5,this.call_back();case 5:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),e}(u)).prototype,"dialog_label",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_=w))||_));o._RF.pop()}}}));

System.register("chunks:///_virtual/ResourceManger.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Enums.ts","./Global.ts","./ResourcePool.ts","./AudioManager.ts","./Logger.ts"],(function(r){var t,e,n,a,o,i,s,u,c,_,l,p;return{setters:[function(r){t=r.createClass,e=r.asyncToGenerator,n=r.regeneratorRuntime},function(r){a=r.cclegacy,o=r.assetManager,i=r.JsonAsset,s=r.SpriteFrame},function(r){u=r.AssetType},function(r){c=r.Global},function(r){_=r.ResourcePool},function(r){l=r.AudioManager},function(r){p=r.Logger}],execute:function(){a._RF.push({},"a3bb4Of+I5N76ONiX1ivDrt","ResourceManger",void 0),r("default",function(){function r(){this.bundle_map={},this.clip_map={},this._atlasMap={},this._json_config={},this._uiMap={},this._last_progress_ratio=0,this._frame_count=0,this.UPDATE_INTERVAL_FRAMES=2}var a=r.prototype;return a.load_bundle=function(){var r=e(n().mark((function r(t,e){var a=this;return n().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return void 0===e&&(e=0),r.abrupt("return",new Promise((function(r,n){o.loadBundle(t,(function(n,o){n?(p.error(t+" --------------------------load errors>>>",n),c.loading_rate+=e,r()):(a.bundle_map[t]=o,c.loading_rate+=e,r())}))})));case 2:case"end":return r.stop()}}),r)})));return function(t,e){return r.apply(this,arguments)}}(),a.load_resource=function(){var r=e(n().mark((function r(t,e,a){var o=this;return n().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(void 0===a&&(a=0),this.bundle_map[t]){r.next=5;break}return p.error("Bundle "+t+" 未加载，无法加载资源 "+e.path),c.loading_rate+=a,r.abrupt("return",Promise.resolve());case 5:return this._last_progress_ratio=0,r.abrupt("return",new Promise((function(r,n){o.bundle_map[t].loadDir(e.path,e.type,(function(r,t){if(o._frame_count++,o._frame_count%o.UPDATE_INTERVAL_FRAMES==0){var e=r/t,n=(e-o._last_progress_ratio)*a;c.loading_rate=Math.min(c.loading_rate+n,1),o._last_progress_ratio=e}}),(function(n,s){try{n?p.error("load_resource error >>>",t+">>"+e.path," err>",n,"assets>",s):null==s||s.forEach((function(r){switch(e){case u.Prefab:_.instance.set_prefab(r.data.name,r);break;case u.Sound:o.clip_map[r.name]=r,l.instance.add_clip(r.name,r);break;case u.Ui:o._uiMap[r.name]=r;break;case u.Atlas:o._atlasMap[r.name]||(o._atlasMap[r.name]=r);break;case u.Json:!o._json_config[r.name]&&r instanceof i&&(o._json_config[r.name]=r.json)}}));var f=(1-o._last_progress_ratio)*a;c.loading_rate+=f,r()}catch(n){p.log("catch:",t+">>"+e.path+"loaded error:",n),c.loading_rate+=(1-o._last_progress_ratio)*a,r()}}))})));case 7:case"end":return r.stop()}}),r,this)})));return function(t,e,n){return r.apply(this,arguments)}}(),a.get_clip=function(r){return this.clip_map[r]},a.get_ui=function(r){return this._uiMap[r]},a.get_data_type=function(r){if(void 0===r&&(r="config"),this._json_config[r]&&this._json_config[r].types){var t=this._json_config[r].types;p.log("JSON Config: "+r+", types array length: "+t.length)}else p.error("JSON资源 "+r+" 或其 'types' 属性不存在!")},a.get_data_type_length=function(r){var t;void 0===r&&(r="config");var e=null==(t=this._json_config[r])?void 0:t.types;return e?e.length:0},a.get_data_type_cells=function(r,t){var e;void 0===t&&(t="config");var n=null==(e=this._json_config[t])?void 0:e.types;if(n&&r>=0&&r<n.length)return n[r].cells;p.warn("配置 "+t+" 中索引 "+r+" 的 cells 不存在!")},a.get_data_type_score=function(r,t){var e;void 0===t&&(t="config");var n=null==(e=this._json_config[t])?void 0:e.types;if(n&&r>=0&&r<n.length)return n[r].score;p.warn("配置 "+t+" 中索引 "+r+" 的 score 不存在!")},a.get_println_config=function(){p.log("get_println_config - 缓存的 JSON 配置:",this._json_config)},a.get_spriteframe=function(r){var t=this._atlasMap.comboNumber;return t?t.getSpriteFrame(r):(p.warn("图集 'comboNumber' 不存在，无法获取 SpriteFrame "+r),null)},a.setSpriteFromAtlas=function(){var r=e(n().mark((function r(t,e){var a=this;return n().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",new Promise((function(r,n){var o=a.get_spriteframe(t);o?(e.spriteFrame=o,r(e)):n(new Error("无法从图集中获取 SpriteFrame: "+t))})));case 1:case"end":return r.stop()}}),r)})));return function(t,e){return r.apply(this,arguments)}}(),a.setSpriteFromUI=function(){var r=e(n().mark((function r(t,e){var a=this;return n().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",new Promise((function(r,n){var o=a.get_ui(t);o instanceof s?(e.spriteFrame=o,r(e)):n(new Error("无法从 UI 缓存中获取 SpriteFrame: "+t))})));case 1:case"end":return r.stop()}}),r)})));return function(t,e){return r.apply(this,arguments)}}(),t(r,null,[{key:"instance",get:function(){return this.rm||(this.rm=new r),this.rm}}]),r}()).rm=null,a._RF.pop()}}}));

System.register("chunks:///_virtual/ResourcePool.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Tools.ts","./Logger.ts"],(function(e){var t,r,o,n,i,a,s,c,u,p;return{setters:[function(e){t=e.createClass,r=e.asyncToGenerator,o=e.regeneratorRuntime},function(e){n=e.cclegacy,i=e._decorator,a=e.instantiate,s=e.v3,c=e.Quat},function(e){u=e.Tools},function(e){p=e.Logger}],execute:function(){var l,f;n._RF.push({},"c6752LdbbhKF590O6duE2qa","ResourcePool",void 0);var v=i.ccclass;i.property,e("ResourcePool",v("ResourcePool")(((f=function(){function e(){this.prefab_pool=new Map,this._poolRemoveNode=new Map,this._poolActive=new Map}var n=e.prototype;return n.set_prefab=function(e,t){this.prefab_pool.set(e,t)},n.get_prefab=function(e){return this.prefab_pool.get(e)},n.create_by_Pool=function(){var e=r(o().mark((function e(t,r,n,i){var a,s,c;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===i&&(i=!0),a=this._poolRemoveNode.get(t),(c=this._poolActive.get(t))||(c=[],this._poolActive.set(t,c)),!(a&&a.length>0)){e.next=13;break}return s=a.shift(),c.indexOf(s)<0&&u.insertArr(c,s),s.active=!0,s.setParent(n,i),r&&s.setWorldPosition(r),e.abrupt("return",s);case 13:return e.prev=13,e.next=16,this.create_new_node(t,r,n,i);case 16:return s=e.sent,c.indexOf(s)<0&&u.insertArr(c,s),e.abrupt("return",s);case 21:throw e.prev=21,e.t0=e.catch(13),p.error("create_new_node err>>>>",e.t0),e.t0;case 25:case"end":return e.stop()}}),e,this,[[13,21]])})));return function(t,r,o,n){return e.apply(this,arguments)}}(),n.create_new_node=function(e,t,r,o){var n=this;return void 0===o&&(o=!0),new Promise((function(i,s){var c=n.prefab_pool.get(e);if(!c)return s("Failed to load prefab data: "+e+".");var u=a(c);if(!u)return s("Failed to instantiate prefab.");t&&u.setWorldPosition(t),u.setParent(r,o),u.name=e,i(u)}))},n.remove_node=function(e){var t=e.name;e.setPosition(s(0,0,0)),e.setScale(s(1,1,1)),e.setRotation(c.IDENTITY.clone()),e.active=!1,e.removeFromParent();var r=this._poolActive.get(t);if(r){var o=r.indexOf(e);o>-1&&r.splice(o,1)}var n=this._poolRemoveNode.get(t);n||(n=[],this._poolRemoveNode.set(t,n)),n.indexOf(e)<0&&u.insertArr(n,e)},t(e,null,[{key:"instance",get:function(){return this._instance||(this._instance=new e),this._instance}}]),e}())._instance=void 0,l=f))||l);n._RF.pop()}}}));

System.register("chunks:///_virtual/ReviewTipsLayerAction.ts",["./rollupPluginModLoBabelHelpers.js","cc","./ResourcePool.ts","./Enums.ts","./EventsManager.ts","./BaseReviewAction.ts","./Global.ts","./XStorage.ts"],(function(e){var t,n,s,r,i,o,c,a,u,l,_,p,f;return{setters:[function(e){t=e.inheritsLoose,n=e.asyncToGenerator,s=e.regeneratorRuntime},function(e){r=e.cclegacy,i=e._decorator,o=e.Component,c=e.Vec3},function(e){a=e.ResourcePool},function(e){u=e.EventTyps},function(e){l=e.EventsManager},function(e){_=e.BaseReviewAction},function(e){p=e.Global},function(e){f=e.XStorage}],execute:function(){var h;r._RF.push({},"826bfbx+fhDEYbSk6VeKfK5","ReviewTipsLayerAction",void 0);var v=i.ccclass;i.property,e("ReviewTipsLayerAction",v("ReviewTipsLayerAction")(h=function(e){function r(){return e.apply(this,arguments)||this}t(r,e);var i=r.prototype;return i.onLoad=function(){l.Ins.addListener(u.REVIEW_TIPS_DRAG,this.show_event_drag_tips,this),l.Ins.addListener(u.REVIEW_USERCELL_500_TIPS_DRAG,this.show_event_cell500_tips,this),l.Ins.addListener(u.CREATE_NEW_CELL,this.create_new_cell,this)},i.start=function(){},i.update=function(e){},i.clear_tips_layer=function(){for(var e=this.node.children.slice(),t=0;t<e.length;t++)a.instance.remove_node(e[t])},i.show_event_drag_tips=function(){var e=n(s().mark((function e(){var t,n;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.clear_tips_layer(),e.next=3,a.instance.create_by_Pool("DragTips",null,this.node,!1);case 3:(n=e.sent).setPosition(c.ZERO),null==(t=n.getComponent(_))||t.show_tips(!1);case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),i.show_event_cell500_tips=function(){var e=n(s().mark((function e(){var t,n;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.clear_tips_layer(),e.next=3,a.instance.create_by_Pool("UseCell501Tips",null,this.node,!1);case 3:(n=e.sent).setPosition(c.ZERO),null==(t=n.getComponent(_))||t.show_tips(!1);case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),i.create_new_cell=function(){var e=n(s().mark((function e(t){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return");case 2:if(!(500==t.base_type&&t.step>0)||p.cell_500_tips){e.next=7;break}return f.set_cell_500_tips(),p.cell_500_tips=f.get_cell_500_tips(),e.next=7,this.show_event_cell500_tips();case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),r}(o))||h);r._RF.pop()}}}));

System.register("chunks:///_virtual/SettingAction.ts",["./rollupPluginModLoBabelHelpers.js","cc","./BaseWindows.ts","./Enums.ts","./Logger.ts","./Global.ts","./XStorage.ts","./EventsManager.ts","./AudioManager.ts","./TipsManagerAction.ts","./TipsAction.ts","./CrazyAdManger.ts"],(function(i){var o,n,t,e,s,a,r,l,c,u,_,d,f,g,v,p,m,h,w;return{setters:[function(i){o=i.applyDecoratedDescriptor,n=i.inheritsLoose,t=i.initializerDefineProperty,e=i.assertThisInitialized},function(i){s=i.cclegacy,a=i._decorator,r=i.Slider,l=i.Node},function(i){c=i.BaseWindows},function(i){u=i.GAME_STATE,_=i.EventTyps},function(i){d=i.Logger},function(i){f=i.Global},function(i){g=i.XStorage},function(i){v=i.EventsManager},function(i){p=i.AudioManager},function(i){m=i.TipsManagerAction},function(i){h=i.TIPS_TYPE},function(i){w=i.CrazyAdManger}],execute:function(){var A,y,S,T,b,M,E,z,L;s._RF.push({},"dcf79k67QJLApAMi81P2T0I","SettingAction",void 0);var P=a.ccclass,R=a.property;i("SettingAction",(A=P("SettingAction"),y=R(r),S=R(r),T=R(l),A((E=o((M=function(i){function o(){for(var o,n=arguments.length,s=new Array(n),a=0;a<n;a++)s[a]=arguments[a];return o=i.call.apply(i,[this].concat(s))||this,t(o,"sound_slider",E,e(o)),t(o,"music_slider",z,e(o)),t(o,"ad_video_flag",L,e(o)),o}n(o,i);var s=o.prototype;return s.start=function(){},s.on_sound_Slider=function(i){var o=i.progress;f.volum_sound=o},s.on_music_Slider=function(i){var o=i.progress;f.volum_music=o,p.instance&&p.instance.set_music_volume(o)},s.update=function(i){},s.show_windows=function(o,n,t){void 0===o&&(o=null),void 0===n&&(n=null),void 0===t&&(t=u.PAUSE),i.prototype.show_windows.call(this,o,n,t),this.sound_slider.progress=f.volum_sound,this.music_slider.progress=f.volum_music,g.is_fail_count_reached()?this.ad_video_flag&&(this.ad_video_flag.active=!0):this.ad_video_flag&&(this.ad_video_flag.active=!1)},s.close_windows=function(o,n){i.prototype.close_windows.call(this,o,n)},s.save_volum=function(){g.record_volum_sound(f.volum_sound),g.record_volum_music(f.volum_music)},s.on_click_close=function(){p.instance.play_shot("menuclose"),this.save_volum(),this.close_windows(u.START)},s.on_click_restart=function(){p.instance.play_shot("menuclose"),this.save_volum();var i=this;g.is_fail_count_reached()?(d.log("每日游戏失败次数已达上限 "+f.MAX_FAIL_COUNT+"，尝试播放广告。"),w.show_video((function(o){1==o?(d.log("on_click_continue_by_video 获取奖励成功"),m.show("Limit Reset. Continue Game.",h.OK),g.reset_fail_count(),i._start_game_flow()):(m.show("Watch Video to Continue",h.WARN),d.log("看视频失败，继续播放"))}))):(d.log("未达每日次数限制，直接开始游戏。"),this._start_game_flow())},s._start_game_flow=function(){this.close_windows(null),v.Ins.emit(_.START_GAME)},o}(c)).prototype,"sound_slider",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),z=o(M.prototype,"music_slider",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),L=o(M.prototype,"ad_video_flag",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),b=M))||b));s._RF.pop()}}}));

System.register("chunks:///_virtual/SiderAction.ts",["./rollupPluginModLoBabelHelpers.js","cc","./BytePlantform.ts","./Global.ts","./XStorage.ts","./TipsManagerAction.ts","./TipsAction.ts","./EventsManager.ts","./Enums.ts","./BaseWindows.ts","./Logger.ts"],(function(t){var n,i,e,o,s,r,a,c,l,_,d,g,f,u,h,p,b,w;return{setters:[function(t){n=t.applyDecoratedDescriptor,i=t.inheritsLoose,e=t.initializerDefineProperty,o=t.assertThisInitialized},function(t){s=t.cclegacy,r=t._decorator,a=t.Label,c=t.Widget},function(t){l=t.BytePlantform},function(t){_=t.Global},function(t){d=t.XStorage},function(t){g=t.TipsManagerAction},function(t){f=t.TIPS_TYPE},function(t){u=t.EventsManager},function(t){h=t.EventTyps,p=t.GAME_STATE},function(t){b=t.BaseWindows},function(t){w=t.Logger}],execute:function(){var y,A,T,m,v,S,E;s._RF.push({},"034abrkePVEKolqwNPz5hy8","SiderAction",void 0);var P=r.ccclass,I=r.property;t("SiderPageAction",(y=P("SiderAction"),A=I({type:a}),T=I({type:a}),y((S=n((v=function(t){function n(){for(var n,i=arguments.length,s=new Array(i),r=0;r<i;r++)s[r]=arguments[r];return n=t.call.apply(t,[this].concat(s))||this,e(n,"btn_label",S,o(n)),e(n,"gift_coins_label",E,o(n)),n}i(n,t);var s=n.prototype;return s.onLoad=function(){this.node.active=!1,u.Ins.addListener(h.DOUYIN_SILDER_show_refrush_data,this.refrush_data,this)},s.start=function(){},s.update=function(t){},s.show_windows=function(n,i){t.prototype.show_windows.call(this),this.node.active=!0,this.node.setPosition(0,0),this.node.getComponent(c)&&(this.node.getComponent(c).right=0,this.node.getComponent(c).left=0,this.node.getComponent(c).top=0,this.node.getComponent(c).bottom=0),this.refrush_data()},s.close_windows=function(n){t.prototype.close_windows.call(this,n)},s.refrush_data=function(){w.log("刷新 refrush_data   event"),this.gift_coins_label.string="+"+_.gift_coins,0==d.get_gift()?this.btn_label.string="跳转侧边栏":1==d.get_gift()?this.btn_label.string="领取奖励":this.btn_label.string="跳转侧边栏"},s.on_click_close=function(){this.close_windows(p.START)},s.btn_run=function(){w.log("btn_run"),0==d.get_gift()?this.add_siderbar():1==d.get_gift()?this.get_gift():this.add_siderbar()},s.get_gift=function(){g.show("Gold Gained "+_.gift_coins,f.OK),d.record_gift(2),d.record_coins(d.get_cur_coins()+_.gift_coins),u.Ins.emit(h.DOUYIN_SILDER_show_gift_btn),this.close_windows(p.START),u.Ins.emit(h.READY_START_GAME)},s.add_siderbar=function(){w.log("开始添加 add_siderbar"),l.ins.navigate_to_douyin((function(t){t?w.log("add_siderbar 添加侧边栏跳转成功"):w.log("add_siderbar 跳转失败")}))},n}(b)).prototype,"btn_label",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),E=n(v.prototype,"gift_coins_label",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),m=v))||m));s._RF.pop()}}}));

System.register("chunks:///_virtual/SilderManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./BytePlantform.ts","./Global.ts","./XStorage.ts","./EventsManager.ts","./Enums.ts","./Logger.ts"],(function(t){var i,n,e,o,r,s,c,a,l,_,u,g,f,d;return{setters:[function(t){i=t.applyDecoratedDescriptor,n=t.inheritsLoose,e=t.initializerDefineProperty,o=t.assertThisInitialized},function(t){r=t.cclegacy,s=t._decorator,c=t.Node,a=t.Component},function(t){l=t.BytePlantform},function(t){_=t.Global},function(t){u=t.XStorage},function(t){g=t.EventsManager},function(t){f=t.EventTyps},function(t){d=t.Logger}],execute:function(){var h,p,b,y,v;r._RF.push({},"c0711A/xmJLdpcQpQldQO14","SilderManager",void 0);var S=s.ccclass,k=s.property;t("SilderManager",(h=S("SilderManager"),p=k({type:c}),h((v=i((y=function(t){function i(){for(var i,n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return i=t.call.apply(t,[this].concat(r))||this,e(i,"btn_sider",v,o(i)),i}n(i,t);var r=i.prototype;return r.onLoad=function(){g.Ins.addListener(f.DOUYIN_SILDER_show_gift_btn,this.show_gift_btn,this)},r.start=function(){this.check_douyin()},r.update=function(t){},r.btn_checkSideBar=function(){d.log("开始检查 检查侧边栏"),l.ins.check_side_bar((function(t){t?d.log("checkSideBar 检查侧边栏 success"):d.log("checkSideBar 跳转失败 fail")}))},r.open_side_page=function(){_.ui_layer_action.show_win("Slider")},r.check_douyin=function(){this.show_gift_btn();var t=this;l.ins.check_side_bar((function(i){i?(d.log("check_douyin 检查侧边栏 success,可以使用侧边栏"),t.listenFromDouyi()):d.log("check_douyin 跳转失败 fail,结束判断")}))},r.show_gift_btn=function(){d.log("刷新 奖励按钮      event"),this.btn_sider.active=!1;var t=this;2==u.get_gift()?(this.btn_sider.active=!1,d.log("show_gift_btn 领取过奖励 不显示 ")):l.ins.check_side_bar((function(i){i?(d.log("show_gift_btn 检查侧边栏 success显示 "),t.btn_sider.active=!0):(d.log("show_gift_btn 检查侧边栏  fail "),t.btn_sider.active=!1)}))},r.listenFromDouyi=function(){2!=u.get_gift()?l.ins.listen_douyin((function(t){t?(d.log("main 从侧边栏调过来，可以奖励用户了！"),u.get_gift()<1&&(u.record_gift(1),d.log("add_siderbar 添加侧边栏跳转成功,记录数据 1"),g.Ins.emit(f.DOUYIN_SILDER_show_refrush_data))):d.log("main 不是从侧边栏调过来")})):d.log("check_douyin2 侧边栏奖励领取过，直接返回")},i}(a)).prototype,"btn_sider",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),b=y))||b));r._RF.pop()}}}));

System.register("chunks:///_virtual/TipsAction.ts",["./rollupPluginModLoBabelHelpers.js","cc","./ResourcePool.ts"],(function(e){var t,n,o,i,r,a,l,s,c,u,p,d;return{setters:[function(e){t=e.applyDecoratedDescriptor,n=e.inheritsLoose,o=e.initializerDefineProperty,i=e.assertThisInitialized},function(e){r=e.cclegacy,a=e._decorator,l=e.Label,s=e.Node,c=e.tween,u=e.Vec3,p=e.Component},function(e){d=e.ResourcePool}],execute:function(){var f,_,h,v,b,w,y,g,k;r._RF.push({},"8a067Y6r0FE9bkvju6Pxv/E","TipsAction",void 0);var O=a.ccclass,A=a.property,P=e("TIPS_TYPE",function(e){return e[e.COMMON=0]="COMMON",e[e.OK=1]="OK",e[e.WARN=2]="WARN",e}({}));e("TipsAction",(f=O("TipsAction"),_=A({type:l}),h=A({type:s}),v=A({type:s}),f((y=t((w=function(e){function t(){for(var t,n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return t=e.call.apply(e,[this].concat(r))||this,o(t,"level_label",y,i(t)),o(t,"ok_node",g,i(t)),o(t,"warn_node",k,i(t)),t}n(t,e);var r=t.prototype;return r.start=function(){},r.set_default=function(){this.node.setPosition(0,-250),this.node.active=!0},r.update=function(e){},r.show=function(e,t){switch(this.ok_node&&(this.ok_node.active=!1),this.warn_node&&(this.warn_node.active=!1),t){case P.OK:this.ok_node&&(this.ok_node.active=!0);break;case P.WARN:this.warn_node&&(this.warn_node.active=!0)}var n=this;n.level_label.string=e,n.set_default(),c(n.node).to(.85,{position:new u(0,0,0)},{easing:"quadInOut"}).delay(1).to(.5,{position:new u(0,200,0)},{easing:"quadInOut"}).call((function(){d.instance.remove_node(n.node)})).start()},t}(p)).prototype,"level_label",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),g=t(w.prototype,"ok_node",[h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),k=t(w.prototype,"warn_node",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),b=w))||b));r._RF.pop()}}}));

System.register("chunks:///_virtual/TipsManagerAction.ts",["./rollupPluginModLoBabelHelpers.js","cc","./ResourcePool.ts","./TipsAction.ts"],(function(n){var o,t,e,i,c,s,r;return{setters:[function(n){o=n.inheritsLoose},function(n){t=n.cclegacy,e=n._decorator,i=n.director,c=n.Component},function(n){s=n.ResourcePool},function(n){r=n.TipsAction}],execute:function(){var a,u;t._RF.push({},"43544cCaQFGZ4yxfpsqdahR","TipsManagerAction",void 0);var p=e.ccclass;e.property,n("TipsManagerAction",p("TipsManagerAction")(((u=function(n){function t(){return n.apply(this,arguments)||this}o(t,n);var e=t.prototype;return e.onLoad=function(){t.instance=this,i.addPersistRootNode(this.node)},e.update=function(n){},t.show=function(n,o){var e=t.instance.node;s.instance.create_by_Pool("Tips",e.worldPosition,e).then((function(t){var e=t.getComponent(r);e&&e.show(n,o)}))},t}(c)).instance=null,a=u))||a);t._RF.pop()}}}));

System.register("chunks:///_virtual/Tools.ts",["cc"],(function(t){var r,n,o,e,i;return{setters:[function(t){r=t.cclegacy,n=t._decorator,o=t.tween,e=t.Vec3,i=t.UITransform}],execute:function(){var c;r._RF.push({},"0f695ttxe5CWL3NcrWbvzLj","Tools",void 0);var a=n.ccclass,u=(n.property,{year:"numeric",month:"2-digit",day:"2-digit"});t("Tools",a("Tools")(c=function(){function t(){}return t.setSpriteAlpha=function(t,r){t&&(t.opacity=255*r)},t.insertArr=function(t,r){t||(t=[]),t[t.length]=r},t.getRowsByArr=function(r,n){if(r&&r.length>0){for(var o=r.length,e=[],i=0;i<o;i++)t.insertArr(e,r[i][n]);return e}return null},t.TweenAlphaAni=function(t,r,n){if(t)return o(t).to(n,{opacity:255*r})},t.random_between_floor=function(t,r){var n=Math.random()*(r-t)+t;return Math.floor(n)},t.getTodayDateString=function(){return(new Date).toLocaleDateString(void 0,u)},t.shuffleArray=function(t){for(var r,n=t.length;0!==n;){r=Math.floor(Math.random()*n),n--;var o=[t[r],t[n]];t[n]=o[0],t[r]=o[1]}return t},t.calculate_cell_position=function(t,r,n){var o=t%r,i=Math.floor(t/r),c=n.width,a=n.height,u=c/r;return new e(-c/2+u/2+o*u,-a/2+u/2+i*u,0)},t.checkRectIntersection=function(t,r){var n=t.getComponent(i),o=r.getComponent(i);if(!n||!o)return console.error("缺少 UITransform 组件！"),!1;var e=n.getBoundingBoxToWorld(),c=o.getBoundingBoxToWorld();return e.intersects(c)},t}())||c);r._RF.pop()}}}));

System.register("chunks:///_virtual/ToolsEnemy.ts",["cc","./Global.ts","./CellAction.ts"],(function(e){var n,t,o,l,c;return{setters:[function(e){n=e.cclegacy,t=e._decorator,o=e.Node},function(e){l=e.Global},function(e){c=e.CellAction}],execute:function(){var r;n._RF.push({},"de626UkdYxEfq/Y/aTcGcel","ToolsEnemy",void 0);var a=t.ccclass;t.property,e("ToolsEnemy",a("ToolsEnemy")(r=function(){function e(){}return e.get_enemy=function(e,n){if(!l.game_logic_action||!l.game_logic_action.get_cell_logic())return null;if(0===n.length)return null;for(var t=new Set,r=l.game_logic_action.get_cell_logic().get_all_cell(),a=0;a<r.length;a++){var i=r[a];if(null!=i&&i!==e){var u=i.getComponent(c);if(u){var g=u.get_target_enemy();g&&g instanceof o&&t.add(g)}}}for(var _=0;_<n.length;_++){var f=n[_].enemy;if(!t.has(f))return f}return n[0].enemy},e}())||r);n._RF.pop()}}}));

System.register("chunks:///_virtual/UILayerAction.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Global.ts","./ResourcePool.ts","./BaseWindows.ts","./Enums.ts","./Logger.ts"],(function(n){var o,t,e,i,s,c,r,u,a,l;return{setters:[function(n){o=n.inheritsLoose},function(n){t=n.cclegacy,e=n._decorator,i=n.Vec3,s=n.Component},function(n){c=n.Global},function(n){r=n.ResourcePool},function(n){u=n.BaseWindows},function(n){a=n.GAME_STATE},function(n){l=n.Logger}],execute:function(){var w;t._RF.push({},"e15c4sTIF1Fb5/ugOpASC4l","UILayerAction",void 0);var f=e.ccclass;e.property,n("UILayerAction",f("UILayerAction")(w=function(n){function t(){for(var o,t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];return(o=n.call.apply(n,[this].concat(e))||this).windows=void 0,o}o(t,n);var e=t.prototype;return e.onLoad=function(){c.ui_layer_action=this,this.windows=new Map},e.start=function(){},e.update=function(n){},e.show_win=function(n,o,t,e){var s=this;void 0===o&&(o=null),void 0===t&&(t=null),void 0===e&&(e=a.PAUSE);var c=this.windows.get(n);if(c)return c.show_windows(o,t,e),c;r.instance.create_by_Pool(n,i.ZERO,this.node).then((function(e){var i=e.getComponent(u);return s.windows.set(n,i),i.show_windows(o,t),i})).catch((function(n){l.log(n)}))},t}(s))||w);t._RF.pop()}}}));

System.register("chunks:///_virtual/WindowData.ts",["cc"],(function(t){var n,a;return{setters:[function(t){n=t.cclegacy,a=t._decorator}],execute:function(){n._RF.push({},"1ce14h0RHdMZY2q2RVzSoQj","WindowData",void 0);a.ccclass,a.property,t("WindowData",(function(t){void 0===t&&(t=null),this.name="Win",this.data=null,this.data=t}));n._RF.pop()}}}));

System.register("chunks:///_virtual/WxPlatform.ts",["./rollupPluginModLoBabelHelpers.js","cc","./env","./Global.ts","./Tools.ts","./Logger.ts"],(function(t){var o,n,i,s,e,c,r;return{setters:[function(t){o=t.createClass},function(t){n=t.cclegacy,i=t._decorator},function(t){s=t.WECHAT},function(t){e=t.Global},function(t){c=t.Tools},function(t){r=t.Logger}],execute:function(){var a,u;n._RF.push({},"ed0eaZDUEFP+ZYsQMWtnN2T","WxPlatform",void 0);var h=i.ccclass;i.property,t("WxPlatform",h("WxPlatform")(((u=function(){function t(){this.wx=window.wx,this.pic=[{id:"O8T6h8l8RfWJQ6wkdF1AYw==",url:"https://mmocgame.qpic.cn/wechatgame/nicJCquRHTK4UU9dOfEP6MG48BxqAN64GT12JZcEPjc2VW1DQIIrWPAELtovwnq1z/0"},{id:"eT4m1csMTi2c+Hn13J051A==",url:"https://mmocgame.qpic.cn/wechatgame/yN0ib7IICvoibJysBia8x5NMmUZRN76LC8dYzMjSAETTmS6uQafsiciceNOL8mEq1gtwe/0"},{id:"Rve5UFnVTLu5np6gmn2NyA==",url:"https://mmocgame.qpic.cn/wechatgame/YZPoCIWzenGMNEANDZuCLbN94JFbSw24brKHvHhoHydyKndhNL8NpLicvfzQDlhby/0"}],this.avatar=void 0,this.name_Label=void 0,this.systemInfo=void 0,this.screenWidth=void 0,this.screenHeight=void 0,this.userInfo=void 0,this.rewardVideo=void 0,this.custom_arr=[],this.custom_show_status=!1,this.banner=void 0,this.banner_show_status=!1}var n=t.prototype;return n.wechat_get_user_info=function(){r.log("---------- 执行 wechat_get_user_info",s)},n.login=function(){r.log("22222 login ---------- 执行 wechat_get_user_info",s)},n.setAvatar=function(t){},n.wechat_setting=function(){r.log("wechat_setting",s)},n.show_interstitial=function(t){r.log("显示插屏广告》〉》〉》〉》〉》〉》〉》")},n.show_reward_video=function(t){var o=this,n=this,i=e.ad_video_id;null!=n.rewardVideo&&n.rewardVideo.offClose(c);var s=this.wx.createRewardedVideoAd({adUnitId:i.trim()});n.rewardVideo=s,s.load().then((function(){o.wx.showToast({title:"看完视频领奖励",icon:"success",duration:1500,mask:!1,success:function(){},fail:function(){},complete:function(){}}),r.log("视频 广告加载成功"),s.show()})),s.onError((function(n){r.log("激励视频 广告显示失败",n),o.wx.showToast({title:"请稍后再试",icon:"fail",duration:1500,mask:!1,success:function(){},fail:function(){},complete:function(){}}),t(2)}));var c=function o(n){n&&n.isEnded?(r.log("res:  ",n),t(1),s.offClose(o)):(r.log("播放中退出"),t(0))};s.onClose(c)},n.destory_custom=function(){this.custom_arr.forEach((function(t){try{t.destroy()}catch(t){r.log("关闭 custom error...",t)}r.log("关闭 custom ...")})),this.custom_arr=[]},n.hide_custom=function(){r.log("隐藏销毁 cusTom"),this.custom_show_status=!1,this.destory_custom()},n.show_custom_ad=function(){if(0!=e.ad_custom_id.length){var t=e.ad_custom_id[c.random_between_floor(0,e.ad_custom_id.length)];this.custom_show_status=!0,r.log("ad_custom_id  原生模板 ID:",t)}},n.hide_banner=function(){this.banner_show_status=!1,null!=this.banner&&(this.banner.destroy(),this.banner=null,r.log("关闭 banner..."))},n.show_banner=function(t){},n.show_share=function(){this.get_random_pic()},n.get_random_pic=function(){var t=null;try{t=this.pic[c.random_between_floor(0,this.pic.length)]}catch(t){r.log("get_random_pic error:",t)}return this.pic||(t=this.pic[0]),t},n.wx_show_modal=function(){r.log("funcation is wx_show_modal",s)},o(t,null,[{key:"ins",get:function(){return this._ins||(this._ins=new t),this._ins}}]),t}())._ins=void 0,a=u))||a);n._RF.pop()}}}));

System.register("chunks:///_virtual/XStorage.ts",["cc","./Tools.ts","./Logger.ts","./Global.ts"],(function(t){var e,r,o,a,l;return{setters:[function(t){e=t.cclegacy,r=t._decorator},function(t){o=t.Tools},function(t){a=t.Logger},function(t){l=t.Global}],execute:function(){var c;e._RF.push({},"72b16ImcEhBfqaHpPprfuX/","XStorage",void 0);var n=r.ccclass,_=(r.property,"daily_lottery_data"),u="daily_level_fail_data",i="item_list_data",g="daily_buy_item_list",s="daily_buy_item_list_date",m="game_board_cells",S="game_arrow_towers";t("XStorage",n("XStorage")(c=function(){function t(){}return t.record_lvl_progress=function(t){var e=Array.from(t.entries()),r=JSON.stringify(e);localStorage.setItem("lvl_progress_map",r)},t.get_lvl_progress=function(){var t=localStorage.getItem("lvl_progress_map");if(t){var e=JSON.parse(t);return new Map(e)}return new Map},t.get_history_lvl=function(){var e=localStorage.getItem("history_lvl");return e?Number(e):(t.record_cur_lvl(1),1)},t.get_cur_lvl=function(){var t=localStorage.getItem("cur_lvl");return t?Number(t):(localStorage.setItem("cur_lvl","1"),1)},t.record_cur_lvl=function(t){localStorage.setItem("cur_lvl",t+"");var e=localStorage.getItem("history_lvl");e?t>Number(e)&&localStorage.setItem("history_lvl",t+""):localStorage.setItem("history_lvl",t+"")},t.get_cur_coins=function(){var t=localStorage.getItem("cur_coins");if(t){var e=Number(t);return e<0&&(e=0),e}return localStorage.setItem("cur_coins","0"),0},t.record_coins=function(t){t<0&&(t=0),localStorage.setItem("cur_coins",t+"")},t.record_volum_sound=function(t){t<0&&(t=0),localStorage.setItem("volum_sound",t+"")},t.record_volum_music=function(t){t<0&&(t=0),localStorage.setItem("volum_music",t+"")},t.get_volum_sound=function(){var t=localStorage.getItem("volum_sound");if(t){var e=Number(t);return e<0&&(e=0),e}return localStorage.setItem("volum_sound","1"),1},t.get_volum_music=function(){var t=localStorage.getItem("volum_music");if(t){var e=Number(t);return e<0&&(e=0),e}return localStorage.setItem("volum_music","1"),1},t.get_cell_500_tips=function(){var t=localStorage.getItem("cell_500_tips");return t?0!=Number(t):(localStorage.setItem("cell_500_tips","0"),!1)},t.set_cell_500_tips=function(){localStorage.setItem("cell_500_tips","1")},t.get_cur_swap=function(){var t=localStorage.getItem("cur_swap");if(t){var e=Number(t);return e<0&&(e=0),e}return localStorage.setItem("cur_swap","5"),5},t.record_swap=function(t){t<0&&(t=0),localStorage.setItem("cur_swap",t+"")},t.get_cur_sun=function(){var t=localStorage.getItem("cur_sun");if(t){var e=Number(t);return e<0&&(e=0),e}return localStorage.setItem("cur_sun","5"),5},t.record_sun=function(t){t<0&&(t=0),localStorage.setItem("cur_sun",t+"")},t.get_cur_heart=function(){var t=localStorage.getItem("cur_heart");if(t){var e=Number(t);return e<0&&(e=0),e}return localStorage.setItem("cur_heart","5"),5},t.record_heart=function(t){t<0&&(t=0),localStorage.setItem("cur_heart",t+"")},t.get_cur_relife=function(){var t=localStorage.getItem("cur_relife");if(t){var e=Number(t);return e<0&&(e=0),e}return localStorage.setItem("cur_relife","5"),5},t.record_relife=function(t){t<0&&(t=0),localStorage.setItem("cur_relife",t+"")},t.get_cur_score=function(){var t=localStorage.getItem("cur_score");if(t){var e=Number(t);return e<0&&(e=0),e}return localStorage.setItem("cur_score","0"),0},t.record_score=function(t){localStorage.setItem("cur_score",t+"")},t.is_new_player=function(){var t=localStorage.getItem("is_new_player");return t?0!=Number(t):(localStorage.setItem("is_new_player","1"),!0)},t.is_old_player=function(){localStorage.setItem("is_new_player","0")},t.get_gift=function(){var t=localStorage.getItem("gift");return t?Number(t):(localStorage.setItem("gift","0"),0)},t.record_gift=function(t){localStorage.setItem("gift",t+"")},t.get_last_lottery_date=function(){return localStorage.getItem("LAST_LOTTERY_DATE")},t.recode_last_lottery_date=function(){var t=o.getTodayDateString();localStorage.setItem("LAST_LOTTERY_DATE",t)},t.get_today_lottery_count=function(){var e=localStorage.getItem(_),r=(new Date).toDateString();if(e)try{var o=JSON.parse(e);if(o.date===r)return o.count}catch(t){a.error("XStorage: 解析抽奖数据失败",t)}return t._reset_lottery_data(),0},t.increase_today_lottery_count=function(e){var r=t.get_today_lottery_count(),o=(new Date).toDateString(),a=Math.min(r+1,e),l=JSON.stringify({date:o,count:a});localStorage.setItem(_,l)},t._reset_lottery_data=function(){var t=(new Date).toDateString(),e=JSON.stringify({date:t,count:0});localStorage.setItem(_,e)},t.get_today_fail_count=function(){var t=localStorage.getItem(u),e=(new Date).toDateString(),r={date:e,count:0};if(t)try{var o=JSON.parse(t);o.date===e&&(r=o)}catch(t){a.error("XStorage: 解析全局失败数据失败",t)}return t&&r.date===e||localStorage.setItem(u,JSON.stringify(r)),r.count},t.increase_today_fail_count=function(){var e=t.get_today_fail_count(),r=(new Date).toDateString(),o=Math.min(e+1,l.MAX_FAIL_COUNT),a=JSON.stringify({date:r,count:o});localStorage.setItem(u,a)},t.reset_fail_count=function(){var t=(new Date).toDateString(),e=JSON.stringify({date:t,count:0});localStorage.setItem(u,e)},t.is_fail_count_reached=function(){var e=t.get_today_fail_count();return!l.is_review_model&&e>=l.MAX_FAIL_COUNT},t.record_item_list=function(t){var e=JSON.stringify(t);localStorage.setItem(i,e),a.log("XStorage: Item 列表数据已保存:",t)},t.get_item_list=function(){var t=localStorage.getItem(i);if(t)try{var e=JSON.parse(t);if(Array.isArray(e))return e}catch(t){a.error("XStorage: 解析 Item 列表数据失败，返回空数组。",t)}return[]},t.get_buy_item_list=function(){var t=localStorage.getItem(g);if(t)try{return JSON.parse(t)}catch(t){a.error("XStorage: 解析购买列表失败")}return[]},t.record_buy_item_list=function(t){localStorage.setItem(g,JSON.stringify(t))},t.get_last_buy_list_date=function(){return localStorage.getItem(s)},t.record_last_buy_list_date=function(){var t=o.getTodayDateString();localStorage.setItem(s,t)},t.get_item_btn=function(){var t=localStorage.getItem("item_btn");if(t){var e=Number(t);return e<0&&(e=0),e}return localStorage.setItem("item_btn","0"),0},t.record_item_btn=function(t){localStorage.setItem("item_btn",t+"")},t.record_cell_data=function(t){var e=JSON.stringify(t);localStorage.setItem(m,e),a.log("XStorage: 游戏格子数据已保存。")},t.get_cell_data=function(){var t=localStorage.getItem(m);if(t)try{var e=JSON.parse(t);return a.log("XStorage: 游戏格子数据已读取。",e.length),Array.isArray(e)?e:null}catch(t){return a.error("XStorage: 解析格子数据失败。",t),null}return null},t.clear_cell_data=function(){localStorage.removeItem(m),a.log("XStorage: 游戏格子数据已清除。")},t.record_arrow_towers=function(t){var e=JSON.stringify(t);localStorage.setItem(S,e),a.log("XStorage: 箭塔数据已保存。",t)},t.get_arrow_towers=function(){var t=localStorage.getItem(S);if(t)try{var e=JSON.parse(t);return Array.isArray(e)?e:[]}catch(t){return a.error("XStorage: 解析箭塔数据失败。",t),[]}return[]},t.clear_arrow_towers=function(){localStorage.removeItem(S)},t}())||c);e._RF.pop()}}}));

(function(r) {
  r('virtual:///prerequisite-imports/main', 'chunks:///_virtual/main'); 
})(function(mid, cid) {
    System.register(mid, [cid], function (_export, _context) {
    return {
        setters: [function(_m) {
            var _exportObj = {};

            for (var _key in _m) {
              if (_key !== "default" && _key !== "__esModule") _exportObj[_key] = _m[_key];
            }
      
            _export(_exportObj);
        }],
        execute: function () { }
    };
    });
});